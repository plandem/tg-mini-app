var cc=Object.defineProperty;var lc=(r,e,t)=>e in r?cc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var uc=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var u=(r,e,t)=>lc(r,typeof e!="symbol"?e+"":e,t);var Lf=uc((qf,ft)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var gr,L,uo,ut,ai,ho,Wn,hs,Hn,Vn,fo,ur={},po=[],hc=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,tn=Array.isArray;function He(r,e){for(var t in e)r[t]=e[t];return r}function _o(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function le(r,e,t){var n,s,i,o={};for(i in e)i=="key"?n=e[i]:i=="ref"?s=e[i]:o[i]=e[i];if(arguments.length>2&&(o.children=arguments.length>3?gr.call(arguments,2):t),typeof r=="function"&&r.defaultProps!=null)for(i in r.defaultProps)o[i]===void 0&&(o[i]=r.defaultProps[i]);return nr(r,o,n,s,null)}function nr(r,e,t,n,s){var i={type:r,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++uo,__i:-1,__u:0};return s==null&&L.vnode!=null&&L.vnode(i),i}function mo(){return{current:null}}function je(r){return r.children}function Re(r,e){this.props=r,this.context=e}function Mt(r,e){if(e==null)return r.__?Mt(r.__,r.__i+1):null;for(var t;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null)return t.__e;return typeof r.type=="function"?Mt(r):null}function bo(r){var e,t;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,e=0;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null){r.__e=r.__c.base=t.__e;break}return bo(r)}}function zn(r){(!r.__d&&(r.__d=!0)&&ut.push(r)&&!Hr.__r++||ai!==L.debounceRendering)&&((ai=L.debounceRendering)||ho)(Hr)}function Hr(){var r,e,t,n,s,i,o,a;for(ut.sort(Wn);r=ut.shift();)r.__d&&(e=ut.length,n=void 0,i=(s=(t=r).__v).__e,o=[],a=[],t.__P&&((n=He({},s)).__v=s.__v+1,L.vnode&&L.vnode(n),ds(t.__P,n,s,t.__n,t.__P.namespaceURI,32&s.__u?[i]:null,o,i??Mt(s),!!(32&s.__u),a),n.__v=s.__v,n.__.__k[n.__i]=n,xo(o,n,a),n.__e!=i&&bo(n)),ut.length>e&&ut.sort(Wn));Hr.__r=0}function go(r,e,t,n,s,i,o,a,c,h,m){var p,x,g,v,I,M=n&&n.__k||po,j=e.length;for(t.__d=c,dc(t,e,M),c=t.__d,p=0;p<j;p++)(g=t.__k[p])!=null&&(x=g.__i===-1?ur:M[g.__i]||ur,g.__i=p,ds(r,g,x,s,i,o,a,c,h,m),v=g.__e,g.ref&&x.ref!=g.ref&&(x.ref&&fs(x.ref,null,g),m.push(g.ref,g.__c||v,g)),I==null&&v!=null&&(I=v),65536&g.__u||x.__k===g.__k?c=yo(g,c,r):typeof g.type=="function"&&g.__d!==void 0?c=g.__d:v&&(c=v.nextSibling),g.__d=void 0,g.__u&=-196609);t.__d=c,t.__e=I}function dc(r,e,t){var n,s,i,o,a,c=e.length,h=t.length,m=h,p=0;for(r.__k=[],n=0;n<c;n++)(s=e[n])!=null&&typeof s!="boolean"&&typeof s!="function"?(o=n+p,(s=r.__k[n]=typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?nr(null,s,null,null,null):tn(s)?nr(je,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?nr(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=r,s.__b=r.__b+1,i=null,(a=s.__i=fc(s,t,o,m))!==-1&&(m--,(i=t[a])&&(i.__u|=131072)),i==null||i.__v===null?(a==-1&&p--,typeof s.type!="function"&&(s.__u|=65536)):a!==o&&(a==o-1?p--:a==o+1?p++:(a>o?p--:p++,s.__u|=65536))):s=r.__k[n]=null;if(m)for(n=0;n<h;n++)(i=t[n])!=null&&!(131072&i.__u)&&(i.__e==r.__d&&(r.__d=Mt(i)),wo(i,i))}function yo(r,e,t){var n,s;if(typeof r.type=="function"){for(n=r.__k,s=0;n&&s<n.length;s++)n[s]&&(n[s].__=r,e=yo(n[s],e,t));return e}r.__e!=e&&(e&&r.type&&!t.contains(e)&&(e=Mt(r)),t.insertBefore(r.__e,e||null),e=r.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function ze(r,e){return e=e||[],r==null||typeof r=="boolean"||(tn(r)?r.some(function(t){ze(t,e)}):e.push(r)),e}function fc(r,e,t,n){var s=r.key,i=r.type,o=t-1,a=t+1,c=e[t];if(c===null||c&&s==c.key&&i===c.type&&!(131072&c.__u))return t;if(n>(c!=null&&!(131072&c.__u)?1:0))for(;o>=0||a<e.length;){if(o>=0){if((c=e[o])&&!(131072&c.__u)&&s==c.key&&i===c.type)return o;o--}if(a<e.length){if((c=e[a])&&!(131072&c.__u)&&s==c.key&&i===c.type)return a;a++}}return-1}function ci(r,e,t){e[0]==="-"?r.setProperty(e,t??""):r[e]=t==null?"":typeof t!="number"||hc.test(e)?t:t+"px"}function Mr(r,e,t,n,s){var i;e:if(e==="style")if(typeof t=="string")r.style.cssText=t;else{if(typeof n=="string"&&(r.style.cssText=n=""),n)for(e in n)t&&e in t||ci(r.style,e,"");if(t)for(e in t)n&&t[e]===n[e]||ci(r.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in r||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),r.l||(r.l={}),r.l[e+i]=t,t?n?t.u=n.u:(t.u=hs,r.addEventListener(e,i?Vn:Hn,i)):r.removeEventListener(e,i?Vn:Hn,i);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in r)try{r[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!=="-"?r.removeAttribute(e):r.setAttribute(e,e=="popover"&&t==1?"":t))}}function li(r){return function(e){if(this.l){var t=this.l[e.type+r];if(e.t==null)e.t=hs++;else if(e.t<t.u)return;return t(L.event?L.event(e):e)}}}function ds(r,e,t,n,s,i,o,a,c,h){var m,p,x,g,v,I,M,j,C,D,ee,Z,ne,pe,ae,re,N=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(c=!!(32&t.__u),i=[a=e.__e=t.__e]),(m=L.__b)&&m(e);e:if(typeof N=="function")try{if(j=e.props,C="prototype"in N&&N.prototype.render,D=(m=N.contextType)&&n[m.__c],ee=m?D?D.props.value:m.__:n,t.__c?M=(p=e.__c=t.__c).__=p.__E:(C?e.__c=p=new N(j,ee):(e.__c=p=new Re(j,ee),p.constructor=N,p.render=_c),D&&D.sub(p),p.props=j,p.state||(p.state={}),p.context=ee,p.__n=n,x=p.__d=!0,p.__h=[],p._sb=[]),C&&p.__s==null&&(p.__s=p.state),C&&N.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=He({},p.__s)),He(p.__s,N.getDerivedStateFromProps(j,p.__s))),g=p.props,v=p.state,p.__v=e,x)C&&N.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),C&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(C&&N.getDerivedStateFromProps==null&&j!==g&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(j,ee),!p.__e&&(p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(j,p.__s,ee)===!1||e.__v===t.__v)){for(e.__v!==t.__v&&(p.props=j,p.state=p.__s,p.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(B){B&&(B.__=e)}),Z=0;Z<p._sb.length;Z++)p.__h.push(p._sb[Z]);p._sb=[],p.__h.length&&o.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(j,p.__s,ee),C&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(g,v,I)})}if(p.context=ee,p.props=j,p.__P=r,p.__e=!1,ne=L.__r,pe=0,C){for(p.state=p.__s,p.__d=!1,ne&&ne(e),m=p.render(p.props,p.state,p.context),ae=0;ae<p._sb.length;ae++)p.__h.push(p._sb[ae]);p._sb=[]}else do p.__d=!1,ne&&ne(e),m=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++pe<25);p.state=p.__s,p.getChildContext!=null&&(n=He(He({},n),p.getChildContext())),C&&!x&&p.getSnapshotBeforeUpdate!=null&&(I=p.getSnapshotBeforeUpdate(g,v)),go(r,tn(re=m!=null&&m.type===je&&m.key==null?m.props.children:m)?re:[re],e,t,n,s,i,o,a,c,h),p.base=e.__e,e.__u&=-161,p.__h.length&&o.push(p),M&&(p.__E=p.__=null)}catch(B){if(e.__v=null,c||i!=null){for(e.__u|=c?160:32;a&&a.nodeType===8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,e.__e=a}else e.__e=t.__e,e.__k=t.__k;L.__e(B,e,t)}else i==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=pc(t.__e,e,t,n,s,i,o,c,h);(m=L.diffed)&&m(e)}function xo(r,e,t){e.__d=void 0;for(var n=0;n<t.length;n++)fs(t[n],t[++n],t[++n]);L.__c&&L.__c(e,r),r.some(function(s){try{r=s.__h,s.__h=[],r.some(function(i){i.call(s)})}catch(i){L.__e(i,s.__v)}})}function pc(r,e,t,n,s,i,o,a,c){var h,m,p,x,g,v,I,M=t.props,j=e.props,C=e.type;if(C==="svg"?s="http://www.w3.org/2000/svg":C==="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),i!=null){for(h=0;h<i.length;h++)if((g=i[h])&&"setAttribute"in g==!!C&&(C?g.localName===C:g.nodeType===3)){r=g,i[h]=null;break}}if(r==null){if(C===null)return document.createTextNode(j);r=document.createElementNS(s,C,j.is&&j),a&&(L.__m&&L.__m(e,i),a=!1),i=null}if(C===null)M===j||a&&r.data===j||(r.data=j);else{if(i=i&&gr.call(r.childNodes),M=t.props||ur,!a&&i!=null)for(M={},h=0;h<r.attributes.length;h++)M[(g=r.attributes[h]).name]=g.value;for(h in M)if(g=M[h],h!="children"){if(h=="dangerouslySetInnerHTML")p=g;else if(!(h in j)){if(h=="value"&&"defaultValue"in j||h=="checked"&&"defaultChecked"in j)continue;Mr(r,h,null,g,s)}}for(h in j)g=j[h],h=="children"?x=g:h=="dangerouslySetInnerHTML"?m=g:h=="value"?v=g:h=="checked"?I=g:a&&typeof g!="function"||M[h]===g||Mr(r,h,g,M[h],s);if(m)a||p&&(m.__html===p.__html||m.__html===r.innerHTML)||(r.innerHTML=m.__html),e.__k=[];else if(p&&(r.innerHTML=""),go(r,tn(x)?x:[x],e,t,n,C==="foreignObject"?"http://www.w3.org/1999/xhtml":s,i,o,i?i[0]:t.__k&&Mt(t,0),a,c),i!=null)for(h=i.length;h--;)_o(i[h]);a||(h="value",C==="progress"&&v==null?r.removeAttribute("value"):v!==void 0&&(v!==r[h]||C==="progress"&&!v||C==="option"&&v!==M[h])&&Mr(r,h,v,M[h],s),h="checked",I!==void 0&&I!==r[h]&&Mr(r,h,I,M[h],s))}return r}function fs(r,e,t){try{if(typeof r=="function"){var n=typeof r.__u=="function";n&&r.__u(),n&&e==null||(r.__u=r(e))}else r.current=e}catch(s){L.__e(s,t)}}function wo(r,e,t){var n,s;if(L.unmount&&L.unmount(r),(n=r.ref)&&(n.current&&n.current!==r.__e||fs(n,null,e)),(n=r.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){L.__e(i,e)}n.base=n.__P=null}if(n=r.__k)for(s=0;s<n.length;s++)n[s]&&wo(n[s],e,t||typeof r.type!="function");t||_o(r.__e),r.__c=r.__=r.__e=r.__d=void 0}function _c(r,e,t){return this.constructor(r,t)}function hr(r,e,t){var n,s,i,o;L.__&&L.__(r,e),s=(n=typeof t=="function")?null:t&&t.__k||e.__k,i=[],o=[],ds(e,r=(!n&&t||e).__k=le(je,null,[r]),s||ur,ur,e.namespaceURI,!n&&t?[t]:s?null:e.firstChild?gr.call(e.childNodes):null,i,!n&&t?t:s?s.__e:e.firstChild,n,o),xo(i,r,o)}function vo(r,e){hr(r,e,vo)}function mc(r,e,t){var n,s,i,o,a=He({},r.props);for(i in r.type&&r.type.defaultProps&&(o=r.type.defaultProps),e)i=="key"?n=e[i]:i=="ref"?s=e[i]:a[i]=e[i]===void 0&&o!==void 0?o[i]:e[i];return arguments.length>2&&(a.children=arguments.length>3?gr.call(arguments,2):t),nr(r.type,a,n||r.key,s||r.ref,null)}function ps(r,e){var t={__c:e="__cC"+fo++,__:r,Consumer:function(n,s){return n.children(s)},Provider:function(n){var s,i;return this.getChildContext||(s=[],(i={})[e]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.some(function(a){a.__e=!0,zn(a)})},this.sub=function(o){s.push(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){s&&s.splice(s.indexOf(o),1),a&&a.call(o)}}),n.children}};return t.Provider.__=t.Consumer.contextType=t}gr=po.slice,L={__e:function(r,e,t,n){for(var s,i,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(r)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(r,n||{}),o=s.__d),o)return s.__E=s}catch(a){r=a}throw r}},uo=0,Re.prototype.setState=function(r,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=He({},this.state),typeof r=="function"&&(r=r(He({},t),this.props)),r&&He(t,r),r!=null&&this.__v&&(e&&this._sb.push(e),zn(this))},Re.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),zn(this))},Re.prototype.render=je,ut=[],ho=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Wn=function(r,e){return r.__v.__b-e.__v.__b},Hr.__r=0,hs=0,Hn=li(!1),Vn=li(!0),fo=0;var bc=0;function $(r,e,t,n,s,i){e||(e={});var o,a,c=e;if("ref"in c)for(a in c={},e)a=="ref"?o=e[a]:c[a]=e[a];var h={type:r,props:c,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--bc,__i:-1,__u:0,__source:s,__self:i};if(typeof r=="function"&&(o=r.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return L.vnode&&L.vnode(h),h}var gc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function xc(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var Ye,z,kn,ui,Nt=0,So=[],K=L,hi=K.__b,di=K.__r,fi=K.diffed,pi=K.__c,_i=K.unmount,mi=K.__;function mt(r,e){K.__h&&K.__h(z,r,Nt||e),Nt=0;var t=z.__H||(z.__H={__:[],__h:[]});return r>=t.__.length&&t.__.push({}),t.__[r]}function pt(r){return Nt=1,rn(ko,r)}function rn(r,e,t){var n=mt(Ye++,2);if(n.t=r,!n.__c&&(n.__=[t?t(e):ko(void 0,e),function(a){var c=n.__N?n.__N[0]:n.__[0],h=n.t(c,a);c!==h&&(n.__N=[h,n.__[1]],n.__c.setState({}))}],n.__c=z,!z.u)){var s=function(a,c,h){if(!n.__c.__H)return!0;var m=n.__c.__H.__.filter(function(x){return!!x.__c});if(m.every(function(x){return!x.__N}))return!i||i.call(this,a,c,h);var p=!1;return m.forEach(function(x){if(x.__N){var g=x.__[0];x.__=x.__N,x.__N=void 0,g!==x.__[0]&&(p=!0)}}),!(!p&&n.__c.props===a)&&(!i||i.call(this,a,c,h))};z.u=!0;var i=z.shouldComponentUpdate,o=z.componentWillUpdate;z.componentWillUpdate=function(a,c,h){if(this.__e){var m=i;i=void 0,s(a,c,h),i=m}o&&o.call(this,a,c,h)},z.shouldComponentUpdate=s}return n.__N||n.__}function yr(r,e){var t=mt(Ye++,3);!K.__s&&gs(t.__H,e)&&(t.__=r,t.i=e,z.__H.__h.push(t))}function qt(r,e){var t=mt(Ye++,4);!K.__s&&gs(t.__H,e)&&(t.__=r,t.i=e,z.__h.push(t))}function Qe(r){return Nt=5,_t(function(){return{current:r}},[])}function _s(r,e,t){Nt=6,qt(function(){return typeof r=="function"?(r(e()),function(){return r(null)}):r?(r.current=e(),function(){return r.current=null}):void 0},t==null?t:t.concat(r))}function _t(r,e){var t=mt(Ye++,7);return gs(t.__H,e)&&(t.__=r(),t.__H=e,t.__h=r),t.__}function At(r,e){return Nt=8,_t(function(){return r},e)}function nn(r){var e=z.context[r.__c],t=mt(Ye++,9);return t.c=r,e?(t.__==null&&(t.__=!0,e.sub(z)),e.props.value):r.__}function ms(r,e){K.useDebugValue&&K.useDebugValue(e?e(r):r)}function wc(r){var e=mt(Ye++,10),t=pt();return e.__=r,z.componentDidCatch||(z.componentDidCatch=function(n,s){e.__&&e.__(n,s),t[1](n)}),[t[0],function(){t[1](void 0)}]}function bs(){var r=mt(Ye++,11);if(!r.__){for(var e=z.__v;e!==null&&!e.__m&&e.__!==null;)e=e.__;var t=e.__m||(e.__m=[0,0]);r.__="P"+t[0]+"-"+t[1]++}return r.__}function vc(){for(var r;r=So.shift();)if(r.__P&&r.__H)try{r.__H.__h.forEach(Dr),r.__H.__h.forEach(Jn),r.__H.__h=[]}catch(e){r.__H.__h=[],K.__e(e,r.__v)}}K.__b=function(r){z=null,hi&&hi(r)},K.__=function(r,e){r&&e.__k&&e.__k.__m&&(r.__m=e.__k.__m),mi&&mi(r,e)},K.__r=function(r){di&&di(r),Ye=0;var e=(z=r.__c).__H;e&&(kn===z?(e.__h=[],z.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.i=t.__N=void 0})):(e.__h.forEach(Dr),e.__h.forEach(Jn),e.__h=[],Ye=0)),kn=z},K.diffed=function(r){fi&&fi(r);var e=r.__c;e&&e.__H&&(e.__H.__h.length&&(So.push(e)!==1&&ui===K.requestAnimationFrame||((ui=K.requestAnimationFrame)||Sc)(vc)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.i=void 0})),kn=z=null},K.__c=function(r,e){e.some(function(t){try{t.__h.forEach(Dr),t.__h=t.__h.filter(function(n){return!n.__||Jn(n)})}catch(n){e.some(function(s){s.__h&&(s.__h=[])}),e=[],K.__e(n,t.__v)}}),pi&&pi(r,e)},K.unmount=function(r){_i&&_i(r);var e,t=r.__c;t&&t.__H&&(t.__H.__.forEach(function(n){try{Dr(n)}catch(s){e=s}}),t.__H=void 0,e&&K.__e(e,t.__v))};var bi=typeof requestAnimationFrame=="function";function Sc(r){var e,t=function(){clearTimeout(n),bi&&cancelAnimationFrame(e),setTimeout(r)},n=setTimeout(t,100);bi&&(e=requestAnimationFrame(t))}function Dr(r){var e=z,t=r.__c;typeof t=="function"&&(r.__c=void 0,t()),z=e}function Jn(r){var e=z;r.__c=r.__(),z=e}function gs(r,e){return!r||r.length!==e.length||e.some(function(t,n){return t!==r[n]})}function ko(r,e){return typeof e=="function"?e(r):e}function Eo(r,e){for(var t in e)r[t]=e[t];return r}function Gn(r,e){for(var t in r)if(t!=="__source"&&!(t in e))return!0;for(var n in e)if(n!=="__source"&&r[n]!==e[n])return!0;return!1}function Vr(r,e){this.props=r,this.context=e}function ys(r,e){function t(s){var i=this.props.ref,o=i==s.ref;return!o&&i&&(i.call?i(null):i.current=null),e?!e(this.props,s)||!o:Gn(this.props,s)}function n(s){return this.shouldComponentUpdate=t,le(r,s)}return n.displayName="Memo("+(r.displayName||r.name)+")",n.prototype.isReactComponent=!0,n.__f=!0,n}(Vr.prototype=new Re).isPureReactComponent=!0,Vr.prototype.shouldComponentUpdate=function(r,e){return Gn(this.props,r)||Gn(this.state,e)};var gi=L.__b;L.__b=function(r){r.type&&r.type.__f&&r.ref&&(r.props.ref=r.ref,r.ref=null),gi&&gi(r)};var kc=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Me(r){function e(t){var n=Eo({},t);return delete n.ref,r(n,t.ref||null)}return e.$$typeof=kc,e.render=e,e.prototype.isReactComponent=e.__f=!0,e.displayName="ForwardRef("+(r.displayName||r.name)+")",e}var yi=function(r,e){return r==null?null:ze(ze(r).map(e))},xs={map:yi,forEach:yi,count:function(r){return r?ze(r).length:0},only:function(r){var e=ze(r);if(e.length!==1)throw"Children.only";return e[0]},toArray:ze},Ec=L.__e;L.__e=function(r,e,t,n){if(r.then){for(var s,i=e;i=i.__;)if((s=i.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(r,e)}Ec(r,e,t,n)};var xi=L.unmount;function Po(r,e,t){return r&&(r.__c&&r.__c.__H&&(r.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),r.__c.__H=null),(r=Eo({},r)).__c!=null&&(r.__c.__P===t&&(r.__c.__P=e),r.__c=null),r.__k=r.__k&&r.__k.map(function(n){return Po(n,e,t)})),r}function Co(r,e,t){return r&&t&&(r.__v=null,r.__k=r.__k&&r.__k.map(function(n){return Co(n,e,t)}),r.__c&&r.__c.__P===e&&(r.__e&&t.appendChild(r.__e),r.__c.__e=!0,r.__c.__P=t)),r}function sr(){this.__u=0,this.t=null,this.__b=null}function Oo(r){var e=r.__.__c;return e&&e.__a&&e.__a(r)}function Ao(r){var e,t,n;function s(i){if(e||(e=r()).then(function(o){t=o.default||o},function(o){n=o}),n)throw n;if(!t)throw e;return le(t,i)}return s.displayName="Lazy",s.__f=!0,s}function Et(){this.u=null,this.o=null}L.unmount=function(r){var e=r.__c;e&&e.__R&&e.__R(),e&&32&r.__u&&(r.type=null),xi&&xi(r)},(sr.prototype=new Re).__c=function(r,e){var t=e.__c,n=this;n.t==null&&(n.t=[]),n.t.push(t);var s=Oo(n.__v),i=!1,o=function(){i||(i=!0,t.__R=null,s?s(a):a())};t.__R=o;var a=function(){if(!--n.__u){if(n.state.__a){var c=n.state.__a;n.__v.__k[0]=Co(c,c.__c.__P,c.__c.__O)}var h;for(n.setState({__a:n.__b=null});h=n.t.pop();)h.forceUpdate()}};n.__u++||32&e.__u||n.setState({__a:n.__b=n.__v.__k[0]}),r.then(o,o)},sr.prototype.componentWillUnmount=function(){this.t=[]},sr.prototype.render=function(r,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Po(this.__b,t,n.__O=n.__P)}this.__b=null}var s=e.__a&&le(je,null,r.fallback);return s&&(s.__u&=-33),[le(je,null,e.__a?null:r.children),s]};var wi=function(r,e,t){if(++t[1]===t[0]&&r.o.delete(e),r.props.revealOrder&&(r.props.revealOrder[0]!=="t"||!r.o.size))for(t=r.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;r.u=t=t[2]}};function Pc(r){return this.getChildContext=function(){return r.context},r.children}function Cc(r){var e=this,t=r.i;e.componentWillUnmount=function(){hr(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],contains:function(){return!0},appendChild:function(n){this.childNodes.push(n),e.i.appendChild(n)},insertBefore:function(n,s){this.childNodes.push(n),e.i.appendChild(n)},removeChild:function(n){this.childNodes.splice(this.childNodes.indexOf(n)>>>1,1),e.i.removeChild(n)}}),hr(le(Pc,{context:e.context},r.__v),e.l)}function Io(r,e){var t=le(Cc,{__v:r,i:e});return t.containerInfo=e,t}(Et.prototype=new Re).__a=function(r){var e=this,t=Oo(e.__v),n=e.o.get(r);return n[0]++,function(s){var i=function(){e.props.revealOrder?(n.push(s),wi(e,r,n)):s()};t?t(i):i()}},Et.prototype.render=function(r){this.u=null,this.o=new Map;var e=ze(r.children);r.revealOrder&&r.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return r.children},Et.prototype.componentDidUpdate=Et.prototype.componentDidMount=function(){var r=this;this.o.forEach(function(e,t){wi(r,t,e)})};var To=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Oc=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Ac=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Ic=/[A-Z0-9]/g,Tc=typeof document<"u",Rc=function(r){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(r)};function ws(r,e,t){return e.__k==null&&(e.textContent=""),hr(r,e),typeof t=="function"&&t(),r?r.__c:null}function Ro(r,e,t){return vo(r,e),typeof t=="function"&&t(),r?r.__c:null}Re.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(r){Object.defineProperty(Re.prototype,r,{configurable:!0,get:function(){return this["UNSAFE_"+r]},set:function(e){Object.defineProperty(this,r,{configurable:!0,writable:!0,value:e})}})});var vi=L.event;function jc(){}function Mc(){return this.cancelBubble}function Nc(){return this.defaultPrevented}L.event=function(r){return vi&&(r=vi(r)),r.persist=jc,r.isPropagationStopped=Mc,r.isDefaultPrevented=Nc,r.nativeEvent=r};var vs,$c={enumerable:!1,configurable:!0,get:function(){return this.class}},Si=L.vnode;L.vnode=function(r){typeof r.type=="string"&&function(e){var t=e.props,n=e.type,s={},i=n.indexOf("-")===-1;for(var o in t){var a=t[o];if(!(o==="value"&&"defaultValue"in t&&a==null||Tc&&o==="children"&&n==="noscript"||o==="class"||o==="className")){var c=o.toLowerCase();o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&a===!0?a="":c==="translate"&&a==="no"?a=!1:c[0]==="o"&&c[1]==="n"?c==="ondoubleclick"?o="ondblclick":c!=="onchange"||n!=="input"&&n!=="textarea"||Rc(t.type)?c==="onfocus"?o="onfocusin":c==="onblur"?o="onfocusout":Ac.test(o)&&(o=c):c=o="oninput":i&&Oc.test(o)?o=o.replace(Ic,"-$&").toLowerCase():a===null&&(a=void 0),c==="oninput"&&s[o=c]&&(o="oninputCapture"),s[o]=a}}n=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=ze(t.children).forEach(function(h){h.props.selected=s.value.indexOf(h.props.value)!=-1})),n=="select"&&s.defaultValue!=null&&(s.value=ze(t.children).forEach(function(h){h.props.selected=s.multiple?s.defaultValue.indexOf(h.props.value)!=-1:s.defaultValue==h.props.value})),t.class&&!t.className?(s.class=t.class,Object.defineProperty(s,"className",$c)):(t.className&&!t.class||t.class&&t.className)&&(s.class=s.className=t.className),e.props=s}(r),r.$$typeof=To,Si&&Si(r)};var ki=L.__r;L.__r=function(r){ki&&ki(r),vs=r.__c};var Ei=L.diffed;L.diffed=function(r){Ei&&Ei(r);var e=r.props,t=r.__e;t!=null&&r.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value),vs=null};var jo={ReactCurrentDispatcher:{current:{readContext:function(r){return vs.__n[r.__c].props.value},useCallback:At,useContext:nn,useDebugValue:ms,useDeferredValue:Es,useEffect:yr,useId:bs,useImperativeHandle:_s,useInsertionEffect:Cs,useLayoutEffect:qt,useMemo:_t,useReducer:rn,useRef:Qe,useState:pt,useSyncExternalStore:Os,useTransition:Ps}}},Bc="18.3.1";function Mo(r){return le.bind(null,r)}function Wt(r){return!!r&&r.$$typeof===To}function No(r){return Wt(r)&&r.type===je}function $o(r){return!!r&&!!r.displayName&&(typeof r.displayName=="string"||r.displayName instanceof String)&&r.displayName.startsWith("Memo(")}function Ss(r){return Wt(r)?mc.apply(null,arguments):r}function Bo(r){return!!r.__k&&(hr(null,r),!0)}function Lo(r){return r&&(r.base||r.nodeType===1&&r)||null}var Uo=function(r,e){return r(e)},Fo=function(r,e){return r(e)},Do=je;function ks(r){r()}function Es(r){return r}function Ps(){return[!1,ks]}var Cs=qt,qo=Wt;function Os(r,e){var t=e(),n=pt({h:{__:t,v:e}}),s=n[0].h,i=n[1];return qt(function(){s.__=t,s.v=e,En(s)&&i({h:s})},[r,t,e]),yr(function(){return En(s)&&i({h:s}),r(function(){En(s)&&i({h:s})})},[r]),t}function En(r){var e,t,n=r.v,s=r.__;try{var i=n();return!((e=s)===(t=i)&&(e!==0||1/e==1/t)||e!=e&&t!=t)}catch{return!0}}var Lc={useState:pt,useId:bs,useReducer:rn,useEffect:yr,useLayoutEffect:qt,useInsertionEffect:Cs,useTransition:Ps,useDeferredValue:Es,useSyncExternalStore:Os,startTransition:ks,useRef:Qe,useImperativeHandle:_s,useMemo:_t,useCallback:At,useContext:nn,useDebugValue:ms,version:"18.3.1",Children:xs,render:ws,hydrate:Ro,unmountComponentAtNode:Bo,createPortal:Io,createElement:le,createContext:ps,createFactory:Mo,cloneElement:Ss,createRef:mo,Fragment:je,isValidElement:Wt,isElement:qo,isFragment:No,isMemo:$o,findDOMNode:Lo,Component:Re,PureComponent:Vr,memo:ys,forwardRef:Me,flushSync:Fo,unstable_batchedUpdates:Uo,StrictMode:Do,Suspense:sr,SuspenseList:Et,lazy:Ao,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:jo};const Uc=Object.freeze(Object.defineProperty({__proto__:null,Children:xs,Component:Re,Fragment:je,PureComponent:Vr,StrictMode:Do,Suspense:sr,SuspenseList:Et,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:jo,cloneElement:Ss,createContext:ps,createElement:le,createFactory:Mo,createPortal:Io,createRef:mo,default:Lc,findDOMNode:Lo,flushSync:Fo,forwardRef:Me,hydrate:Ro,isElement:qo,isFragment:No,isMemo:$o,isValidElement:Wt,lazy:Ao,memo:ys,render:ws,startTransition:ks,unmountComponentAtNode:Bo,unstable_batchedUpdates:Uo,useCallback:At,useContext:nn,useDebugValue:ms,useDeferredValue:Es,useEffect:yr,useErrorBoundary:wc,useId:bs,useImperativeHandle:_s,useInsertionEffect:Cs,useLayoutEffect:qt,useMemo:_t,useReducer:rn,useRef:Qe,useState:pt,useSyncExternalStore:Os,useTransition:Ps,version:Bc},Symbol.toStringTag,{value:"Module"})),Wo=xc(Uc);var Ho={exports:{}};/*!
 * Clamp.js 0.7.0
 * Based on: https://github.com/xavi160/Clamp.js/commit/e313818da231b8dd8fd603dd9c9a61a9d725c22f
 * Mixins:
 * - https://github.com/josephschmitt/Clamp.js/pull/50
 * - https://github.com/josephschmitt/Clamp.js/pull/49
 *
 * Copyright 2011-2013, Joseph Schmitt http://joe.sh
 * Released under the WTFPL license
 * http://sam.zoy.org/wtfpl/
 */(function(r,e){(function(t,n){r.exports=n()})(gc,function(){function t(n,s){s=s||{};var i=window,o={clamp:s.clamp||2,useNativeClamp:typeof s.useNativeClamp<"u"?s.useNativeClamp:!0,splitOnChars:s.splitOnChars||[".","-","–","—"," "],animate:s.animate||!1,truncationChar:s.truncationChar||"…",truncationHTML:s.truncationHTML},a=n.style,c=n.innerHTML,h=typeof n.style.webkitLineClamp<"u",m=o.clamp,p=m.indexOf&&(m.indexOf("px")>-1||m.indexOf("em")>-1),x;o.truncationHTML&&(x=document.createElement("span"),x.innerHTML=o.truncationHTML);function g(N,B){return i.getComputedStyle||(i.getComputedStyle=function(Q,we){return this.el=Q,this.getPropertyValue=function(se){var kr=/(\-([a-z]){1})/g;return se=="float"&&(se="styleFloat"),kr.test(se)&&(se=se.replace(kr,function(){return arguments[2].toUpperCase()})),Q.currentStyle&&Q.currentStyle[se]?Q.currentStyle[se]:null},this}),i.getComputedStyle(N,null).getPropertyValue(B)}function v(N){var B=N||n.parentNode.clientHeight-n.offsetTop,Q=M(n);return Math.max(Math.floor(B/Q),0)}function I(N){var B=M(n);return B*N}function M(N){var B=g(N,"line-height");return B=="normal"&&(B=parseFloat(g(N,"font-size"))*1.2),Math.round(parseFloat(B))}var j=o.splitOnChars.slice(0),C=j[0],D,ee;function Z(N){if(N.lastChild){if(N.lastChild.children&&N.lastChild.children.length>0)return Z(Array.prototype.slice.call(N.children).pop());if(!N.lastChild||!N.lastChild.nodeValue||N.lastChild.nodeValue==o.truncationChar||N.lastChild.nodeType===Node.COMMENT_NODE){var B=N.lastChild;do{if(!B)return;if(B.nodeType===3&&["",o.truncationChar].indexOf(B.nodeValue)===-1&&N.lastChild.nodeType!==Node.COMMENT_NODE)return B;if(B.lastChild){var Q=Z(B);if(Q)return Q}B.parentNode.removeChild(B)}while(B=B.previousSibling)}else return N.lastChild}}function ne(N,B){if(!N||!B)return;function Q(){j=o.splitOnChars.slice(0),C=j[0],D=null,ee=null}var we=N.nodeValue.replace(o.truncationChar,"");if(D||(j.length>0?C=j.shift():C="",D=we.split(C)),D.length>1?(ee=D.pop(),pe(N,D.join(C))):D=null,x&&(N.nodeValue=N.nodeValue.replace(o.truncationChar,""),n.innerHTML=N.nodeValue+" "+x.innerHTML+o.truncationChar),D){if(n.clientHeight<=B)if(j.length>=0&&C!=="")pe(N,D.join(C)+C+ee),D=null;else return n.innerHTML}else C===""&&(pe(N,""),N=Z(n),Q());if(o.animate)setTimeout(function(){ne(N,B)},o.animate===!0?10:o.animate);else return ne(N,B)}function pe(N,B){N.nodeValue=B+o.truncationChar}m=="auto"?m=v():p&&(m=v(parseInt(m,10)));var ae;if(h&&o.useNativeClamp)a.overflow="hidden",a.textOverflow="ellipsis",a.webkitBoxOrient="vertical",a.display="-webkit-box",a.webkitLineClamp=m,p&&(a.height=o.clamp+"px");else{var re=I(m);re<n.clientHeight&&(ae=ne(Z(n),re))}return{original:c,clamped:ae}}return t})})(Ho);var Fc=Ho.exports;/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Dc=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1};/*!
 * object.pick <https://github.com/jonschlinkert/object.pick>
 *
 * Copyright (c) 2014-2015 Jon Schlinkert, contributors.
 * Licensed under the MIT License
 */var qc=Dc,Wc=function(e,t){if(!qc(e)&&typeof e!="function")return{};var n={};if(typeof t=="string")return t in e&&(n[t]=e[t]),n;for(var s=t.length,i=-1;++i<s;){var o=t[i];o in e&&(n[o]=e[o])}return n},Vo={exports:{}},Hc="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Vc=Hc,zc=Vc;function zo(){}function Jo(){}Jo.resetWarningCache=zo;var Jc=function(){function r(n,s,i,o,a,c){if(c!==zc){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}r.isRequired=r;function e(){return r}var t={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:e,element:r,elementType:r,instanceOf:e,node:r,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Jo,resetWarningCache:zo};return t.PropTypes=t,t};Vo.exports=Jc();var Gc=Vo.exports,Go=Wo,Yc=Fc,Kc=Wc,qe=Gc,Yo=Wo;function Ne(){if(!(this instanceof Ne))throw new TypeError("Cannot call a class as a function");this.update=this.update.bind(this),this.getContainerRef=(function(r){this.container=r}).bind(this)}Ne.prototype=Object.create(Go.Component.prototype);Ne.prototype.componentDidMount=function(){window.addEventListener("resize",this.update,!1),window.addEventListener("load",this.update,!1),this.dotdotdot(Yo.findDOMNode(this.container))};Ne.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.update,!1),window.removeEventListener("load",this.update,!1)};Ne.prototype.componentDidUpdate=function(){this.dotdotdot(Yo.findDOMNode(this.container))};Ne.prototype.dotdotdot=function(r){if(r&&this.props.clamp){if(r.length)throw new Error("Please provide exacly one child to dotdotdot");Yc(r,Kc(this.props,["animate","clamp","splitOnChars","truncationChar","truncationHTML","useNativeClamp"]))}};Ne.prototype.update=function(){this.forceUpdate()};Ne.prototype.render=function(){return Go.createElement(this.props.tagName,{ref:this.getContainerRef,className:this.props.className},this.props.children)};Ne.propTypes={children:qe.node,clamp:qe.oneOfType([qe.string,qe.number,qe.bool]).isRequired,truncationChar:qe.string,useNativeClamp:qe.bool,className:qe.string,tagName:qe.string};Ne.defaultProps={truncationChar:"…",useNativeClamp:!1,tagName:"div"};var Xc=Ne;const Zc=yc(Xc);function zr(r){return typeof r=="object"&&r!=null&&!Array.isArray(r)}var Qc=r=>typeof r=="object"&&r!==null;function xr(r){return Object.fromEntries(Object.entries(r??{}).filter(([e,t])=>t!==void 0))}var el=r=>r==="base";function tl(r){return r.slice().filter(e=>!el(e))}function Pi(r){return String.fromCharCode(r+(r>25?39:97))}function rl(r){let e="",t;for(t=Math.abs(r);t>52;t=t/52|0)e=Pi(t%52)+e;return Pi(t%52)+e}function nl(r,e){let t=e.length;for(;t;)r=r*33^e.charCodeAt(--t);return r}function sl(r){return rl(nl(5381,r)>>>0)}var Ko=/\s*!(important)?/i;function il(r){return typeof r=="string"?Ko.test(r):!1}function ol(r){return typeof r=="string"?r.replace(Ko,"").trim():r}function As(r){return typeof r=="string"?r.replaceAll(" ","_"):r}var Xe=r=>{const e=new Map;return(...n)=>{const s=JSON.stringify(n);if(e.has(s))return e.get(s);const i=r(...n);return e.set(s,i),i}};function Is(...r){return r.reduce((e,t)=>(t&&Object.keys(t).forEach(n=>{const s=e[n],i=t[n];zr(s)&&zr(i)?e[n]=Is(s,i):e[n]=i}),e),{})}var al=r=>r!=null;function Ts(r,e,t={}){const{stop:n,getKey:s}=t;function i(o,a=[]){if(Qc(o)){const c={};for(const[h,m]of Object.entries(o)){const p=(s==null?void 0:s(h,m))??h,x=[...a,p];if(n!=null&&n(o,x))return e(o,a);const g=i(m,x);al(g)&&(c[p]=g)}return c}return e(o,a)}return i(r)}function cl(r,e){return Array.isArray(r)?r.map(t=>e(t)):zr(r)?Ts(r,t=>e(t)):e(r)}function ll(r,e){return r.reduce((t,n,s)=>{const i=e[s];return n!=null&&(t[i]=n),t},{})}function Xo(r,e,t=!0){const{utility:n,conditions:s}=e,{hasShorthand:i,resolveShorthand:o}=n;return Ts(r,a=>Array.isArray(a)?ll(a,s.breakpoints.keys):a,{stop:a=>Array.isArray(a),getKey:t?a=>i?o(a):a:void 0})}var ul={shift:r=>r,finalize:r=>r,breakpoints:{keys:[]}},hl=r=>typeof r=="string"?r.replaceAll(/[\n\s]+/g," "):r;function Zo(r){const{utility:e,hash:t,conditions:n=ul}=r,s=o=>[e.prefix,o].filter(Boolean).join("-"),i=(o,a)=>{let c;if(t){const h=[...n.finalize(o),a];c=s(e.toHash(h,sl))}else c=[...n.finalize(o),s(a)].join(":");return c};return Xe(({base:o,...a}={})=>{const c=Object.assign(a,o),h=Xo(c,r),m=new Set;return Ts(h,(p,x)=>{if(p==null)return;const g=il(p),[v,...I]=n.shift(x),M=tl(I),j=e.transform(v,ol(hl(p)));let C=i(M,j.className);g&&(C=`${C}!`),m.add(C)}),Array.from(m).join(" ")})}function dl(...r){return r.flat().filter(e=>zr(e)&&Object.keys(xr(e)).length>0)}function fl(r){function e(s){const i=dl(...s);return i.length===1?i:i.map(o=>Xo(o,r))}function t(...s){return Is(...e(s))}function n(...s){return Object.assign({},...e(s))}return{mergeCss:Xe(t),assignCss:n}}var pl=/([A-Z])/g,_l=/^ms-/,ml=Xe(r=>r.startsWith("--")?r:r.replace(pl,"-$1").replace(_l,"-ms-").toLowerCase()),bl=["min","max","clamp","calc"],gl=new RegExp(`^(${bl.join("|")})\\(.*\\)`),yl=r=>typeof r=="string"&&gl.test(r),xl="cm,mm,Q,in,pc,pt,px,em,ex,ch,rem,lh,rlh,vw,vh,vmin,vmax,vb,vi,svw,svh,lvw,lvh,dvw,dvh,cqw,cqh,cqi,cqb,cqmin,cqmax,%",wl=`(?:${xl.split(",").join("|")})`,vl=new RegExp(`^[+-]?[0-9]*.?[0-9]+(?:[eE][+-]?[0-9]+)?${wl}$`),Sl=r=>typeof r=="string"&&vl.test(r),kl=r=>typeof r=="string"&&/^var\(--.+\)$/.test(r),El={map:cl,isCssFunction:yl,isCssVar:kl,isCssUnit:Sl},Pl=(r,e)=>{if(!(r!=null&&r.defaultValues))return e;const t=typeof r.defaultValues=="function"?r.defaultValues(e):r.defaultValues;return Object.assign({},t,xr(e))},Cl=(r,e)=>r.filter(t=>t.css[e]).map(t=>({...t,css:t.css[e]}));function ot(r,...e){const t=Object.getOwnPropertyDescriptors(r),n=Object.keys(t),s=o=>{const a={};for(let c=0;c<o.length;c++){const h=o[c];t[h]&&(Object.defineProperty(a,h,t[h]),delete t[h])}return a},i=o=>s(Array.isArray(o)?o:n.filter(o));return e.map(i).concat(s(n))}var Yn=(...r)=>{const e=r.reduce((t,n)=>(n&&n.forEach(s=>t.add(s)),t),new Set([]));return Array.from(e)},Qo=["htmlSize","htmlTranslate","htmlWidth","htmlHeight"];function Ol(r){return Qo.includes(r)?r.replace("html","").toLowerCase():r}function Kn(r){return Object.fromEntries(Object.entries(r).map(([e,t])=>[Ol(e),t]))}Kn.keys=Qo;const Al="_hover,_focus,_focusWithin,_focusVisible,_disabled,_active,_visited,_target,_readOnly,_readWrite,_empty,_checked,_enabled,_expanded,_highlighted,_before,_after,_firstLetter,_firstLine,_marker,_selection,_file,_backdrop,_first,_last,_only,_even,_odd,_firstOfType,_lastOfType,_onlyOfType,_peerFocus,_peerHover,_peerActive,_peerFocusWithin,_peerFocusVisible,_peerDisabled,_peerChecked,_peerInvalid,_peerExpanded,_peerPlaceholderShown,_groupFocus,_groupHover,_groupActive,_groupFocusWithin,_groupFocusVisible,_groupDisabled,_groupChecked,_groupExpanded,_groupInvalid,_indeterminate,_required,_valid,_invalid,_autofill,_inRange,_outOfRange,_placeholder,_placeholderShown,_pressed,_selected,_default,_optional,_open,_closed,_fullscreen,_loading,_currentPage,_currentStep,_motionReduce,_motionSafe,_print,_landscape,_portrait,_dark,_light,_osDark,_osLight,_highContrast,_lessContrast,_moreContrast,_ltr,_rtl,_scrollbar,_scrollbarThumb,_scrollbarTrack,_horizontal,_vertical,_starting,_collapsed,_current,_hidden,_off,_on,_today,_underValue,sm,smOnly,smDown,md,mdOnly,mdDown,lg,lgOnly,lgDown,xl,xlOnly,xlDown,2xl,2xlOnly,2xlDown,smToMd,smToLg,smToXl,smTo2xl,mdToLg,mdToXl,mdTo2xl,lgToXl,lgTo2xl,xlTo2xl,base",ea=new Set(Al.split(",")),Il=/^@|&|&$/;function Ci(r){return ea.has(r)||Il.test(r)}const Tl=/^_/,Rl=/&|@/;function ta(r){return r.map(e=>ea.has(e)?e.replace(Tl,""):Rl.test(e)?`[${As(e.trim())}]`:e)}function ra(r){return r.sort((e,t)=>{const n=Ci(e),s=Ci(t);return n&&!s?1:!n&&s?-1:0})}const jl="aspectRatio:asp,boxDecorationBreak:bx-db,zIndex:z,boxSizing:bx-s,objectPosition:obj-p,objectFit:obj-f,overscrollBehavior:ovs-b,overscrollBehaviorX:ovs-bx,overscrollBehaviorY:ovs-by,position:pos/1,top:top,left:left,inset:inset,insetInline:inset-x/insetX,insetBlock:inset-y/insetY,insetBlockEnd:inset-be,insetBlockStart:inset-bs,insetInlineEnd:inset-e/insetEnd/end,insetInlineStart:inset-s/insetStart/start,right:right,bottom:bottom,float:float,visibility:vis,display:d,hideFrom:hide,hideBelow:show,flexBasis:flex-b,flex:flex,flexDirection:flex-d/flexDir,flexGrow:flex-g,flexShrink:flex-sh,gridTemplateColumns:grid-tc,gridTemplateRows:grid-tr,gridColumn:grid-c,gridRow:grid-r,gridColumnStart:grid-cs,gridColumnEnd:grid-ce,gridAutoFlow:grid-af,gridAutoColumns:grid-ac,gridAutoRows:grid-ar,gap:gap,gridGap:grid-g,gridRowGap:grid-rg,gridColumnGap:grid-cg,rowGap:rg,columnGap:cg,justifyContent:jc,alignContent:ac,alignItems:ai,alignSelf:as,padding:p/1,paddingLeft:pl/1,paddingRight:pr/1,paddingTop:pt/1,paddingBottom:pb/1,paddingBlock:py/1/paddingY,paddingBlockEnd:pbe,paddingBlockStart:pbs,paddingInline:px/paddingX/1,paddingInlineEnd:pe/1/paddingEnd,paddingInlineStart:ps/1/paddingStart,marginLeft:ml/1,marginRight:mr/1,marginTop:mt/1,marginBottom:mb/1,margin:m/1,marginBlock:my/1/marginY,marginBlockEnd:mbe,marginBlockStart:mbs,marginInline:mx/1/marginX,marginInlineEnd:me/1/marginEnd,marginInlineStart:ms/1/marginStart,spaceX:sx,spaceY:sy,outlineWidth:ring-w/ringWidth,outlineColor:ring-c/ringColor,outline:ring/1,outlineOffset:ring-o/ringOffset,divideX:dvd-x,divideY:dvd-y,divideColor:dvd-c,divideStyle:dvd-s,width:w/1,inlineSize:w-is,minWidth:min-w/minW,minInlineSize:min-w-is,maxWidth:max-w/maxW,maxInlineSize:max-w-is,height:h/1,blockSize:h-bs,minHeight:min-h/minH,minBlockSize:min-h-bs,maxHeight:max-h/maxH,maxBlockSize:max-b,color:c,fontFamily:ff,fontSize:fs,fontSizeAdjust:fs-a,fontPalette:fp,fontKerning:fk,fontFeatureSettings:ff-s,fontWeight:fw,fontSmoothing:fsmt,fontVariant:fv,fontVariantAlternates:fv-alt,fontVariantCaps:fv-caps,fontVariationSettings:fv-s,fontVariantNumeric:fv-num,letterSpacing:ls,lineHeight:lh,textAlign:ta,textDecoration:td,textDecorationColor:td-c,textEmphasisColor:te-c,textDecorationStyle:td-s,textDecorationThickness:td-t,textUnderlineOffset:tu-o,textTransform:tt,textIndent:ti,textShadow:tsh,textShadowColor:tsh-c/textShadowColor,textOverflow:tov,verticalAlign:va,wordBreak:wb,textWrap:tw,truncate:trunc,lineClamp:lc,listStyleType:li-t,listStylePosition:li-pos,listStyleImage:li-img,listStyle:li-s,backgroundPosition:bg-p/bgPosition,backgroundPositionX:bg-p-x/bgPositionX,backgroundPositionY:bg-p-y/bgPositionY,backgroundAttachment:bg-a/bgAttachment,backgroundClip:bg-cp/bgClip,background:bg/1,backgroundColor:bg-c/bgColor,backgroundOrigin:bg-o/bgOrigin,backgroundImage:bg-i/bgImage,backgroundRepeat:bg-r/bgRepeat,backgroundBlendMode:bg-bm/bgBlendMode,backgroundSize:bg-s/bgSize,backgroundGradient:bg-grad/bgGradient,textGradient:txt-grad,gradientFromPosition:grad-from-pos,gradientToPosition:grad-to-pos,gradientFrom:grad-from,gradientTo:grad-to,gradientVia:grad-via,gradientViaPosition:grad-via-pos,borderRadius:bdr/rounded,borderTopLeftRadius:bdr-tl/roundedTopLeft,borderTopRightRadius:bdr-tr/roundedTopRight,borderBottomRightRadius:bdr-br/roundedBottomRight,borderBottomLeftRadius:bdr-bl/roundedBottomLeft,borderTopRadius:bdr-t/roundedTop,borderRightRadius:bdr-r/roundedRight,borderBottomRadius:bdr-b/roundedBottom,borderLeftRadius:bdr-l/roundedLeft,borderStartStartRadius:bdr-ss/roundedStartStart,borderStartEndRadius:bdr-se/roundedStartEnd,borderStartRadius:bdr-s/roundedStart,borderEndStartRadius:bdr-es/roundedEndStart,borderEndEndRadius:bdr-ee/roundedEndEnd,borderEndRadius:bdr-e/roundedEnd,border:bd,borderWidth:bd-w,borderTopWidth:bd-t-w,borderLeftWidth:bd-l-w,borderRightWidth:bd-r-w,borderBottomWidth:bd-b-w,borderColor:bd-c,borderInline:bd-x/borderX,borderInlineWidth:bd-x-w/borderXWidth,borderInlineColor:bd-x-c/borderXColor,borderBlock:bd-y/borderY,borderBlockWidth:bd-y-w/borderYWidth,borderBlockColor:bd-y-c/borderYColor,borderLeft:bd-l,borderLeftColor:bd-l-c,borderInlineStart:bd-s/borderStart,borderInlineStartWidth:bd-s-w/borderStartWidth,borderInlineStartColor:bd-s-c/borderStartColor,borderRight:bd-r,borderRightColor:bd-r-c,borderInlineEnd:bd-e/borderEnd,borderInlineEndWidth:bd-e-w/borderEndWidth,borderInlineEndColor:bd-e-c/borderEndColor,borderTop:bd-t,borderTopColor:bd-t-c,borderBottom:bd-b,borderBottomColor:bd-b-c,borderBlockEnd:bd-be,borderBlockEndColor:bd-be-c,borderBlockStart:bd-bs,borderBlockStartColor:bd-bs-c,opacity:op,boxShadow:bx-sh/shadow,boxShadowColor:bx-sh-c/shadowColor,mixBlendMode:mix-bm,filter:filter,brightness:brightness,contrast:contrast,grayscale:grayscale,hueRotate:hue-rotate,invert:invert,saturate:saturate,sepia:sepia,dropShadow:drop-shadow,blur:blur,backdropFilter:bkdp,backdropBlur:bkdp-blur,backdropBrightness:bkdp-brightness,backdropContrast:bkdp-contrast,backdropGrayscale:bkdp-grayscale,backdropHueRotate:bkdp-hue-rotate,backdropInvert:bkdp-invert,backdropOpacity:bkdp-opacity,backdropSaturate:bkdp-saturate,backdropSepia:bkdp-sepia,borderCollapse:bd-cl,borderSpacing:bd-sp,borderSpacingX:bd-sx,borderSpacingY:bd-sy,tableLayout:tbl,transitionTimingFunction:trs-tmf,transitionDelay:trs-dly,transitionDuration:trs-dur,transitionProperty:trs-prop,transition:trs,animation:anim,animationName:anim-n,animationTimingFunction:anim-tmf,animationDuration:anim-dur,animationDelay:anim-dly,animationPlayState:anim-ps,animationComposition:anim-comp,animationFillMode:anim-fm,animationDirection:anim-dir,animationIterationCount:anim-ic,animationRange:anim-r,animationState:anim-s,animationRangeStart:anim-rs,animationRangeEnd:anim-re,animationTimeline:anim-tl,transformOrigin:trf-o,transformBox:trf-b,transformStyle:trf-s,transform:trf,rotate:rotate,rotateX:rotate-x,rotateY:rotate-y,rotateZ:rotate-z,scale:scale,scaleX:scale-x,scaleY:scale-y,translate:translate,translateX:translate-x/x,translateY:translate-y/y,translateZ:translate-z/z,accentColor:ac-c,caretColor:ca-c,scrollBehavior:scr-bhv,scrollbar:scr-bar,scrollbarColor:scr-bar-c,scrollbarGutter:scr-bar-g,scrollbarWidth:scr-bar-w,scrollMargin:scr-m,scrollMarginLeft:scr-ml,scrollMarginRight:scr-mr,scrollMarginTop:scr-mt,scrollMarginBottom:scr-mb,scrollMarginBlock:scr-my/scrollMarginY,scrollMarginBlockEnd:scr-mbe,scrollMarginBlockStart:scr-mbt,scrollMarginInline:scr-mx/scrollMarginX,scrollMarginInlineEnd:scr-me,scrollMarginInlineStart:scr-ms,scrollPadding:scr-p,scrollPaddingBlock:scr-py/scrollPaddingY,scrollPaddingBlockStart:scr-pbs,scrollPaddingBlockEnd:scr-pbe,scrollPaddingInline:scr-px/scrollPaddingX,scrollPaddingInlineEnd:scr-pe,scrollPaddingInlineStart:scr-ps,scrollPaddingLeft:scr-pl,scrollPaddingRight:scr-pr,scrollPaddingTop:scr-pt,scrollPaddingBottom:scr-pb,scrollSnapAlign:scr-sa,scrollSnapStop:scrs-s,scrollSnapType:scrs-t,scrollSnapStrictness:scrs-strt,scrollSnapMargin:scrs-m,scrollSnapMarginTop:scrs-mt,scrollSnapMarginBottom:scrs-mb,scrollSnapMarginLeft:scrs-ml,scrollSnapMarginRight:scrs-mr,scrollSnapCoordinate:scrs-c,scrollSnapDestination:scrs-d,scrollSnapPointsX:scrs-px,scrollSnapPointsY:scrs-py,scrollSnapTypeX:scrs-tx,scrollSnapTypeY:scrs-ty,scrollTimeline:scrtl,scrollTimelineAxis:scrtl-a,scrollTimelineName:scrtl-n,touchAction:tch-a,userSelect:us,overflow:ov,overflowWrap:ov-wrap,overflowX:ov-x,overflowY:ov-y,overflowAnchor:ov-a,overflowBlock:ov-b,overflowInline:ov-i,overflowClipBox:ovcp-bx,overflowClipMargin:ovcp-m,overscrollBehaviorBlock:ovs-bb,overscrollBehaviorInline:ovs-bi,fill:fill,stroke:stk,strokeWidth:stk-w,strokeDasharray:stk-dsh,strokeDashoffset:stk-do,strokeLinecap:stk-lc,strokeLinejoin:stk-lj,strokeMiterlimit:stk-ml,strokeOpacity:stk-op,srOnly:sr,debug:debug,appearance:ap,backfaceVisibility:bfv,clipPath:cp-path,hyphens:hy,mask:msk,maskImage:msk-i,maskSize:msk-s,textSizeAdjust:txt-adj,container:cq,containerName:cq-n,containerType:cq-t,textStyle:textStyle",na=new Map,sa=new Map;jl.split(",").forEach(r=>{const[e,t]=r.split(":"),[n,...s]=t.split("/");na.set(e,n),s.length&&s.forEach(i=>{sa.set(i==="1"?n:i,e)})});const Oi=r=>sa.get(r)||r,ia={conditions:{shift:ra,finalize:ta,breakpoints:{keys:["base","sm","md","lg","xl","2xl"]}},utility:{transform:(r,e)=>{const t=Oi(r);return{className:`${na.get(t)||ml(t)}_${As(e)}`}},hasShorthand:!0,toHash:(r,e)=>e(r.join(":")),resolveShorthand:Oi}},Ml=Zo(ia),dr=(...r)=>Ml(ht(...r));dr.raw=(...r)=>ht(...r);const{mergeCss:ht,assignCss:Ff}=fl(ia);function $t(){let r="",e=0,t;for(;e<arguments.length;)(t=arguments[e++])&&typeof t=="string"&&(r&&(r+=" "),r+=t);return r}const Ai=r=>({base:{},variants:{},defaultVariants:{},compoundVariants:[],...r});function oa(r){const{base:e,variants:t,defaultVariants:n,compoundVariants:s}=Ai(r),i=x=>({...n,...xr(x)});function o(x={}){var M;const g=i(x);let v={...e};for(const[j,C]of Object.entries(g))(M=t[j])!=null&&M[C]&&(v=ht(v,t[j][C]));const I=Xn(s,g);return ht(v,I)}function a(x){const g=Ai(x.config),v=Yn(x.variantKeys,Object.keys(t));return oa({base:ht(e,g.base),variants:Object.fromEntries(v.map(I=>[I,ht(t[I],g.variants[I])])),defaultVariants:Is(n,g.defaultVariants),compoundVariants:[...s,...g.compoundVariants]})}function c(x){return dr(o(x))}const h=Object.keys(t);function m(x){return ot(x,h)}const p=Object.fromEntries(Object.entries(t).map(([x,g])=>[x,Object.keys(g)]));return Object.assign(Xe(c),{__cva__:!0,variantMap:p,variantKeys:h,raw:o,config:r,merge:a,splitVariantProps:m,getVariantProps:i})}function Xn(r,e){let t={};return r.forEach(n=>{Object.entries(n).every(([i,o])=>i==="css"?!0:(Array.isArray(o)?o:[o]).some(c=>e[i]===c))&&(t=ht(t,n.css))}),t}function Nl(r,e,t,n){if(e.length>0&&typeof(t==null?void 0:t[n])=="object")throw new Error(`[recipe:${r}:${n}] Conditions are not supported when using compound variants.`)}var $l="css,pos,insetX,insetY,insetEnd,end,insetStart,start,flexDir,p,pl,pr,pt,pb,py,paddingY,paddingX,px,pe,paddingEnd,ps,paddingStart,ml,mr,mt,mb,m,my,marginY,mx,marginX,me,marginEnd,ms,marginStart,ringWidth,ringColor,ring,ringOffset,w,minW,maxW,h,minH,maxH,textShadowColor,bgPosition,bgPositionX,bgPositionY,bgAttachment,bgClip,bg,bgColor,bgOrigin,bgImage,bgRepeat,bgBlendMode,bgSize,bgGradient,rounded,roundedTopLeft,roundedTopRight,roundedBottomRight,roundedBottomLeft,roundedTop,roundedRight,roundedBottom,roundedLeft,roundedStartStart,roundedStartEnd,roundedStart,roundedEndStart,roundedEndEnd,roundedEnd,borderX,borderXWidth,borderXColor,borderY,borderYWidth,borderYColor,borderStart,borderStartWidth,borderStartColor,borderEnd,borderEndWidth,borderEndColor,shadow,shadowColor,x,y,z,scrollMarginY,scrollMarginX,scrollPaddingY,scrollPaddingX,aspectRatio,boxDecorationBreak,zIndex,boxSizing,objectPosition,objectFit,overscrollBehavior,overscrollBehaviorX,overscrollBehaviorY,position,top,left,inset,insetInline,insetBlock,insetBlockEnd,insetBlockStart,insetInlineEnd,insetInlineStart,right,bottom,float,visibility,display,hideFrom,hideBelow,flexBasis,flex,flexDirection,flexGrow,flexShrink,gridTemplateColumns,gridTemplateRows,gridColumn,gridRow,gridColumnStart,gridColumnEnd,gridAutoFlow,gridAutoColumns,gridAutoRows,gap,gridGap,gridRowGap,gridColumnGap,rowGap,columnGap,justifyContent,alignContent,alignItems,alignSelf,padding,paddingLeft,paddingRight,paddingTop,paddingBottom,paddingBlock,paddingBlockEnd,paddingBlockStart,paddingInline,paddingInlineEnd,paddingInlineStart,marginLeft,marginRight,marginTop,marginBottom,margin,marginBlock,marginBlockEnd,marginBlockStart,marginInline,marginInlineEnd,marginInlineStart,spaceX,spaceY,outlineWidth,outlineColor,outline,outlineOffset,divideX,divideY,divideColor,divideStyle,width,inlineSize,minWidth,minInlineSize,maxWidth,maxInlineSize,height,blockSize,minHeight,minBlockSize,maxHeight,maxBlockSize,color,fontFamily,fontSize,fontSizeAdjust,fontPalette,fontKerning,fontFeatureSettings,fontWeight,fontSmoothing,fontVariant,fontVariantAlternates,fontVariantCaps,fontVariationSettings,fontVariantNumeric,letterSpacing,lineHeight,textAlign,textDecoration,textDecorationColor,textEmphasisColor,textDecorationStyle,textDecorationThickness,textUnderlineOffset,textTransform,textIndent,textShadow,textOverflow,verticalAlign,wordBreak,textWrap,truncate,lineClamp,listStyleType,listStylePosition,listStyleImage,listStyle,backgroundPosition,backgroundPositionX,backgroundPositionY,backgroundAttachment,backgroundClip,background,backgroundColor,backgroundOrigin,backgroundImage,backgroundRepeat,backgroundBlendMode,backgroundSize,backgroundGradient,textGradient,gradientFromPosition,gradientToPosition,gradientFrom,gradientTo,gradientVia,gradientViaPosition,borderRadius,borderTopLeftRadius,borderTopRightRadius,borderBottomRightRadius,borderBottomLeftRadius,borderTopRadius,borderRightRadius,borderBottomRadius,borderLeftRadius,borderStartStartRadius,borderStartEndRadius,borderStartRadius,borderEndStartRadius,borderEndEndRadius,borderEndRadius,border,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,borderColor,borderInline,borderInlineWidth,borderInlineColor,borderBlock,borderBlockWidth,borderBlockColor,borderLeft,borderLeftColor,borderInlineStart,borderInlineStartWidth,borderInlineStartColor,borderRight,borderRightColor,borderInlineEnd,borderInlineEndWidth,borderInlineEndColor,borderTop,borderTopColor,borderBottom,borderBottomColor,borderBlockEnd,borderBlockEndColor,borderBlockStart,borderBlockStartColor,opacity,boxShadow,boxShadowColor,mixBlendMode,filter,brightness,contrast,grayscale,hueRotate,invert,saturate,sepia,dropShadow,blur,backdropFilter,backdropBlur,backdropBrightness,backdropContrast,backdropGrayscale,backdropHueRotate,backdropInvert,backdropOpacity,backdropSaturate,backdropSepia,borderCollapse,borderSpacing,borderSpacingX,borderSpacingY,tableLayout,transitionTimingFunction,transitionDelay,transitionDuration,transitionProperty,transition,animation,animationName,animationTimingFunction,animationDuration,animationDelay,animationPlayState,animationComposition,animationFillMode,animationDirection,animationIterationCount,animationRange,animationState,animationRangeStart,animationRangeEnd,animationTimeline,transformOrigin,transformBox,transformStyle,transform,rotate,rotateX,rotateY,rotateZ,scale,scaleX,scaleY,translate,translateX,translateY,translateZ,accentColor,caretColor,scrollBehavior,scrollbar,scrollbarColor,scrollbarGutter,scrollbarWidth,scrollMargin,scrollMarginLeft,scrollMarginRight,scrollMarginTop,scrollMarginBottom,scrollMarginBlock,scrollMarginBlockEnd,scrollMarginBlockStart,scrollMarginInline,scrollMarginInlineEnd,scrollMarginInlineStart,scrollPadding,scrollPaddingBlock,scrollPaddingBlockStart,scrollPaddingBlockEnd,scrollPaddingInline,scrollPaddingInlineEnd,scrollPaddingInlineStart,scrollPaddingLeft,scrollPaddingRight,scrollPaddingTop,scrollPaddingBottom,scrollSnapAlign,scrollSnapStop,scrollSnapType,scrollSnapStrictness,scrollSnapMargin,scrollSnapMarginTop,scrollSnapMarginBottom,scrollSnapMarginLeft,scrollSnapMarginRight,scrollSnapCoordinate,scrollSnapDestination,scrollSnapPointsX,scrollSnapPointsY,scrollSnapTypeX,scrollSnapTypeY,scrollTimeline,scrollTimelineAxis,scrollTimelineName,touchAction,userSelect,overflow,overflowWrap,overflowX,overflowY,overflowAnchor,overflowBlock,overflowInline,overflowClipBox,overflowClipMargin,overscrollBehaviorBlock,overscrollBehaviorInline,fill,stroke,strokeWidth,strokeDasharray,strokeDashoffset,strokeLinecap,strokeLinejoin,strokeMiterlimit,strokeOpacity,srOnly,debug,appearance,backfaceVisibility,clipPath,hyphens,mask,maskImage,maskSize,textSizeAdjust,container,containerName,containerType,colorPalette,_hover,_focus,_focusWithin,_focusVisible,_disabled,_active,_visited,_target,_readOnly,_readWrite,_empty,_checked,_enabled,_expanded,_highlighted,_before,_after,_firstLetter,_firstLine,_marker,_selection,_file,_backdrop,_first,_last,_only,_even,_odd,_firstOfType,_lastOfType,_onlyOfType,_peerFocus,_peerHover,_peerActive,_peerFocusWithin,_peerFocusVisible,_peerDisabled,_peerChecked,_peerInvalid,_peerExpanded,_peerPlaceholderShown,_groupFocus,_groupHover,_groupActive,_groupFocusWithin,_groupFocusVisible,_groupDisabled,_groupChecked,_groupExpanded,_groupInvalid,_indeterminate,_required,_valid,_invalid,_autofill,_inRange,_outOfRange,_placeholder,_placeholderShown,_pressed,_selected,_default,_optional,_open,_closed,_fullscreen,_loading,_currentPage,_currentStep,_motionReduce,_motionSafe,_print,_landscape,_portrait,_dark,_light,_osDark,_osLight,_highContrast,_lessContrast,_moreContrast,_ltr,_rtl,_scrollbar,_scrollbarThumb,_scrollbarTrack,_horizontal,_vertical,_starting,_collapsed,_current,_hidden,_off,_on,_today,_underValue,sm,smOnly,smDown,md,mdOnly,mdDown,lg,lgOnly,lgDown,xl,xlOnly,xlDown,2xl,2xlOnly,2xlDown,smToMd,smToLg,smToXl,smTo2xl,mdToLg,mdToXl,mdTo2xl,lgToXl,lgTo2xl,xlTo2xl,textStyle",Bl=$l.split(","),Ll="WebkitAppearance,WebkitBorderBefore,WebkitBorderBeforeColor,WebkitBorderBeforeStyle,WebkitBorderBeforeWidth,WebkitBoxReflect,WebkitLineClamp,WebkitMask,WebkitMaskAttachment,WebkitMaskClip,WebkitMaskComposite,WebkitMaskImage,WebkitMaskOrigin,WebkitMaskPosition,WebkitMaskPositionX,WebkitMaskPositionY,WebkitMaskRepeat,WebkitMaskRepeatX,WebkitMaskRepeatY,WebkitMaskSize,WebkitOverflowScrolling,WebkitTapHighlightColor,WebkitTextFillColor,WebkitTextStroke,WebkitTextStrokeColor,WebkitTextStrokeWidth,WebkitTouchCallout,WebkitUserModify,accentColor,alignContent,alignItems,alignSelf,alignTracks,all,animation,animationComposition,animationDelay,animationDirection,animationDuration,animationFillMode,animationIterationCount,animationName,animationPlayState,animationRange,animationRangeEnd,animationRangeStart,animationTimingFunction,animationTimeline,appearance,aspectRatio,azimuth,backdropFilter,backfaceVisibility,background,backgroundAttachment,backgroundBlendMode,backgroundClip,backgroundColor,backgroundImage,backgroundOrigin,backgroundPosition,backgroundPositionX,backgroundPositionY,backgroundRepeat,backgroundSize,blockSize,border,borderBlock,borderBlockColor,borderBlockStyle,borderBlockWidth,borderBlockEnd,borderBlockEndColor,borderBlockEndStyle,borderBlockEndWidth,borderBlockStart,borderBlockStartColor,borderBlockStartStyle,borderBlockStartWidth,borderBottom,borderBottomColor,borderBottomLeftRadius,borderBottomRightRadius,borderBottomStyle,borderBottomWidth,borderCollapse,borderColor,borderEndEndRadius,borderEndStartRadius,borderImage,borderImageOutset,borderImageRepeat,borderImageSlice,borderImageSource,borderImageWidth,borderInline,borderInlineEnd,borderInlineColor,borderInlineStyle,borderInlineWidth,borderInlineEndColor,borderInlineEndStyle,borderInlineEndWidth,borderInlineStart,borderInlineStartColor,borderInlineStartStyle,borderInlineStartWidth,borderLeft,borderLeftColor,borderLeftStyle,borderLeftWidth,borderRadius,borderRight,borderRightColor,borderRightStyle,borderRightWidth,borderSpacing,borderStartEndRadius,borderStartStartRadius,borderStyle,borderTop,borderTopColor,borderTopLeftRadius,borderTopRightRadius,borderTopStyle,borderTopWidth,borderWidth,bottom,boxAlign,boxDecorationBreak,boxDirection,boxFlex,boxFlexGroup,boxLines,boxOrdinalGroup,boxOrient,boxPack,boxShadow,boxSizing,breakAfter,breakBefore,breakInside,captionSide,caret,caretColor,caretShape,clear,clip,clipPath,color,colorScheme,columnCount,columnFill,columnGap,columnRule,columnRuleColor,columnRuleStyle,columnRuleWidth,columnSpan,columnWidth,columns,contain,containIntrinsicSize,containIntrinsicBlockSize,containIntrinsicHeight,containIntrinsicInlineSize,containIntrinsicWidth,container,containerName,containerType,content,contentVisibility,counterIncrement,counterReset,counterSet,cursor,direction,display,emptyCells,filter,flex,flexBasis,flexDirection,flexFlow,flexGrow,flexShrink,flexWrap,float,font,fontFamily,fontFeatureSettings,fontKerning,fontLanguageOverride,fontOpticalSizing,fontPalette,fontVariationSettings,fontSize,fontSizeAdjust,fontSmooth,fontStretch,fontStyle,fontSynthesis,fontSynthesisPosition,fontSynthesisSmallCaps,fontSynthesisStyle,fontSynthesisWeight,fontVariant,fontVariantAlternates,fontVariantCaps,fontVariantEastAsian,fontVariantEmoji,fontVariantLigatures,fontVariantNumeric,fontVariantPosition,fontWeight,forcedColorAdjust,gap,grid,gridArea,gridAutoColumns,gridAutoFlow,gridAutoRows,gridColumn,gridColumnEnd,gridColumnGap,gridColumnStart,gridGap,gridRow,gridRowEnd,gridRowGap,gridRowStart,gridTemplate,gridTemplateAreas,gridTemplateColumns,gridTemplateRows,hangingPunctuation,height,hyphenateCharacter,hyphenateLimitChars,hyphens,imageOrientation,imageRendering,imageResolution,imeMode,initialLetter,initialLetterAlign,inlineSize,inputSecurity,inset,insetBlock,insetBlockEnd,insetBlockStart,insetInline,insetInlineEnd,insetInlineStart,isolation,justifyContent,justifyItems,justifySelf,justifyTracks,left,letterSpacing,lineBreak,lineClamp,lineHeight,lineHeightStep,listStyle,listStyleImage,listStylePosition,listStyleType,margin,marginBlock,marginBlockEnd,marginBlockStart,marginBottom,marginInline,marginInlineEnd,marginInlineStart,marginLeft,marginRight,marginTop,marginTrim,mask,maskBorder,maskBorderMode,maskBorderOutset,maskBorderRepeat,maskBorderSlice,maskBorderSource,maskBorderWidth,maskClip,maskComposite,maskImage,maskMode,maskOrigin,maskPosition,maskRepeat,maskSize,maskType,masonryAutoFlow,mathDepth,mathShift,mathStyle,maxBlockSize,maxHeight,maxInlineSize,maxLines,maxWidth,minBlockSize,minHeight,minInlineSize,minWidth,mixBlendMode,objectFit,objectPosition,offset,offsetAnchor,offsetDistance,offsetPath,offsetPosition,offsetRotate,opacity,order,orphans,outline,outlineColor,outlineOffset,outlineStyle,outlineWidth,overflow,overflowAnchor,overflowBlock,overflowClipBox,overflowClipMargin,overflowInline,overflowWrap,overflowX,overflowY,overlay,overscrollBehavior,overscrollBehaviorBlock,overscrollBehaviorInline,overscrollBehaviorX,overscrollBehaviorY,padding,paddingBlock,paddingBlockEnd,paddingBlockStart,paddingBottom,paddingInline,paddingInlineEnd,paddingInlineStart,paddingLeft,paddingRight,paddingTop,page,pageBreakAfter,pageBreakBefore,pageBreakInside,paintOrder,perspective,perspectiveOrigin,placeContent,placeItems,placeSelf,pointerEvents,position,printColorAdjust,quotes,resize,right,rotate,rowGap,rubyAlign,rubyMerge,rubyPosition,scale,scrollbarColor,scrollbarGutter,scrollbarWidth,scrollBehavior,scrollMargin,scrollMarginBlock,scrollMarginBlockStart,scrollMarginBlockEnd,scrollMarginBottom,scrollMarginInline,scrollMarginInlineStart,scrollMarginInlineEnd,scrollMarginLeft,scrollMarginRight,scrollMarginTop,scrollPadding,scrollPaddingBlock,scrollPaddingBlockStart,scrollPaddingBlockEnd,scrollPaddingBottom,scrollPaddingInline,scrollPaddingInlineStart,scrollPaddingInlineEnd,scrollPaddingLeft,scrollPaddingRight,scrollPaddingTop,scrollSnapAlign,scrollSnapCoordinate,scrollSnapDestination,scrollSnapPointsX,scrollSnapPointsY,scrollSnapStop,scrollSnapType,scrollSnapTypeX,scrollSnapTypeY,scrollTimeline,scrollTimelineAxis,scrollTimelineName,shapeImageThreshold,shapeMargin,shapeOutside,tabSize,tableLayout,textAlign,textAlignLast,textCombineUpright,textDecoration,textDecorationColor,textDecorationLine,textDecorationSkip,textDecorationSkipInk,textDecorationStyle,textDecorationThickness,textEmphasis,textEmphasisColor,textEmphasisPosition,textEmphasisStyle,textIndent,textJustify,textOrientation,textOverflow,textRendering,textShadow,textSizeAdjust,textTransform,textUnderlineOffset,textUnderlinePosition,textWrap,timelineScope,top,touchAction,transform,transformBox,transformOrigin,transformStyle,transition,transitionBehavior,transitionDelay,transitionDuration,transitionProperty,transitionTimingFunction,translate,unicodeBidi,userSelect,verticalAlign,viewTimeline,viewTimelineAxis,viewTimelineInset,viewTimelineName,viewTransitionName,visibility,whiteSpace,whiteSpaceCollapse,widows,width,willChange,wordBreak,wordSpacing,wordWrap,writingMode,zIndex,zoom,alignmentBaseline,baselineShift,clipRule,colorInterpolation,colorRendering,dominantBaseline,fill,fillOpacity,fillRule,floodColor,floodOpacity,glyphOrientationVertical,lightingColor,marker,markerEnd,markerMid,markerStart,shapeRendering,stopColor,stopOpacity,stroke,strokeDasharray,strokeDashoffset,strokeLinecap,strokeLinejoin,strokeMiterlimit,strokeOpacity,strokeWidth,textAnchor,vectorEffect",Ul=Ll.split(",").concat(Bl),Fl=new Map(Ul.map(r=>[r,!0])),Dl=/&|@/,Rs=Xe(r=>Fl.has(r)||r.startsWith("--")||Dl.test(r));const ql=(r,e)=>!e.includes(r)&&!Rs(r),Wl=(r,e)=>r.__shouldForwardProps__&&e?t=>r.__shouldForwardProps__(t)&&e(t):e,Hl=(r,e)=>{var n;if(r&&!e)return r;if(!r&&e)return e;if(r.__cva__&&e.__cva__||r.__recipe__&&e.__recipe__)return r.merge(e);const t=new TypeError("Cannot merge cva with recipe. Please use either cva or recipe.");throw(n=TypeError.captureStackTrace)==null||n.call(TypeError,t),t},Vl=r=>typeof r=="string"?r:(r==null?void 0:r.displayName)||(r==null?void 0:r.name)||"Component";function Pn(r,e={},t={}){const n=e.__cva__||e.__recipe__?e:oa(e),s=t.shouldForwardProp||ql,i=x=>s(x,n.variantKeys),o=Object.assign(t.dataAttr&&e.__name__?{"data-recipe":e.__name__}:{},t.defaultProps),a=Hl(r.__cva__,n),c=Wl(r,i),h=r.__base__||r,m=Me(function(g,v){const{as:I=h,children:M,...j}=g,C=_t(()=>Object.assign({},o,j),[j]),[D,ee,Z,ne,pe]=_t(()=>ot(C,Kn.keys,c,a.variantKeys,Rs),[C]);function ae(){var se;const{css:B,...Q}=ne,we=(se=a.__getCompoundVariantCss__)==null?void 0:se.call(a,Z);return $t(a(Z,!1),dr(we,Q,B),C.className)}function re(){const{css:B,...Q}=ne,we=a.raw(Z);return $t(dr(we,Q,B),C.className)}const N=e.__recipe__?ae:re;return le(I,{ref:v,...ee,...pe,...Kn(D),className:N()},C.children??M)}),p=Vl(h);return m.displayName=`styled.${p}`,m.__cva__=a,m.__base__=h,m.__shouldForwardProps__=i,m}function zl(){const r=new Map;return new Proxy(Pn,{apply(e,t,n){return Pn(...n)},get(e,t){return r.has(t)||r.set(t,Pn(t)),r.get(t)}})}const st=zl(),Ii={transform(r){const{inline:e,...t}=r;return{display:e?"inline-flex":"flex",alignItems:"center",justifyContent:"center",...t}}},Jl=(r={})=>{const e=Pl(Ii,r);return Ii.transform(e,El)},Gl=Me(function(e,t){const[n,s]=ot(e,["inline"]),i=Jl(n),o={ref:t,...i,...s};return le(st.div,o)});var Yl=(...r)=>(...e)=>{r.forEach(function(t){t==null||t(...e)})},Cn=r=>typeof r=="string",Kl=Function.prototype.toString;Kl.call(Object);var Xl=(...r)=>r.map(e=>{var t;return(t=e==null?void 0:e.trim)==null?void 0:t.call(e)}).filter(Boolean).join(" "),Zl=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g,Ti=r=>{const e={};let t;for(;t=Zl.exec(r);)e[t[1]]=t[2];return e},Ql=(r,e)=>{if(Cn(r)){if(Cn(e))return`${r};${e}`;r=Ti(r)}else Cn(e)&&(e=Ti(e));return Object.assign({},r??{},e??{})};function eu(...r){let e={};for(let t of r){for(let n in e){if(n.startsWith("on")&&typeof e[n]=="function"&&typeof t[n]=="function"){e[n]=Yl(t[n],e[n]);continue}if(n==="className"||n==="class"){e[n]=Xl(e[n],t[n]);continue}if(n==="style"){e[n]=Ql(e[n],t[n]);continue}e[n]=t[n]!==void 0?t[n]:e[n]}for(let n in t)e[n]===void 0&&(e[n]=t[n])}return e}function tu(r,e){typeof r=="function"?r(e):r!=null&&(r.current=e)}function ru(...r){return e=>{for(const t of r)tu(t,e)}}function nu(r){return"ref"in r.props?r.props.ref:"ref"in r?r.ref:null}const On=r=>{const e=ys(Me((t,n)=>{const{asChild:s,children:i,...o}=t;if(!s)return le(r,{...o,ref:n},i);const a=xs.only(i);if(!Wt(a))return null;const c=nu(a);return Ss(a,{...eu(o,a.props),ref:n?ru(n,c):c})}));return e.displayName=r.displayName||r.name,e},su=()=>{const r=new Map;return new Proxy(On,{apply(e,t,n){return On(n[0])},get(e,t){const n=t;return r.has(n)||r.set(n,On(n)),r.get(n)}})},$e=su(),sn=(r,e,t)=>{const n=i=>({[r]:"__ignore__",...e,...xr(i)});return{recipeFn:(i,o=!0)=>{const c=Zo({conditions:{shift:ra,finalize:ta,breakpoints:{keys:["base","sm","md","lg","xl","2xl"]}},utility:{toHash:(m,p)=>p(m.join(":")),transform:(m,p)=>(Nl(r,t,i,m),p==="__ignore__"?{className:r}:(p=As(p),{className:`${r}--${m}_${p}`}))}}),h=n(i);if(o){const m=Xn(t,h);return $t(c(h),dr(m))}return c(h)},getVariantProps:n,__getCompoundVariantCss__:i=>Xn(t,n(i))}},js=(r,e)=>{if(r&&!e)return r;if(!r&&e)return e;const t=(...i)=>$t(r(...i),e(...i)),n=Yn(r.variantKeys,e.variantKeys),s=n.reduce((i,o)=>(i[o]=Yn(r.variantMap[o],e.variantMap[o]),i),{});return Object.assign(t,{__recipe__:!0,__name__:`${r.__name__} ${e.__name__}`,raw:i=>i,variantKeys:n,variantMap:s,splitVariantProps(i){return ot(i,n)}})},An=sn("button",{variant:"solid",size:"md"},[]),aa={variant:["solid","outline","ghost","link","subtle"],size:["xs","sm","md","lg","xl","2xl"]},Ri=Object.keys(aa),iu=Object.assign(Xe(An.recipeFn),{__recipe__:!0,__name__:"button",__getCompoundVariantCss__:An.__getCompoundVariantCss__,raw:r=>r,variantKeys:Ri,variantMap:aa,merge(r){return js(this,r)},splitVariantProps(r){return ot(r,Ri)},getVariantProps:An.getVariantProps}),In=sn("input",{size:"md"},[]),ca={size:["2xs","xs","sm","md","lg","xl","2xl"]},ji=Object.keys(ca),ou=Object.assign(Xe(In.recipeFn),{__recipe__:!0,__name__:"input",__getCompoundVariantCss__:In.__getCompoundVariantCss__,raw:r=>r,variantKeys:ji,variantMap:ca,merge(r){return js(this,r)},splitVariantProps(r){return ot(r,ji)},getVariantProps:In.getVariantProps}),Tn=sn("spinner",{size:"md"},[]),la={size:["xs","sm","md","lg","xl"]},Mi=Object.keys(la),au=Object.assign(Xe(Tn.recipeFn),{__recipe__:!0,__name__:"spinner",__getCompoundVariantCss__:Tn.__getCompoundVariantCss__,raw:r=>r,variantKeys:Mi,variantMap:la,merge(r){return js(this,r)},splitVariantProps(r){return ot(r,Mi)},getVariantProps:Tn.getVariantProps}),ua={size:"md",variant:"plain"},cu=[],lu=[["root","table__root"],["body","table__body"],["cell","table__cell"],["footer","table__footer"],["head","table__head"],["header","table__header"],["row","table__row"],["caption","table__caption"]],uu=lu.map(([r,e])=>[r,sn(e,ua,Cl(cu,r))]),hu=Xe((r={})=>Object.fromEntries(uu.map(([e,t])=>[e,t.recipeFn(r)]))),Ni=["variant","size"],du=r=>({...ua,...xr(r)}),fu=Object.assign(hu,{__recipe__:!1,__name__:"table",raw:r=>r,variantKeys:Ni,variantMap:{variant:["outline","plain"],size:["sm","md"]},splitVariantProps(r){return ot(r,Ni)},getVariantProps:du}),pu=st($e.div,au),ha=Me((r,e)=>{const{label:t="Loading...",...n}=r;return $(pu,{ref:e,borderBottomColor:"transparent",borderLeftColor:"transparent",...n,children:t&&$(st.span,{srOnly:!0,children:t})})});ha.displayName="Spinner";const _u=st($e.button,iu),Zn=Me((r,e)=>{const{loading:t,disabled:n,loadingText:s,children:i,...o}=r;return $(_u,{disabled:t||n,ref:e,...o,children:t&&!s?$(je,{children:[$(mu,{}),$(st.span,{opacity:0,children:i})]}):s||i})});Zn.displayName="Button";const mu=()=>$(Gl,{inline:!0,position:"absolute",transform:"translate(-50%, -50%)",top:"50%",insetStart:"50%",children:$(ha,{colorPalette:"gray"})}),Nr=st($e.input,ou),bu=(r,e,t={})=>{var n;return((n=t.forwardProps)==null?void 0:n.includes(r))||!e.includes(r)&&!Rs(r)},gu=r=>{const e=ps(null);return{withRootProvider:i=>a=>{const[c,h]=r.splitVariantProps(a),m=r(c);return $(e.Provider,{value:m,children:$(i,{...h})})},withProvider:(i,o,a)=>{const c=st(i,{},{shouldForwardProp:(m,p)=>bu(m,p,a)}),h=Me((m,p)=>{const[x,g]=r.splitVariantProps(m),v=r(x);return $(e.Provider,{value:v,children:$(c,{...g,ref:p,className:$t(v==null?void 0:v[o],m.className)})})});return h.displayName=i.displayName||i.name,h},withContext:(i,o)=>{const a=st(i),c=Me((h,m)=>{const p=nn(e);return $(a,{...h,ref:m,className:$t(p==null?void 0:p[o],h.className)})});return c.displayName=i.displayName||i.name,c}}},{withProvider:yu,withContext:bt}=gu(fu),xu=yu($e.table,"root"),wu=bt($e.tbody,"body"),vu=bt($e.caption,"caption"),Le=bt($e.td,"cell");bt($e.tfoot,"footer");const Su=bt($e.thead,"head"),Zt=bt($e.th,"header"),Rn=bt($e.tr,"row");/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ku=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),da=(...r)=>r.filter((e,t,n)=>!!e&&n.indexOf(e)===t).join(" ");/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Eu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pu=Me(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:o,...a},c)=>le("svg",{ref:c,...Eu,width:e,height:e,stroke:r,strokeWidth:n?Number(t)*24/Number(e):t,className:da("lucide",s),...a},[...o.map(([h,m])=>le(h,m)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fa=(r,e)=>{const t=Me(({className:n,...s},i)=>le(Pu,{ref:i,iconNode:e,className:da(`lucide-${ku(r)}`,n),...s}));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cu=fa("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.445.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ou=fa("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function Au(r,e){let t;const n=()=>{t!==void 0&&e&&e(t),t=void 0};return[()=>t===void 0?t=r(n):t,n]}function Iu(...r){let e=!1;const t=r.flat(1);return[n=>!e&&t.push(n),()=>{e||(e=!0,t.forEach(n=>n()))},e]}class Ms extends Error{constructor(e,t,n){super(t,{cause:n}),this.type=e,Object.setPrototypeOf(this,Ms.prototype)}}function Bt(r,e,t){return new Ms(r,e,t)}const Tu="ERR_METHOD_UNSUPPORTED",Ru="ERR_METHOD_PARAMETER_UNSUPPORTED",ju="ERR_UNKNOWN_ENV",Mu="ERR_UNEXPECTED_TYPE",pa="ERR_PARSE";function wr(){return Bt(Mu,"Value has unexpected type")}class Ns{constructor(e,t,n){this.parser=e,this.isOptional=t,this.type=n}parse(e){if(!(this.isOptional&&e===void 0))try{return this.parser(e)}catch(t){throw Bt(pa,`Unable to parse value${this.type?` as ${this.type}`:""}`,t)}}optional(){return this.isOptional=!0,this}}function Ht(r,e){return()=>new Ns(r,!1,e)}const et=Ht(r=>{if(typeof r=="boolean")return r;const e=String(r);if(e==="1"||e==="true")return!0;if(e==="0"||e==="false")return!1;throw wr()},"boolean");function _a(r,e){const t={};for(const n in r){const s=r[n];if(!s)continue;let i,o;if(typeof s=="function"||"parse"in s)i=n,o=typeof s=="function"?s:s.parse.bind(s);else{const{type:a}=s;i=s.from||n,o=typeof a=="function"?a:a.parse.bind(a)}try{const a=o(e(i));a!==void 0&&(t[n]=a)}catch(a){throw Bt(pa,`Unable to parse field "${n}"`,a)}}return t}function ma(r){let e=r;if(typeof e=="string"&&(e=JSON.parse(e)),typeof e!="object"||e===null||Array.isArray(e))throw wr();return e}function Pt(r,e){return new Ns(t=>{const n=ma(t);return _a(r,s=>n[s])},!1,e)}const Lt=Ht(r=>{if(typeof r=="number")return r;if(typeof r=="string"){const e=Number(r);if(!Number.isNaN(e))return e}throw wr()},"number"),J=Ht(r=>{if(typeof r=="string"||typeof r=="number")return r.toString();throw wr()},"string");Pt({req_id:J(),data:r=>r===null?r:J().optional().parse(r)}),Pt({req_id:J(),result:r=>r,error:J().optional()}),Pt({height:Lt(),width:r=>r==null?window.innerWidth:Lt().parse(r),is_state_stable:et(),is_expanded:et()});function $s(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Nu(r,e){const t=r.split("."),n=e.split("."),s=Math.max(t.length,n.length);for(let i=0;i<s;i+=1){const o=parseInt(t[i]||"0",10),a=parseInt(n[i]||"0",10);if(o!==a)return o>a?1:-1}return 0}function Se(r,e){return Nu(r,e)<=0}function $i(r,e,t){if(typeof t=="string"){if(r==="web_app_open_link"){if(e==="try_instant_view")return Se("6.4",t);if(e==="try_browser")return Se("7.6",t)}if(r==="web_app_set_header_color"&&e==="color")return Se("6.9",t);if(r==="web_app_close"&&e==="return_back")return Se("7.6",t)}switch(r){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return Se("6.1",e);case"web_app_open_popup":return Se("6.2",e);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return Se("6.4",e);case"web_app_switch_inline_query":return Se("6.7",e);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return Se("6.9",e);case"web_app_setup_settings_button":return Se("6.10",e);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return Se("7.2",e);case"web_app_setup_swipe_behavior":return Se("7.7",e);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(r)}}function $u(r){return"external"in r&&$s(r.external)&&"notify"in r.external&&typeof r.external.notify=="function"}function Bu(r){return"TelegramWebviewProxy"in r&&$s(r.TelegramWebviewProxy)&&"postEvent"in r.TelegramWebviewProxy&&typeof r.TelegramWebviewProxy.postEvent=="function"}function Lu(){try{return window.self!==window.top}catch{return!0}}const Uu="https://web.telegram.org";let Fu=Uu;function Du(){return Fu}function qu(r,e,t){let n={},s;if(!e&&!t?n={}:e&&t?(n=t,s=e):e&&("targetOrigin"in e?n=e:s=e),Lu())return window.parent.postMessage(JSON.stringify({eventType:r,eventData:s}),n.targetOrigin||Du());if($u(window)){window.external.notify(JSON.stringify({eventType:r,eventData:s}));return}if(Bu(window)){window.TelegramWebviewProxy.postEvent(r,JSON.stringify(s));return}throw Bt(ju,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside the Telegram application environment.")}function Wu(r){return(e,t)=>{if(!$i(e,r))throw Bt(Tu,`Method "${e}" is unsupported in Mini Apps version ${r}`);if($s(t)&&e==="web_app_set_header_color"&&"color"in t&&!$i(e,"color",r))throw Bt(Ru,`Parameter "color" of "${e}" method is unsupported in Mini Apps version ${r}`);return qu(e,t)}}function Hu(r){return/^#[\da-f]{6}$/i.test(r)}function Vu(r){return/^#[\da-f]{3}$/i.test(r)}function zu(r){const e=r.replace(/\s/g,"").toLowerCase();if(Hu(e))return e;if(Vu(e)){let n="#";for(let s=0;s<3;s+=1)n+=e[1+s].repeat(2);return n}const t=e.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||e.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!t)throw new Error(`Value "${r}" does not satisfy any of known RGB formats.`);return t.slice(1).reduce((n,s)=>{const i=parseInt(s,10).toString(16);return n+(i.length===1?"0":"")+i},"#")}const Ju=Ht(r=>r instanceof Date?r:new Date(Lt().parse(r)*1e3),"Date");function ba(r,e){return new Ns(t=>{if(typeof t!="string"&&!(t instanceof URLSearchParams))throw wr();const n=typeof t=="string"?new URLSearchParams(t):t;return _a(r,s=>{const i=n.get(s);return i===null?void 0:i})},!1,e)}const Gu=Pt({id:Lt(),type:J(),title:J(),photoUrl:{type:J().optional(),from:"photo_url"},username:J().optional()},"Chat").optional(),Bi=Pt({addedToAttachmentMenu:{type:et().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:et().optional(),from:"allows_write_to_pm"},firstName:{type:J(),from:"first_name"},id:Lt(),isBot:{type:et().optional(),from:"is_bot"},isPremium:{type:et().optional(),from:"is_premium"},languageCode:{type:J().optional(),from:"language_code"},lastName:{type:J().optional(),from:"last_name"},photoUrl:{type:J().optional(),from:"photo_url"},username:J().optional()},"User").optional();function Yu(){return ba({authDate:{type:Ju(),from:"auth_date"},canSendAfter:{type:Lt().optional(),from:"can_send_after"},chat:Gu,chatInstance:{type:J().optional(),from:"chat_instance"},chatType:{type:J().optional(),from:"chat_type"},hash:J(),queryId:{type:J().optional(),from:"query_id"},receiver:Bi,startParam:{type:J().optional(),from:"start_param"},user:Bi},"InitData")}const Ku=Ht(r=>zu(J().parse(r)),"rgb");function Xu(r){return r.replace(/_[a-z]/g,e=>e[1].toUpperCase())}function Zu(r){return r.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)}const Qu=Ht(r=>{const e=Ku().optional();return Object.entries(ma(r)).reduce((t,[n,s])=>(t[Xu(n)]=e.parse(s),t),{})},"ThemeParams");function ga(r){return ba({botInline:{type:et().optional(),from:"tgWebAppBotInline"},initData:{type:Yu().optional(),from:"tgWebAppData"},initDataRaw:{type:J().optional(),from:"tgWebAppData"},platform:{type:J(),from:"tgWebAppPlatform"},showSettings:{type:et().optional(),from:"tgWebAppShowSettings"},startParam:{type:J().optional(),from:"tgWebAppStartParam"},themeParams:{type:Qu(),from:"tgWebAppThemeParams"},version:{type:J(),from:"tgWebAppVersion"}}).parse(r)}function ya(r){return ga(r.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function eh(){return ya(window.location.href)}function xa(){return performance.getEntriesByType("navigation")[0]}function th(){const r=xa();if(!r)throw new Error("Unable to get first navigation entry.");return ya(r.name)}function wa(r){return`telegram-apps/${r.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}`}function va(r,e){sessionStorage.setItem(wa(r),JSON.stringify(e))}function Sa(r){const e=sessionStorage.getItem(wa(r));try{return e?JSON.parse(e):void 0}catch{}}function rh(){return ga(Sa("launchParams")||"")}function nh(r){return JSON.stringify(Object.fromEntries(Object.entries(r).map(([e,t])=>[Zu(e),t])))}function sh(r){const{initDataRaw:e,themeParams:t,platform:n,version:s,showSettings:i,startParam:o,botInline:a}=r,c=new URLSearchParams;return c.set("tgWebAppPlatform",n),c.set("tgWebAppThemeParams",nh(t)),c.set("tgWebAppVersion",s),e&&c.set("tgWebAppData",e),o&&c.set("tgWebAppStartParam",o),typeof i=="boolean"&&c.set("tgWebAppShowSettings",i?"1":"0"),typeof a=="boolean"&&c.set("tgWebAppBotInline",a?"1":"0"),c.toString()}function ih(r){va("launchParams",sh(r))}function oh(){const r=[];for(const e of[eh,th,rh])try{const t=e();return ih(t),t}catch(t){r.push(t instanceof Error?t.message:JSON.stringify(t))}throw new Error([`Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?
`,"📖 Refer to docs for more information:",`https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment
`,"Collected errors:",r.map(e=>`— ${e}`)].join(`
`))}function ah(){const r=xa();return!!(r&&r.type==="reload")}function ch(){let r=0;return()=>(r+=1).toString()}const[lh]=Au(ch);function uh(r,e){return()=>{const t=oh(),n={...t,postEvent:Wu(t.version),createRequestId:lh()};if(typeof r=="function")return r(n);const[s,i,o]=Iu(),a=e({...n,state:ah()?Sa(r):void 0,addCleanup:s}),c=h=>(o||s(h.on("change",m=>{va(r,m)})),h);return[a instanceof Promise?a.then(c):c(a),i]}}class hh{constructor(e){this.initData=e}get authDate(){return this.initData.authDate}get canSendAfter(){return this.initData.canSendAfter}get canSendAfterDate(){const{canSendAfter:e}=this;return e?new Date(this.authDate.getTime()+e*1e3):void 0}get chat(){return this.initData.chat}get chatType(){return this.initData.chatType}get chatInstance(){return this.initData.chatInstance}get hash(){return this.initData.hash}get queryId(){return this.initData.queryId}get receiver(){return this.initData.receiver}get startParam(){return this.initData.startParam}get user(){return this.initData.user}}const jn=uh(({initData:r})=>r?new hh(r):void 0),xe=new Uint8Array(0),at=new TextEncoder,ge=new TextDecoder;function dh(...r){let e=0;for(let s=0;s<r.length;s++)e+=r[s].length;const t=new Uint8Array(e);let n=0;for(let s=0;s<r.length;s++)t.set(r[s],n),n+=r[s].length;return t}function ir(...r){const e=[];for(let t=0;t<r.length;t++)e.push(at.encode(r[t]));return e.length===0?xe:e.length===1?e[0]:dh(...e)}function Li(r){return!r||r.length===0?"":ge.decode(r)}const Ui="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",Fi=36,fh=0xcfd41b9100000,Di=33,ph=333,qi=22;function _h(r){for(let e=0;e<r.length;e++)r[e]=Math.floor(Math.random()*255)}function mh(r){var e;(e=globalThis==null?void 0:globalThis.crypto)!=null&&e.getRandomValues?globalThis.crypto.getRandomValues(r):_h(r)}class bh{constructor(){u(this,"buf");u(this,"seq");u(this,"inc");u(this,"inited");this.buf=new Uint8Array(qi),this.inited=!1}init(){this.inited=!0,this.setPre(),this.initSeqAndInc(),this.fillSeq()}initSeqAndInc(){this.seq=Math.floor(Math.random()*fh),this.inc=Math.floor(Math.random()*(ph-Di)+Di)}setPre(){const e=new Uint8Array(12);mh(e);for(let t=0;t<12;t++){const n=e[t]%36;this.buf[t]=Ui.charCodeAt(n)}}fillSeq(){let e=this.seq;for(let t=qi-1;t>=12;t--)this.buf[t]=Ui.charCodeAt(e%Fi),e=Math.floor(e/Fi)}next(){return this.inited||this.init(),this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),String.fromCharCode.apply(String,this.buf)}reset(){this.init()}}const gt=new bh;var We;(function(r){r.Disconnect="disconnect",r.Reconnect="reconnect",r.Update="update",r.LDM="ldm",r.Error="error"})(We||(We={}));var It;(function(r){r.Reconnecting="reconnecting",r.PingTimer="pingTimer",r.StaleConnection="staleConnection",r.ClientInitiatedReconnect="client initiated reconnect"})(It||(It={}));var P;(function(r){r.ApiError="BAD API",r.BadAuthentication="BAD_AUTHENTICATION",r.BadCreds="BAD_CREDS",r.BadHeader="BAD_HEADER",r.BadJson="BAD_JSON",r.BadPayload="BAD_PAYLOAD",r.BadSubject="BAD_SUBJECT",r.Cancelled="CANCELLED",r.ConnectionClosed="CONNECTION_CLOSED",r.ConnectionDraining="CONNECTION_DRAINING",r.ConnectionRefused="CONNECTION_REFUSED",r.ConnectionTimeout="CONNECTION_TIMEOUT",r.Disconnect="DISCONNECT",r.InvalidOption="INVALID_OPTION",r.InvalidPayload="INVALID_PAYLOAD",r.MaxPayloadExceeded="MAX_PAYLOAD_EXCEEDED",r.NoResponders="503",r.NotFunction="NOT_FUNC",r.RequestError="REQUEST_ERROR",r.ServerOptionNotAvailable="SERVER_OPT_NA",r.SubClosed="SUB_CLOSED",r.SubDraining="SUB_DRAINING",r.Timeout="TIMEOUT",r.Tls="TLS",r.Unknown="UNKNOWN_ERROR",r.WssRequired="WSS_REQUIRED",r.JetStreamInvalidAck="JESTREAM_INVALID_ACK",r.JetStream404NoMessages="404",r.JetStream408RequestTimeout="408",r.JetStream409MaxAckPendingExceeded="409",r.JetStream409="409",r.JetStreamNotEnabled="503",r.JetStreamIdleHeartBeat="IDLE_HEARTBEAT",r.AuthorizationViolation="AUTHORIZATION_VIOLATION",r.AuthenticationExpired="AUTHENTICATION_EXPIRED",r.ProtocolError="NATS_PROTOCOL_ERR",r.PermissionsViolation="PERMISSIONS_VIOLATION",r.AuthenticationTimeout="AUTHENTICATION_TIMEOUT",r.AccountExpired="ACCOUNT_EXPIRED"})(P||(P={}));function gh(r){return typeof r.code=="string"}class ka{constructor(){u(this,"messages");this.messages=new Map,this.messages.set(P.InvalidPayload,"Invalid payload type - payloads can be 'binary', 'string', or 'json'"),this.messages.set(P.BadJson,"Bad JSON"),this.messages.set(P.WssRequired,"TLS is required, therefore a secure websocket connection is also required")}static getMessage(e){return yh.getMessage(e)}getMessage(e){return this.messages.get(e)||e}}const yh=new ka;class T extends Error{constructor(t,n,s){super(t);u(this,"name");u(this,"message");u(this,"code");u(this,"permissionContext");u(this,"chainedError");u(this,"api_error");this.name="NatsError",this.message=t,this.code=n,this.chainedError=s}static errorForCode(t,n){const s=ka.getMessage(t);return new T(s,t,n)}isAuthError(){return this.code===P.AuthenticationExpired||this.code===P.AuthorizationViolation||this.code===P.AccountExpired}isAuthTimeout(){return this.code===P.AuthenticationTimeout}isPermissionError(){return this.code===P.PermissionsViolation}isProtocolError(){return this.code===P.ProtocolError}isJetStreamError(){return this.api_error!==void 0}jsError(){return this.api_error?this.api_error:null}}var me;(function(r){r[r.Exact=0]="Exact",r[r.CanonicalMIME=1]="CanonicalMIME",r[r.IgnoreCase=2]="IgnoreCase"})(me||(me={}));var Te;(function(r){r.Timer="timer",r.Count="count",r.JitterTimer="jitterTimer",r.SentinelMsg="sentinelMsg"})(Te||(Te={}));var or;(function(r){r.STATS="io.nats.micro.v1.stats_response",r.INFO="io.nats.micro.v1.info_response",r.PING="io.nats.micro.v1.ping_response"})(or||(or={}));const Jr="Nats-Service-Error",Gr="Nats-Service-Error-Code";class Yr extends Error{constructor(t,n){super(n);u(this,"code");this.code=t}static isServiceError(t){return Yr.toServiceError(t)!==null}static toServiceError(t){var s,i;const n=((s=t==null?void 0:t.headers)==null?void 0:s.get(Gr))||"";if(n!==""){const o=parseInt(n)||400,a=((i=t==null?void 0:t.headers)==null?void 0:i.get(Jr))||"";return new Yr(o,a.length?a:n)}return null}}function Je(r=""){if(r=r||"_INBOX",typeof r!="string")throw new Error("prefix must be a string");return r.split(".").forEach(e=>{if(e==="*"||e===">")throw new Error(`inbox prefixes cannot have wildcards '${r}'`)}),`${r}.${gt.next()}`}const Qn="127.0.0.1";var tt;(function(r){r.PING="PING",r.STATS="STATS",r.INFO="INFO"})(tt||(tt={}));function on(r,...e){for(let t=0;t<e.length;t++){const n=e[t];Object.keys(n).forEach(function(s){r[s]=n[s]})}return r}function $r(r){return ge.decode(r).replace(/\n/g,"␊").replace(/\r/g,"␍")}function Ut(r,e=!0){const t=e?T.errorForCode(P.Timeout):null;let n,s;const i=new Promise((o,a)=>{n={cancel:()=>{s&&clearTimeout(s)}},s=setTimeout(()=>{a(t===null?T.errorForCode(P.Timeout):t)},r)});return Object.assign(i,n)}function Vt(r=0){let e;const t=new Promise(n=>{const s=setTimeout(()=>{n()},r);e={cancel:()=>{s&&clearTimeout(s)}}});return Object.assign(t,e)}function G(){let r={};const e=new Promise((t,n)=>{r={resolve:t,reject:n}});return Object.assign(e,r)}function Ea(r){for(let e=r.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}function xh(r){return r===0?0:Math.floor(r/2+Math.random()*r)}function Bs(r=[0,250,250,500,500,3e3,5e3]){Array.isArray(r)||(r=[0,250,250,500,500,3e3,5e3]);const e=r.length-1;return{backoff(t){return xh(t>e?r[e]:r[t])}}}function X(r){return r*1e6}function Ls(r){return Math.floor(r/1e6)}function Wi(r){let n=!0;const s=new Array(r.length);for(let i=0;i<r.length;i++){let o=r.charCodeAt(i);if(o===58||o<33||o>126)throw new T(`'${r[i]}' is not a valid character for a header key`,P.BadHeader);n&&97<=o&&o<=122?o-=32:!n&&65<=o&&o<=90&&(o+=32),s[i]=o,n=o==45}return String.fromCharCode(...s)}function Ke(r=0,e=""){if(r===0&&e!==""||r>0&&e==="")throw new Error("setting status requires both code and description");return new rt(r,e)}const Mn="NATS/1.0";class rt{constructor(e=0,t=""){u(this,"_code");u(this,"headers");u(this,"_description");this._code=e,this._description=t,this.headers=new Map}[Symbol.iterator](){return this.headers.entries()}size(){return this.headers.size}equals(e){if(e&&this.headers.size===e.headers.size&&this._code===e._code){for(const[t,n]of this.headers){const s=e.values(t);if(n.length!==s.length)return!1;const i=[...n].sort(),o=[...s].sort();for(let a=0;a<i.length;a++)if(i[a]!==o[a])return!1}return!0}return!1}static decode(e){const t=new rt,s=ge.decode(e).split(`\r
`),i=s[0];if(i!==Mn){let o=i.replace(Mn,"").trim();if(o.length>0){t._code=parseInt(o,10),isNaN(t._code)&&(t._code=0);const a=t._code.toString();o=o.replace(a,""),t._description=o.trim()}}return s.length>=1&&s.slice(1).map(o=>{if(o){const a=o.indexOf(":");if(a>-1){const c=o.slice(0,a),h=o.slice(a+1).trim();t.append(c,h)}}}),t}toString(){if(this.headers.size===0&&this._code===0)return"";let e=Mn;this._code>0&&this._description!==""&&(e+=` ${this._code} ${this._description}`);for(const[t,n]of this.headers)for(let s=0;s<n.length;s++)e=`${e}\r
${t}: ${n[s]}`;return`${e}\r
\r
`}encode(){return at.encode(this.toString())}static validHeaderValue(e){if(/[\r\n]/.test(e))throw new T("invalid header value - \\r and \\n are not allowed.",P.BadHeader);return e.trim()}keys(){const e=[];for(const t of this.headers.keys())e.push(t);return e}findKeys(e,t=me.Exact){const n=this.keys();switch(t){case me.Exact:return n.filter(s=>s===e);case me.CanonicalMIME:return e=Wi(e),n.filter(s=>s===e);default:{const s=e.toLowerCase();return n.filter(i=>s===i.toLowerCase())}}}get(e,t=me.Exact){const n=this.findKeys(e,t);if(n.length){const s=this.headers.get(n[0]);if(s)return Array.isArray(s)?s[0]:s}return""}last(e,t=me.Exact){const n=this.findKeys(e,t);if(n.length){const s=this.headers.get(n[0]);if(s)return Array.isArray(s)?s[s.length-1]:s}return""}has(e,t=me.Exact){return this.findKeys(e,t).length>0}set(e,t,n=me.Exact){this.delete(e,n),this.append(e,t,n)}append(e,t,n=me.Exact){const s=Wi(e);n===me.CanonicalMIME&&(e=s);const i=this.findKeys(e,n);e=i.length>0?i[0]:e;const o=rt.validHeaderValue(t);let a=this.headers.get(e);a||(a=[],this.headers.set(e,a)),a.push(o)}values(e,t=me.Exact){const n=[];return this.findKeys(e,t).forEach(i=>{const o=this.headers.get(i);o&&n.push(...o)}),n}delete(e,t=me.Exact){this.findKeys(e,t).forEach(s=>{this.headers.delete(s)})}get hasError(){return this._code>=300}get status(){return`${this._code} ${this._description}`.trim()}toRecord(){const e={};return this.keys().forEach(t=>{e[t]=this.values(t)}),e}get code(){return this._code}get description(){return this._description}static fromRecord(e){const t=new rt;for(const n in e)t.headers.set(n,e[n]);return t}}function Hi(){return{encode(r){return at.encode(r)},decode(r){return ge.decode(r)}}}function Pe(r){return{encode(e){try{return e===void 0&&(e=null),at.encode(JSON.stringify(e))}catch(t){throw T.errorForCode(P.BadJson,t)}},decode(e){try{return JSON.parse(ge.decode(e),r)}catch(t){throw T.errorForCode(P.BadJson,t)}}}}function Pa(r){var e;return r&&r.data.length===0&&((e=r.headers)==null?void 0:e.code)===503?T.errorForCode(P.NoResponders):null}class Us{constructor(e,t,n){u(this,"_headers");u(this,"_msg");u(this,"_rdata");u(this,"_reply");u(this,"_subject");u(this,"publisher");this._msg=e,this._rdata=t,this.publisher=n}get subject(){return this._subject?this._subject:(this._subject=ge.decode(this._msg.subject),this._subject)}get reply(){return this._reply?this._reply:(this._reply=ge.decode(this._msg.reply),this._reply)}get sid(){return this._msg.sid}get headers(){if(this._msg.hdr>-1&&!this._headers){const e=this._rdata.subarray(0,this._msg.hdr);this._headers=rt.decode(e)}return this._headers}get data(){return this._rdata?this._msg.hdr>-1?this._rdata.subarray(this._msg.hdr):this._rdata:new Uint8Array(0)}respond(e=xe,t){return this.reply?(this.publisher.publish(this.reply,e,t),!0):!1}size(){var s;const e=this._msg.subject.length,t=((s=this._msg.reply)==null?void 0:s.length)||0,n=this._msg.size===-1?0:this._msg.size;return e+t+n}json(e){return Pe(e).decode(this.data)}string(){return ge.decode(this.data)}requestInfo(){var t;const e=(t=this.headers)==null?void 0:t.get("Nats-Request-Info");return e?JSON.parse(e,function(n,s){return(n==="start"||n==="stop")&&s!==""?new Date(Date.parse(s)):s}):null}}u(Us,"jc");function Tt(r){return an("durable",r)}function ue(r){return an("stream",r)}function an(r,e=""){if(e==="")throw Error(`${r} name required`);return[".","*",">","/","\\"," ","	",`
`,"\r"].forEach(n=>{if(e.indexOf(n)!==-1){switch(n){case`
`:n="\\n";break;case"\r":n="\\r";break;case"	":n="\\t";break}throw Error(`invalid ${r} name - ${r} name cannot contain '${n}'`)}}),""}function er(r,e=""){if(e==="")throw Error(`${r} name required`);const t=wh(e);if(t.length)throw new Error(`invalid ${r} name - ${r} name ${t}`)}function wh(r=""){if(r==="")throw Error("name required");const e=/^[-\w]+$/g;if(r.match(e)===null){for(const n of r.split(""))if(n.match(e)===null)return`cannot contain '${n}'`}return""}function es(r){if(r.data.length>0)return!1;const e=r.headers;return e?e.code>=100&&e.code<200:!1}function ts(r){var e;return es(r)&&((e=r.headers)==null?void 0:e.description)==="Idle Heartbeat"}function vh(r,e,t){const n=Ke(r,e),s={hdr:1,sid:0,size:0},i=new Us(s,xe,{});return i._headers=n,i._subject=t,i}function Rt(r){if(r.data.length!==0)return null;const e=r.headers;return e?Ca(e.code,e.description):null}var Ee;(function(r){r.MaxBatchExceeded="exceeded maxrequestbatch of",r.MaxExpiresExceeded="exceeded maxrequestexpires of",r.MaxBytesExceeded="exceeded maxrequestmaxbytes of",r.MaxMessageSizeExceeded="message size exceeds maxbytes",r.PushConsumer="consumer is push based",r.MaxWaitingExceeded="exceeded maxwaiting",r.IdleHeartbeatMissed="idle heartbeats missed",r.ConsumerDeleted="consumer deleted"})(Ee||(Ee={}));function Sh(r){return r.code!==P.JetStream409?!1:[Ee.MaxBatchExceeded,Ee.MaxExpiresExceeded,Ee.MaxBytesExceeded,Ee.MaxMessageSizeExceeded,Ee.PushConsumer,Ee.IdleHeartbeatMissed,Ee.ConsumerDeleted].find(t=>r.message.indexOf(t)!==-1)!==void 0}function Ca(r,e=""){if(r<300)return null;switch(e=e.toLowerCase(),r){case 404:return new T(e,P.JetStream404NoMessages);case 408:return new T(e,P.JetStream408RequestTimeout);case 409:{const t=e.startsWith(Ee.IdleHeartbeatMissed)?P.JetStreamIdleHeartBeat:P.JetStream409;return new T(e,t)}case 503:return T.errorForCode(P.JetStreamNotEnabled,new Error(e));default:return e===""&&(e=P.Unknown),new T(e,`${r}`)}}class oe{constructor(){u(this,"inflight");u(this,"processed");u(this,"received");u(this,"noIterator");u(this,"iterClosed");u(this,"done");u(this,"signal");u(this,"yields");u(this,"filtered");u(this,"pendingFiltered");u(this,"ingestionFilterFn");u(this,"protocolFilterFn");u(this,"dispatchedFn");u(this,"ctx");u(this,"_data");u(this,"err");u(this,"time");u(this,"yielding");this.inflight=0,this.filtered=0,this.pendingFiltered=0,this.processed=0,this.received=0,this.noIterator=!1,this.done=!1,this.signal=G(),this.yields=[],this.iterClosed=G(),this.time=0,this.yielding=!1}[Symbol.asyncIterator](){return this.iterate()}push(e){if(this.done)return;if(typeof e=="function"){this.yields.push(e),this.signal.resolve();return}const{ingest:t,protocol:n}=this.ingestionFilterFn?this.ingestionFilterFn(e,this.ctx||this):{ingest:!0,protocol:!1};t&&(n&&(this.filtered++,this.pendingFiltered++),this.yields.push(e),this.signal.resolve())}async*iterate(){if(this.noIterator)throw new T("unsupported iterator",P.ApiError);if(this.yielding)throw new T("already yielding",P.ApiError);this.yielding=!0;try{for(;;){if(this.yields.length===0&&await this.signal,this.err)throw this.err;const e=this.yields;this.inflight=e.length,this.yields=[];for(let t=0;t<e.length;t++){if(typeof e[t]=="function"){const s=e[t];try{s()}catch(i){throw i}if(this.err)throw this.err;continue}if(this.protocolFilterFn?this.protocolFilterFn(e[t]):!0){this.processed++;const s=Date.now();yield e[t],this.time=Date.now()-s,this.dispatchedFn&&e[t]&&this.dispatchedFn(e[t])}else this.pendingFiltered--;this.inflight--}if(this.done)break;this.yields.length===0&&(e.length=0,this.yields=e,this.signal=G())}}finally{this.stop()}}stop(e){this.done||(this.err=e,this.done=!0,this.signal.resolve(),this.iterClosed.resolve(e))}getProcessed(){return this.noIterator?this.received:this.processed}getPending(){return this.yields.length+this.inflight-this.pendingFiltered}getReceived(){return this.received-this.filtered}}class Fs{constructor(e,t,n={maxOut:2}){u(this,"interval");u(this,"maxOut");u(this,"cancelAfter");u(this,"timer");u(this,"autoCancelTimer");u(this,"last");u(this,"missed");u(this,"count");u(this,"callback");this.interval=e,this.maxOut=(n==null?void 0:n.maxOut)||2,this.cancelAfter=(n==null?void 0:n.cancelAfter)||0,this.last=Date.now(),this.missed=0,this.count=0,this.callback=t,this._schedule()}cancel(){this.autoCancelTimer&&clearTimeout(this.autoCancelTimer),this.timer&&clearInterval(this.timer),this.timer=0,this.autoCancelTimer=0,this.missed=0}work(){this.last=Date.now(),this.missed=0}_change(e,t=0,n=2){this.interval=e,this.maxOut=n,this.cancelAfter=t,this.restart()}restart(){this.cancel(),this._schedule()}_schedule(){this.cancelAfter>0&&(this.autoCancelTimer=setTimeout(()=>{this.cancel()},this.cancelAfter)),this.timer=setInterval(()=>{if(this.count++,Date.now()-this.last>this.interval&&this.missed++,this.missed>=this.maxOut)try{this.callback(this.missed)===!0&&this.cancel()}catch(e){console.log(e)}},this.interval)}}var rs;(function(r){r.Limits="limits",r.Interest="interest",r.Workqueue="workqueue"})(rs||(rs={}));var fr;(function(r){r.Old="old",r.New="new"})(fr||(fr={}));var ns;(function(r){r.File="file",r.Memory="memory"})(ns||(ns={}));var te;(function(r){r.All="all",r.Last="last",r.New="new",r.StartSequence="by_start_sequence",r.StartTime="by_start_time",r.LastPerSubject="last_per_subject"})(te||(te={}));var ie;(function(r){r.None="none",r.All="all",r.Explicit="explicit",r.NotSet=""})(ie||(ie={}));var Ft;(function(r){r.Instant="instant",r.Original="original"})(Ft||(Ft={}));var it;(function(r){r.None="none",r.S2="s2"})(it||(it={}));var Kr;(function(r){r.CreateOrUpdate="",r.Update="update",r.Create="create"})(Kr||(Kr={}));function kh(r,e={}){return Object.assign({name:r,deliver_policy:te.All,ack_policy:ie.Explicit,ack_wait:X(30*1e3),replay_policy:Ft.Instant},e)}var Vi;(function(r){r.API="api_audit",r.StreamAction="stream_action",r.ConsumerAction="consumer_action",r.SnapshotCreate="snapshot_create",r.SnapshotComplete="snapshot_complete",r.RestoreCreate="restore_create",r.RestoreComplete="restore_complete",r.MaxDeliver="max_deliver",r.Terminated="terminated",r.Ack="consumer_ack",r.StreamLeaderElected="stream_leader_elected",r.StreamQuorumLost="stream_quorum_lost",r.ConsumerLeaderElected="consumer_leader_elected",r.ConsumerQuorumLost="consumer_quorum_lost"})(Vi||(Vi={}));var fe;(function(r){r.StreamSourceHdr="Nats-Stream-Source",r.LastConsumerSeqHdr="Nats-Last-Consumer",r.LastStreamSeqHdr="Nats-Last-Stream",r.ConsumerStalledHdr="Nats-Consumer-Stalled",r.MessageSizeHdr="Nats-Msg-Size",r.RollupHdr="Nats-Rollup",r.RollupValueSubject="sub",r.RollupValueAll="all",r.PendingMessagesHdr="Nats-Pending-Messages",r.PendingBytesHdr="Nats-Pending-Bytes"})(fe||(fe={}));var Ie;(function(r){r.LastValue="",r.AllHistory="history",r.UpdatesOnly="updates"})(Ie||(Ie={}));var Ct;(function(r){r.Stream="Nats-Stream",r.Sequence="Nats-Sequence",r.TimeStamp="Nats-Time-Stamp",r.Subject="Nats-Subject"})(Ct||(Ct={}));var zi;(function(r){r.Stream="Nats-Stream",r.Subject="Nats-Subject",r.Sequence="Nats-Sequence",r.LastSequence="Nats-Last-Sequence",r.Size="Nats-Msg-Size"})(zi||(zi={}));const be="KV_";class Eh{constructor(e){u(this,"config");u(this,"ordered");u(this,"mack");u(this,"stream");u(this,"callbackFn");u(this,"max");u(this,"qname");u(this,"isBind");u(this,"filters");this.stream="",this.mack=!1,this.ordered=!1,this.config=kh("",e||{})}getOpts(){var t;const e={};if(e.config=Object.assign({},this.config),e.config.filter_subject&&(this.filterSubject(e.config.filter_subject),e.config.filter_subject=void 0),e.config.filter_subjects&&((t=e.config.filter_subjects)==null||t.forEach(n=>{this.filterSubject(n)}),e.config.filter_subjects=void 0),e.mack=this.mack,e.stream=this.stream,e.callbackFn=this.callbackFn,e.max=this.max,e.queue=this.qname,e.ordered=this.ordered,e.config.ack_policy=e.ordered?ie.None:e.config.ack_policy,e.isBind=e.isBind||!1,this.filters)switch(this.filters.length){case 0:break;case 1:e.config.filter_subject=this.filters[0];break;default:e.config.filter_subjects=this.filters}return e}description(e){return this.config.description=e,this}deliverTo(e){return this.config.deliver_subject=e,this}durable(e){return Tt(e),this.config.durable_name=e,this}startSequence(e){if(e<=0)throw new Error("sequence must be greater than 0");return this.config.deliver_policy=te.StartSequence,this.config.opt_start_seq=e,this}startTime(e){return this.config.deliver_policy=te.StartTime,this.config.opt_start_time=e.toISOString(),this}deliverAll(){return this.config.deliver_policy=te.All,this}deliverLastPerSubject(){return this.config.deliver_policy=te.LastPerSubject,this}deliverLast(){return this.config.deliver_policy=te.Last,this}deliverNew(){return this.config.deliver_policy=te.New,this}startAtTimeDelta(e){return this.startTime(new Date(Date.now()-e)),this}headersOnly(){return this.config.headers_only=!0,this}ackNone(){return this.config.ack_policy=ie.None,this}ackAll(){return this.config.ack_policy=ie.All,this}ackExplicit(){return this.config.ack_policy=ie.Explicit,this}ackWait(e){return this.config.ack_wait=X(e),this}maxDeliver(e){return this.config.max_deliver=e,this}filterSubject(e){return this.filters=this.filters||[],this.filters.push(e),this}replayInstantly(){return this.config.replay_policy=Ft.Instant,this}replayOriginal(){return this.config.replay_policy=Ft.Original,this}sample(e){if(e=Math.trunc(e),e<0||e>100)throw new Error("value must be between 0-100");return this.config.sample_freq=`${e}%`,this}limit(e){return this.config.rate_limit_bps=e,this}maxWaiting(e){return this.config.max_waiting=e,this}maxAckPending(e){return this.config.max_ack_pending=e,this}idleHeartbeat(e){return this.config.idle_heartbeat=X(e),this}flowControl(){return this.config.flow_control=!0,this}deliverGroup(e){return this.queue(e),this}manualAck(){return this.mack=!0,this}maxMessages(e){return this.max=e,this}callback(e){return this.callbackFn=e,this}queue(e){return this.qname=e,this.config.deliver_group=e,this}orderedConsumer(){return this.ordered=!0,this}bind(e,t){return this.stream=e,this.config.durable_name=t,this.isBind=!0,this}bindStream(e){return this.stream=e,this}inactiveEphemeralThreshold(e){return this.config.inactive_threshold=X(e),this}maxPullBatch(e){return this.config.max_batch=e,this}maxPullRequestExpires(e){return this.config.max_expires=X(e),this}memory(){return this.config.mem_storage=!0,this}numReplicas(e){return this.config.num_replicas=e,this}consumerName(e){return this.config.name=e,this}}function nt(r){return new Eh(r)}function Ji(r){return typeof r.getOpts=="function"}class Ph{static encode(e){if(typeof e=="string")return btoa(e);const t=Array.from(e);return btoa(String.fromCharCode(...t))}static decode(e,t=!1){const n=atob(e);return t?Uint8Array.from(n,s=>s.charCodeAt(0)):n}}class ar{static encode(e){return ar.toB64URLEncoding(Ph.encode(e))}static decode(e,t=!1){return ar.decode(ar.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}class Dt{constructor(){u(this,"buffers");u(this,"byteLength");this.buffers=[],this.byteLength=0}static concat(...e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].length;const n=new Uint8Array(t);let s=0;for(let i=0;i<e.length;i++)n.set(e[i],s),s+=e[i].length;return n}static fromAscii(e){return e||(e=""),at.encode(e)}static toAscii(e){return ge.decode(e)}reset(){this.buffers.length=0,this.byteLength=0}pack(){if(this.buffers.length>1){const e=new Uint8Array(this.byteLength);let t=0;for(let n=0;n<this.buffers.length;n++)e.set(this.buffers[n],t),t+=this.buffers[n].length;this.buffers.length=0,this.buffers.push(e)}}shift(){if(this.buffers.length){const e=this.buffers.shift();if(e)return this.byteLength-=e.length,e}return new Uint8Array(0)}drain(e){if(this.buffers.length){this.pack();const t=this.buffers.pop();if(t){const n=this.byteLength;(e===void 0||e>n)&&(e=n);const s=t.subarray(0,e);return n>e&&this.buffers.push(t.subarray(e)),this.byteLength=n-e,s}}return new Uint8Array(0)}fill(e,...t){e&&(this.buffers.push(e),this.byteLength+=e.length);for(let n=0;n<t.length;n++)t[n]&&t[n].length&&(this.buffers.push(t[n]),this.byteLength+=t[n].length)}peek(){return this.buffers.length?(this.pack(),this.buffers[0]):new Uint8Array(0)}size(){return this.byteLength}length(){return this.buffers.length}}function Gi(r){const e=r.length;let t=r.indexOf("=");t===-1&&(t=e);const n=t===e?0:4-t%4;return[t,n]}function Ch(r,e,t=!1){function n(o,a){return Math.floor((o+a)*3/4-a)}function s(o){return r[o>>18&63]+r[o>>12&63]+r[o>>6&63]+r[o&63]}function i(o,a,c){const h=new Array((c-a)/3);for(let m=a,p=0;m<c;m+=3)h[p++]=s((o[m]<<16)+(o[m+1]<<8)+o[m+2]);return h.join("")}return{byteLength(o){return n.apply(null,Gi(o))},toUint8Array(o){const[a,c]=Gi(o),h=new Uint8Array(n(a,c)),m=c?a-4:a;let p,x=0,g;for(g=0;g<m;g+=4)p=e[o.charCodeAt(g)]<<18|e[o.charCodeAt(g+1)]<<12|e[o.charCodeAt(g+2)]<<6|e[o.charCodeAt(g+3)],h[x++]=p>>16&255,h[x++]=p>>8&255,h[x++]=p&255;return c===2?(p=e[o.charCodeAt(g)]<<2|e[o.charCodeAt(g+1)]>>4,h[x++]=p&255):c===1&&(p=e[o.charCodeAt(g)]<<10|e[o.charCodeAt(g+1)]<<4|e[o.charCodeAt(g+2)]>>2,h[x++]=p>>8&255,h[x++]=p&255),h},fromUint8Array(o){const c=o.length,h=c%3,m=c-h,p=new Array(Math.ceil(m/16383)+(h?1:0));let x=0,g;for(let I=0;I<m;I+=16383)g=I+16383,p[x++]=i(o,I,g>m?m:g);let v;return h===1?(v=o[m],p[x]=r[v>>2]+r[v<<4&63],t||(p[x]+="==")):h===2&&(v=o[m]<<8|o[m+1]&255,p[x]=r[v>>10]+r[v>>4&63]+r[v<<2&63],t||(p[x]+="=")),p.join("")}}}const Oa=[],Aa=[],Nn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";for(let r=0,e=Nn.length;r<e;++r)Oa[r]=Nn[r],Aa[Nn.charCodeAt(r)]=r;const{byteLength:Df,toUint8Array:Oh,fromUint8Array:Ah}=Ch(Oa,Aa,!0),Ih=new TextDecoder,Th=new TextEncoder;function Rh(r){return r.reduce((e,t)=>`${e}${t<16?"0":""}${t.toString(16)}`,"")}function jh(r){const e=r.length;if(e%2||!/^[0-9a-fA-F]+$/.test(r))throw new TypeError("Invalid hex string.");r=r.toLowerCase();const t=new Uint8Array(Math.floor(e/2)),n=e/2;for(let s=0;s<n;++s)t[s]=parseInt(r.substr(s*2,2),16);return t}function Mh(r,e="utf8"){if(/^utf-?8$/i.test(e))return Ih.decode(r);if(/^base64$/i.test(e))return Ah(r);if(/^hex(?:adecimal)?$/i.test(e))return Rh(r);throw new TypeError("Unsupported string encoding.")}function Nh(r,e="utf8"){if(/^utf-?8$/i.test(e))return Th.encode(r);if(/^base64$/i.test(e))return Oh(r);if(/^hex(?:adecimal)?$/i.test(e))return jh(r);throw new TypeError("Unsupported string encoding.")}class Yi{constructor(){u(this,"hashSize",32);u(this,"_buf");u(this,"_bufIdx");u(this,"_count");u(this,"_K");u(this,"_H");u(this,"_finalized");this._buf=new Uint8Array(64),this._K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),this.init()}init(){return this._H=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),this._bufIdx=0,this._count=new Uint32Array(2),this._buf.fill(0),this._finalized=!1,this}update(e,t){if(e===null)throw new TypeError("msg must be a string or Uint8Array.");typeof e=="string"&&(e=Nh(e,t));for(let s=0,i=e.length;s<i;s++)this._buf[this._bufIdx++]=e[s],this._bufIdx===64&&(this._transform(),this._bufIdx=0);const n=this._count;return(n[0]+=e.length<<3)<e.length<<3&&n[1]++,n[1]+=e.length>>>29,this}digest(e){if(this._finalized)throw new Error("digest has already been called.");this._finalized=!0;const t=this._buf;let n=this._bufIdx;for(t[n++]=128;n!==56;)n===64&&(this._transform(),n=0),t[n++]=0;const s=this._count;t[56]=s[1]>>>24&255,t[57]=s[1]>>>16&255,t[58]=s[1]>>>8&255,t[59]=s[1]>>>0&255,t[60]=s[0]>>>24&255,t[61]=s[0]>>>16&255,t[62]=s[0]>>>8&255,t[63]=s[0]>>>0&255,this._transform();const i=new Uint8Array(32);for(let o=0;o<8;o++)i[(o<<2)+0]=this._H[o]>>>24&255,i[(o<<2)+1]=this._H[o]>>>16&255,i[(o<<2)+2]=this._H[o]>>>8&255,i[(o<<2)+3]=this._H[o]>>>0&255;return this.init(),e?Mh(i,e):i}_transform(){const e=this._H;let t=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],h=e[7];const m=new Uint32Array(16);let p;for(p=0;p<16;p++)m[p]=this._buf[(p<<2)+3]|this._buf[(p<<2)+2]<<8|this._buf[(p<<2)+1]<<16|this._buf[p<<2]<<24;for(p=0;p<64;p++){let x;if(p<16)x=m[p];else{let g=m[p+1&15],v=m[p+14&15];x=m[p&15]=(g>>>7^g>>>18^g>>>3^g<<25^g<<14)+(v>>>17^v>>>19^v>>>10^v<<15^v<<13)+m[p&15]+m[p+9&15]|0}x=x+h+(o>>>6^o>>>11^o>>>25^o<<26^o<<21^o<<7)+(c^o&(a^c))+this._K[p]|0,h=c,c=a,a=o,o=i+x,i=s,s=n,n=t,t=x+(n&s^i&(n^s))+(n>>>2^n>>>13^n>>>22^n<<30^n<<19^n<<10)|0}e[0]=e[0]+t|0,e[1]=e[1]+n|0,e[2]=e[2]+s|0,e[3]=e[3]+i|0,e[4]=e[4]+o|0,e[5]=e[5]+a|0,e[6]=e[6]+c|0,e[7]=e[7]+h|0}}class Ia{constructor(e,t,n=!0){u(this,"token");u(this,"received");u(this,"ctx");u(this,"requestSubject");u(this,"mux");this.mux=e,this.requestSubject=t,this.received=0,this.token=gt.next(),n&&(this.ctx=new Error)}}class $h extends Ia{constructor(t,n,s={maxWait:1e3}){super(t,n);u(this,"callback");u(this,"done");u(this,"timer");u(this,"max");u(this,"opts");if(this.opts=s,typeof this.opts.callback!="function")throw new Error("callback is required");this.callback=this.opts.callback,this.max=typeof s.maxMessages=="number"&&s.maxMessages>0?s.maxMessages:-1,this.done=G(),this.done.then(()=>{this.callback(null,null)}),this.timer=setTimeout(()=>{this.cancel()},s.maxWait)}cancel(t){t&&this.callback(t,null),clearTimeout(this.timer),this.mux.cancel(this),this.done.resolve()}resolver(t,n){t?(this.ctx&&(t.stack+=`

${this.ctx.stack}`),this.cancel(t)):(this.callback(null,n),this.opts.strategy===Te.Count&&(this.max--,this.max===0&&this.cancel()),this.opts.strategy===Te.JitterTimer&&(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.cancel()},this.opts.jitter||300)),this.opts.strategy===Te.SentinelMsg&&n&&n.data.length===0&&this.cancel())}}class Ta extends Ia{constructor(t,n,s={timeout:1e3},i=!0){super(t,n,i);u(this,"deferred");u(this,"timer");this.deferred=G(),this.timer=Ut(s.timeout,i)}resolver(t,n){this.timer&&this.timer.cancel(),t?(this.ctx&&(t.stack+=`

${this.ctx.stack}`),this.deferred.reject(t)):this.deferred.resolve(n),this.cancel()}cancel(t){this.timer&&this.timer.cancel(),this.mux.cancel(this),this.deferred.reject(t||T.errorForCode(P.Cancelled))}}const Bh="$JS.API";function Lh(r){return r=r||{},r.domain&&(r.apiPrefix=`$JS.${r.domain}.API`,delete r.domain),on({apiPrefix:Bh,timeout:5e3},r)}class vr{constructor(e,t){u(this,"nc");u(this,"opts");u(this,"prefix");u(this,"timeout");u(this,"jc");this.nc=e,this.opts=Lh(t),this._parseOpts(),this.prefix=this.opts.apiPrefix,this.timeout=this.opts.timeout,this.jc=Pe()}getOptions(){return Object.assign({},this.opts)}_parseOpts(){let e=this.opts.apiPrefix;if(!e||e.length===0)throw new Error("invalid empty prefix");e[e.length-1]==="."&&(e=e.substr(0,e.length-1)),this.opts.apiPrefix=e}async _request(e,t=null,n){n=n||{},n.timeout=this.timeout;let s=xe;t&&(s=this.jc.encode(t));let{retries:i}=n;i=i||1,i=i===-1?Number.MAX_SAFE_INTEGER:i;const o=Bs();for(let a=0;a<i;a++)try{const c=await this.nc.request(e,s,n);return this.parseJsResponse(c)}catch(c){const h=c;if((h.code==="503"||h.code===P.Timeout)&&a+1<i)await Vt(o.backoff(a));else throw c}}async findStream(e){const t={subject:e},s=await this._request(`${this.prefix}.STREAM.NAMES`,t);if(!s.streams||s.streams.length!==1)throw new Error("no stream matches subject");return s.streams[0]}getConnection(){return this.nc}parseJsResponse(e){const t=this.jc.decode(e.data),n=t;if(n.error){const s=Ca(n.error.code,n.error.description);if(s!==null)throw s.api_error=n.error,s}return t}}class tr{constructor(e,t,n,s){u(this,"err");u(this,"offset");u(this,"pageInfo");u(this,"subject");u(this,"jsm");u(this,"filter");u(this,"payload");if(!e)throw new Error("subject is required");this.subject=e,this.jsm=n,this.offset=0,this.pageInfo={},this.filter=t,this.payload=s||{}}async next(){if(this.err)return[];if(this.pageInfo&&this.offset>=this.pageInfo.total)return[];const e={offset:this.offset};this.payload&&Object.assign(e,this.payload);try{const t=await this.jsm._request(this.subject,e,{timeout:this.jsm.timeout});this.pageInfo=t;const n=this.countResponse(t);return n===0?[]:(this.offset+=n,this.filter(t))}catch(t){throw this.err=t,t}}countResponse(e){var t,n,s;switch(e==null?void 0:e.type){case"io.nats.jetstream.api.v1.stream_names_response":case"io.nats.jetstream.api.v1.stream_list_response":return((t=e.streams)==null?void 0:t.length)||0;case"io.nats.jetstream.api.v1.consumer_list_response":return((n=e.consumers)==null?void 0:n.length)||0;default:return console.error(`jslister.ts: unknown API response for paged output: ${e==null?void 0:e.type}`),((s=e.streams)==null?void 0:s.length)||0}return 0}async*[Symbol.asyncIterator](){let e=await this.next();for(;e.length>0;){for(const t of e)yield t;e=await this.next()}}}function dt(r=""){const e=r.match(/(\d+).(\d+).(\d+)/);if(e)return{major:parseInt(e[1]),minor:parseInt(e[2]),micro:parseInt(e[3])};throw new Error(`'${r}' is not a semver value`)}function ss(r,e){return r.major<e.major?-1:r.major>e.major?1:r.minor<e.minor?-1:r.minor>e.minor?1:r.micro<e.micro?-1:r.micro>e.micro?1:0}var q;(function(r){r.JS_KV="js_kv",r.JS_OBJECTSTORE="js_objectstore",r.JS_PULL_MAX_BYTES="js_pull_max_bytes",r.JS_NEW_CONSUMER_CREATE_API="js_new_consumer_create",r.JS_ALLOW_DIRECT="js_allow_direct",r.JS_MULTIPLE_CONSUMER_FILTER="js_multiple_consumer_filter",r.JS_SIMPLIFICATION="js_simplification",r.JS_STREAM_CONSUMER_METADATA="js_stream_consumer_metadata",r.JS_CONSUMER_FILTER_SUBJECTS="js_consumer_filter_subjects",r.JS_STREAM_FIRST_SEQ="js_stream_first_seq",r.JS_STREAM_SUBJECT_TRANSFORM="js_stream_subject_transform",r.JS_STREAM_SOURCE_SUBJECT_TRANSFORM="js_stream_source_subject_transform",r.JS_STREAM_COMPRESSION="js_stream_compression",r.JS_DEFAULT_CONSUMER_LIMITS="js_default_consumer_limits",r.JS_BATCH_DIRECT_GET="js_batch_direct_get"})(q||(q={}));class Uh{constructor(e){u(this,"server");u(this,"features");u(this,"disabled");this.features=new Map,this.disabled=[],this.update(e)}resetDisabled(){this.disabled.length=0,this.update(this.server)}disable(e){this.disabled.push(e),this.update(this.server)}isDisabled(e){return this.disabled.indexOf(e)!==-1}update(e){typeof e=="string"&&(e=dt(e)),this.server=e,this.set(q.JS_KV,"2.6.2"),this.set(q.JS_OBJECTSTORE,"2.6.3"),this.set(q.JS_PULL_MAX_BYTES,"2.8.3"),this.set(q.JS_NEW_CONSUMER_CREATE_API,"2.9.0"),this.set(q.JS_ALLOW_DIRECT,"2.9.0"),this.set(q.JS_MULTIPLE_CONSUMER_FILTER,"2.10.0"),this.set(q.JS_SIMPLIFICATION,"2.9.4"),this.set(q.JS_STREAM_CONSUMER_METADATA,"2.10.0"),this.set(q.JS_CONSUMER_FILTER_SUBJECTS,"2.10.0"),this.set(q.JS_STREAM_FIRST_SEQ,"2.10.0"),this.set(q.JS_STREAM_SUBJECT_TRANSFORM,"2.10.0"),this.set(q.JS_STREAM_SOURCE_SUBJECT_TRANSFORM,"2.10.0"),this.set(q.JS_STREAM_COMPRESSION,"2.10.0"),this.set(q.JS_DEFAULT_CONSUMER_LIMITS,"2.10.0"),this.set(q.JS_BATCH_DIRECT_GET,"2.11.0"),this.disabled.forEach(t=>{this.features.delete(t)})}set(e,t){this.features.set(e,{min:t,ok:ss(this.server,dt(t))>=0})}get(e){return this.features.get(e)||{min:"unknown",ok:!1}}supports(e){var t;return((t=this.get(e))==null?void 0:t.ok)||!1}require(e){return typeof e=="string"&&(e=dt(e)),ss(this.server,e)>=0}}class Ds extends vr{constructor(e,t){super(e,t)}async add(e,t,n=Kr.Create){if(ue(e),t.deliver_group&&t.flow_control)throw new Error("jetstream flow control is not supported with queue groups");if(t.deliver_group&&t.idle_heartbeat)throw new Error("jetstream idle heartbeat is not supported with queue groups");const s={};s.config=t,s.stream_name=e,s.action=n,s.config.durable_name&&Tt(s.config.durable_name);const i=this.nc;let{min:o,ok:a}=i.features.get(q.JS_NEW_CONSUMER_CREATE_API);const c=t.name===""?void 0:t.name;if(c&&!a)throw new Error(`consumer 'name' requires server ${o}`);if(c)try{an("name",c)}catch(x){const g=x.message,v=g.indexOf("cannot contain");throw v!==-1?new Error(`consumer 'name' ${g.substring(v)}`):x}let h,m="";if(Array.isArray(t.filter_subjects)){const{min:x,ok:g}=i.features.get(q.JS_MULTIPLE_CONSUMER_FILTER);if(!g)throw new Error(`consumer 'filter_subjects' requires server ${x}`);a=!1}if(t.metadata){const{min:x,ok:g}=i.features.get(q.JS_STREAM_CONSUMER_METADATA);if(!g)throw new Error(`consumer 'metadata' requires server ${x}`)}if(a&&(m=t.name??t.durable_name??""),m!==""){let x=t.filter_subject??void 0;x===">"&&(x=void 0),h=x!==void 0?`${this.prefix}.CONSUMER.CREATE.${e}.${m}.${x}`:`${this.prefix}.CONSUMER.CREATE.${e}.${m}`}else h=t.durable_name?`${this.prefix}.CONSUMER.DURABLE.CREATE.${e}.${t.durable_name}`:`${this.prefix}.CONSUMER.CREATE.${e}`;return await this._request(h,s)}async update(e,t,n){const s=await this.info(e,t),i=n;return this.add(e,Object.assign(s.config,i),Kr.Update)}async info(e,t){return ue(e),Tt(t),await this._request(`${this.prefix}.CONSUMER.INFO.${e}.${t}`)}async delete(e,t){return ue(e),Tt(t),(await this._request(`${this.prefix}.CONSUMER.DELETE.${e}.${t}`)).success}list(e){ue(e);const t=s=>s.consumers,n=`${this.prefix}.CONSUMER.LIST.${e}`;return new tr(n,t,this)}pause(e,t,n){const s=`${this.prefix}.CONSUMER.PAUSE.${e}.${t}`,i={pause_until:n.toISOString()};return this._request(s,i)}resume(e,t){return this.pause(e,t,new Date(0))}}function kt(r,e,t=!1){if(t===!0&&!r)throw T.errorForCode(P.ApiError,new Error(`${e} is not a function`));if(r&&typeof r!="function")throw T.errorForCode(P.ApiError,new Error(`${e} is not a function`))}class Fh extends oe{constructor(t,n,s){super();u(this,"sub");u(this,"adapter");u(this,"subIterDone");kt(s.adapter,"adapter",!0),this.adapter=s.adapter,s.callback&&kt(s.callback,"callback"),this.noIterator=typeof s.callback=="function",s.ingestionFilterFn&&(kt(s.ingestionFilterFn,"ingestionFilterFn"),this.ingestionFilterFn=s.ingestionFilterFn),s.protocolFilterFn&&(kt(s.protocolFilterFn,"protocolFilterFn"),this.protocolFilterFn=s.protocolFilterFn),s.dispatchedFn&&(kt(s.dispatchedFn,"dispatchedFn"),this.dispatchedFn=s.dispatchedFn),s.cleanupFn&&kt(s.cleanupFn,"cleanupFn");let i=(m,p)=>{this.callback(m,p)};if(s.callback){const m=s.callback;i=(p,x)=>{const[g,v]=this.adapter(p,x);if(g){m(g,null);return}const{ingest:I}=this.ingestionFilterFn?this.ingestionFilterFn(v,this):{ingest:!0};I&&(!this.protocolFilterFn||this.protocolFilterFn(v))&&(m(g,v),this.dispatchedFn&&v&&this.dispatchedFn(v))}}const{max:o,queue:a,timeout:c}=s,h={queue:a,timeout:c,callback:i};o&&o>0&&(h.max=o),this.sub=t.subscribe(n,h),s.cleanupFn&&(this.sub.cleanupFn=s.cleanupFn),this.noIterator||this.iterClosed.then(()=>{this.unsubscribe()}),this.subIterDone=G(),Promise.all([this.sub.closed,this.iterClosed]).then(()=>{this.subIterDone.resolve()}).catch(()=>{this.subIterDone.resolve()}),(async m=>{await m.closed,this.stop()})(this.sub).then().catch()}unsubscribe(t){this.sub.unsubscribe(t)}drain(){return this.sub.drain()}isDraining(){return this.sub.isDraining()}isClosed(){return this.sub.isClosed()}callback(t,n){this.sub.cancelTimeout();const[s,i]=this.adapter(t,n);s&&this.stop(s),i&&this.push(i)}getSubject(){return this.sub.getSubject()}getReceived(){return this.sub.getReceived()}getProcessed(){return this.sub.getProcessed()}getPending(){return this.sub.getPending()}getID(){return this.sub.getID()}getMax(){return this.sub.getMax()}get closed(){return this.sub.closed}}let ye;function Dh(r){ye=r}function Ra(){return ye!==void 0&&ye.defaultPort!==void 0?ye.defaultPort:4222}function $n(){return ye!==void 0&&ye.urlParseFn?ye.urlParseFn:void 0}function qh(){if(!ye||typeof ye.factory!="function")throw new Error("transport fn is not set");return ye.factory()}function is(){return ye!==void 0&&ye.dnsResolveFn?ye.dnsResolveFn:void 0}const qr=`\r
`,Xr=Dt.fromAscii(qr),Wh=new Uint8Array(Xr)[0],Hh=new Uint8Array(Xr)[1];function Vh(r){for(let e=0;e<r.length;e++){const t=e+1;if(r.byteLength>t&&r[e]===Wh&&r[t]===Hh)return t+1}return 0}function zh(r){const e=Vh(r);if(e>0){const n=new Uint8Array(r).slice(0,e);return ge.decode(n)}return""}const Jh=4,ja=48,Gh=65,Yh=97;function Kh(r,e,t,n){const s=new Uint8Array(16);return[0,0,0,0,0,0,0,0,0,0,255,255].forEach((o,a)=>{s[a]=o}),s[12]=r,s[13]=e,s[14]=t,s[15]=n,s}function os(r){return Xh(r)!==void 0}function Xh(r){for(let e=0;e<r.length;e++)switch(r[e]){case".":return Ma(r);case":":return Zh(r)}}function Ma(r){const e=new Uint8Array(4);for(let t=0;t<4;t++){if(r.length===0)return;if(t>0){if(r[0]!==".")return;r=r.substring(1)}const{n,c:s,ok:i}=Qh(r);if(!i||n>255)return;r=r.substring(s),e[t]=n}return Kh(e[0],e[1],e[2],e[3])}function Zh(r){const e=new Uint8Array(16);let t=-1;if(r.length>=2&&r[0]===":"&&r[1]===":"&&(t=0,r=r.substring(2),r.length===0))return e;let n=0;for(;n<16;){const{n:s,c:i,ok:o}=ed(r);if(!o||s>65535)return;if(i<r.length&&r[i]==="."){if(t<0&&n!=12||n+4>16)return;const a=Ma(r);if(a===void 0)return;e[n]=a[12],e[n+1]=a[13],e[n+2]=a[14],e[n+3]=a[15],r="",n+=Jh;break}if(e[n]=s>>8,e[n+1]=s,n+=2,r=r.substring(i),r.length===0)break;if(r[0]!==":"||r.length==1)return;if(r=r.substring(1),r[0]===":"){if(t>=0)return;if(t=n,r=r.substring(1),r.length===0)break}}if(r.length===0){if(n<16){if(t<0)return;const s=16-n;for(let i=n-1;i>=t;i--)e[i+s]=e[i];for(let i=t+s-1;i>=t;i--)e[i]=0}else if(t>=0)return;return e}}function Qh(r){let e=0,t=0;for(e=0;e<r.length&&48<=r.charCodeAt(e)&&r.charCodeAt(e)<=57;e++)if(t=t*10+(r.charCodeAt(e)-ja),t>=16777215)return{n:16777215,c:e,ok:!1};return e===0?{n:0,c:0,ok:!1}:{n:t,c:e,ok:!0}}function ed(r){let e=0,t=0;for(t=0;t<r.length;t++){if(48<=r.charCodeAt(t)&&r.charCodeAt(t)<=57)e*=16,e+=r.charCodeAt(t)-ja;else if(97<=r.charCodeAt(t)&&r.charCodeAt(t)<=102)e*=16,e+=r.charCodeAt(t)-Yh+10;else if(65<=r.charCodeAt(t)&&r.charCodeAt(t)<=70)e*=16,e+=r.charCodeAt(t)-Gh+10;else break;if(e>=16777215)return{n:0,c:t,ok:!1}}return t===0?{n:0,c:t,ok:!1}:{n:e,c:t,ok:!0}}function td(r){return r.indexOf("[")!==-1||r.indexOf("::")!==-1?!1:r.indexOf(".")!==-1||r.split(":").length<=2}function as(r){return!td(r)}function rd(r){const e="::FFFF:",t=r.toUpperCase().indexOf(e);if(t!==-1&&r.indexOf(".")!==-1){let n=r.substring(t+e.length);return n=n.replace("[",""),n.replace("]","")}return r}function nd(r){r=r.trim(),r.match(/^(.*:\/\/)(.*)/m)&&(r=r.replace(/^(.*:\/\/)(.*)/gm,"$2")),r=rd(r),as(r)&&r.indexOf("[")===-1&&(r=`[${r}]`);const e=as(r)?r.match(/(]:)(\d+)/):r.match(/(:)(\d+)/),t=e&&e.length===3&&e[1]&&e[2]?parseInt(e[2]):4222,n=t===80?"https":"http",s=new URL(`${n}://${r}`);s.port=`${t}`;let i=s.hostname;return i.charAt(0)==="["&&(i=i.substring(1,i.length-1)),{listen:s.host,hostname:i,port:t}}class cr{constructor(e,t=!1){u(this,"src");u(this,"listen");u(this,"hostname");u(this,"port");u(this,"didConnect");u(this,"reconnects");u(this,"lastConnect");u(this,"gossiped");u(this,"tlsName");u(this,"resolves");this.src=e,this.tlsName="";const n=nd(e);this.listen=n.listen,this.hostname=n.hostname,this.port=n.port,this.didConnect=!1,this.reconnects=0,this.lastConnect=0,this.gossiped=t}toString(){return this.listen}async resolve(e){if(!e.fn||e.resolve===!1)return[this];const t=[];if(os(this.hostname))return[this];{const n=await e.fn(this.hostname);e.debug&&console.log(`resolve ${this.hostname} = ${n.join(",")}`);for(const s of n){const i=this.port===80?"https":"http",o=new URL(`${i}://${as(s)?"["+s+"]":s}`);o.port=`${this.port}`;const a=new cr(o.host,!1);a.tlsName=this.hostname,t.push(a)}}return e.randomize&&Ea(t),this.resolves=t,t}}class sd{constructor(e=[],t={}){u(this,"firstSelect");u(this,"servers");u(this,"currentServer");u(this,"tlsName");u(this,"randomize");this.firstSelect=!0,this.servers=[],this.tlsName="",this.randomize=t.randomize||!1;const n=$n();e&&(e.forEach(s=>{s=n?n(s):s,this.servers.push(new cr(s))}),this.randomize&&(this.servers=Ea(this.servers))),this.servers.length===0&&this.addServer(`${Qn}:${Ra()}`,!1),this.currentServer=this.servers[0]}clear(){this.servers.length=0}updateTLSName(){const e=this.getCurrentServer();os(e.hostname)||(this.tlsName=e.hostname,this.servers.forEach(t=>{t.gossiped&&(t.tlsName=this.tlsName)}))}getCurrentServer(){return this.currentServer}addServer(e,t=!1){const n=$n();e=n?n(e):e;const s=new cr(e,t);os(s.hostname)&&(s.tlsName=this.tlsName),this.servers.push(s)}selectServer(){if(this.firstSelect)return this.firstSelect=!1,this.currentServer;const e=this.servers.shift();return e&&(this.servers.push(e),this.currentServer=e),e}removeCurrentServer(){this.removeServer(this.currentServer)}removeServer(e){if(e){const t=this.servers.indexOf(e);this.servers.splice(t,1)}}length(){return this.servers.length}next(){return this.servers.length?this.servers[0]:void 0}getServers(){return this.servers}update(e,t){const n=[];let s=[];const i=$n(),o=new Map;e.connect_urls&&e.connect_urls.length>0&&e.connect_urls.forEach(c=>{c=i?i(c,t):c;const h=new cr(c,!0);o.set(c,h)});const a=[];return this.servers.forEach((c,h)=>{const m=c.listen;c.gossiped&&this.currentServer.listen!==m&&o.get(m)===void 0&&a.push(h),o.delete(m)}),a.reverse(),a.forEach(c=>{const h=this.servers.splice(c,1);s=s.concat(h[0].listen)}),o.forEach((c,h)=>{this.servers.push(c),n.push(h)}),{added:n,deleted:s}}}class id{constructor(){u(this,"baseInbox");u(this,"reqs");this.reqs=new Map}size(){return this.reqs.size}init(e){return this.baseInbox=`${Je(e)}.`,this.baseInbox}add(e){isNaN(e.received)||(e.received=0),this.reqs.set(e.token,e)}get(e){return this.reqs.get(e)}cancel(e){this.reqs.delete(e.token)}getToken(e){const t=e.subject||"";return t.indexOf(this.baseInbox)===0?t.substring(this.baseInbox.length):null}all(){return Array.from(this.reqs.values())}handleError(e,t){if(t&&t.permissionContext){if(e)return this.all().forEach(s=>{s.resolver(t,{})}),!0;const n=t.permissionContext;if(n.operation==="publish"){const s=this.all().find(i=>i.requestSubject===n.subject);if(s)return s.resolver(t,{}),!0}}return!1}dispatcher(){return(e,t)=>{const n=this.getToken(t);if(n){const s=this.get(n);s&&(e===null&&t.headers&&(e=Pa(t)),s.resolver(e,t))}}}close(){const e=T.errorForCode(P.Timeout);this.reqs.forEach(t=>{t.resolver(e,{})})}}class od{constructor(e,t,n){u(this,"ph");u(this,"interval");u(this,"maxOut");u(this,"timer");u(this,"pendings");this.ph=e,this.interval=t,this.maxOut=n,this.pendings=[]}start(){this.cancel(),this._schedule()}cancel(e){this.timer&&(clearTimeout(this.timer),this.timer=void 0),this._reset(),e&&this.ph.disconnect()}_schedule(){this.timer=setTimeout(()=>{if(this.ph.dispatchStatus({type:It.PingTimer,data:`${this.pendings.length+1}`}),this.pendings.length===this.maxOut){this.cancel(!0);return}const e=G();this.ph.flush(e).then(()=>{this._reset()}).catch(()=>{this.cancel()}),this.pendings.push(e),this._schedule()},this.interval)}_reset(){this.pendings=this.pendings.filter(e=>(e.resolve(),!1))}}class ad extends Error{constructor(e){super(e),this.name="AssertionError"}}function cd(r,e="Assertion failed."){if(!r)throw new ad(e)}const Ki=32*1024,Bn=2**32-2;function Br(r,e,t=0){const n=e.byteLength-t;return r.byteLength>n&&(r=r.subarray(0,n)),e.set(r,t),r.byteLength}class Ln{constructor(e){u(this,"_buf");u(this,"_off");if(this._off=0,e==null){this._buf=new Uint8Array(0);return}this._buf=new Uint8Array(e)}bytes(e={copy:!0}){return e.copy===!1?this._buf.subarray(this._off):this._buf.slice(this._off)}empty(){return this._buf.byteLength<=this._off}get length(){return this._buf.byteLength-this._off}get capacity(){return this._buf.buffer.byteLength}truncate(e){if(e===0){this.reset();return}if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this._reslice(this._off+e)}reset(){this._reslice(0),this._off=0}_tryGrowByReslice(e){const t=this._buf.byteLength;return e<=this.capacity-t?(this._reslice(t+e),t):-1}_reslice(e){cd(e<=this._buf.buffer.byteLength),this._buf=new Uint8Array(this._buf.buffer,0,e)}readByte(){const e=new Uint8Array(1);return this.read(e)?e[0]:null}read(e){if(this.empty())return this.reset(),e.byteLength===0?0:null;const t=Br(this._buf.subarray(this._off),e);return this._off+=t,t}writeByte(e){return this.write(Uint8Array.of(e))}writeString(e){return this.write(at.encode(e))}write(e){const t=this._grow(e.byteLength);return Br(e,this._buf,t)}_grow(e){const t=this.length;t===0&&this._off!==0&&this.reset();const n=this._tryGrowByReslice(e);if(n>=0)return n;const s=this.capacity;if(e<=Math.floor(s/2)-t)Br(this._buf.subarray(this._off),this._buf);else{if(s+e>Bn)throw new Error("The buffer cannot be grown beyond the maximum size.");{const i=new Uint8Array(Math.min(2*s+e,Bn));Br(this._buf.subarray(this._off),i),this._buf=i}}return this._off=0,this._reslice(Math.min(t+e,Bn)),t}grow(e){if(e<0)throw Error("Buffer._grow: negative count");const t=this._grow(e);this._reslice(t)}readFrom(e){let t=0;const n=new Uint8Array(Ki);for(;;){const s=this.capacity-this.length<Ki,i=s?n:new Uint8Array(this._buf.buffer,this.length),o=e.read(i);if(o===null)return t;s?this.write(i.subarray(0,o)):this._reslice(this.length+o),t+=o}}}var he;(function(r){r[r.OK=0]="OK",r[r.ERR=1]="ERR",r[r.MSG=2]="MSG",r[r.INFO=3]="INFO",r[r.PING=4]="PING",r[r.PONG=5]="PONG"})(he||(he={}));function Xi(){const r={};return r.sid=-1,r.hdr=-1,r.size=-1,r}const ld=48;class Zi{constructor(e){u(this,"dispatcher");u(this,"state");u(this,"as");u(this,"drop");u(this,"hdr");u(this,"ma");u(this,"argBuf");u(this,"msgBuf");this.dispatcher=e,this.state=O.OP_START,this.as=0,this.drop=0,this.hdr=0}parse(e){let t;for(t=0;t<e.length;t++){const n=e[t];switch(this.state){case O.OP_START:switch(n){case A.M:case A.m:this.state=O.OP_M,this.hdr=-1,this.ma=Xi();break;case A.H:case A.h:this.state=O.OP_H,this.hdr=0,this.ma=Xi();break;case A.P:case A.p:this.state=O.OP_P;break;case A.PLUS:this.state=O.OP_PLUS;break;case A.MINUS:this.state=O.OP_MINUS;break;case A.I:case A.i:this.state=O.OP_I;break;default:throw this.fail(e.subarray(t))}break;case O.OP_H:switch(n){case A.M:case A.m:this.state=O.OP_M;break;default:throw this.fail(e.subarray(t))}break;case O.OP_M:switch(n){case A.S:case A.s:this.state=O.OP_MS;break;default:throw this.fail(e.subarray(t))}break;case O.OP_MS:switch(n){case A.G:case A.g:this.state=O.OP_MSG;break;default:throw this.fail(e.subarray(t))}break;case O.OP_MSG:switch(n){case A.SPACE:case A.TAB:this.state=O.OP_MSG_SPC;break;default:throw this.fail(e.subarray(t))}break;case O.OP_MSG_SPC:switch(n){case A.SPACE:case A.TAB:continue;default:this.state=O.MSG_ARG,this.as=t}break;case O.MSG_ARG:switch(n){case A.CR:this.drop=1;break;case A.NL:{const s=this.argBuf?this.argBuf.bytes():e.subarray(this.as,t-this.drop);this.processMsgArgs(s),this.drop=0,this.as=t+1,this.state=O.MSG_PAYLOAD,t=this.as+this.ma.size-1;break}default:this.argBuf&&this.argBuf.writeByte(n)}break;case O.MSG_PAYLOAD:if(this.msgBuf)if(this.msgBuf.length>=this.ma.size){const s=this.msgBuf.bytes({copy:!1});this.dispatcher.push({kind:he.MSG,msg:this.ma,data:s}),this.argBuf=void 0,this.msgBuf=void 0,this.state=O.MSG_END}else{let s=this.ma.size-this.msgBuf.length;const i=e.length-t;i<s&&(s=i),s>0?(this.msgBuf.write(e.subarray(t,t+s)),t=t+s-1):this.msgBuf.writeByte(n)}else t-this.as>=this.ma.size&&(this.dispatcher.push({kind:he.MSG,msg:this.ma,data:e.subarray(this.as,t)}),this.argBuf=void 0,this.msgBuf=void 0,this.state=O.MSG_END);break;case O.MSG_END:switch(n){case A.NL:this.drop=0,this.as=t+1,this.state=O.OP_START;break;default:continue}break;case O.OP_PLUS:switch(n){case A.O:case A.o:this.state=O.OP_PLUS_O;break;default:throw this.fail(e.subarray(t))}break;case O.OP_PLUS_O:switch(n){case A.K:case A.k:this.state=O.OP_PLUS_OK;break;default:throw this.fail(e.subarray(t))}break;case O.OP_PLUS_OK:switch(n){case A.NL:this.dispatcher.push({kind:he.OK}),this.drop=0,this.state=O.OP_START;break}break;case O.OP_MINUS:switch(n){case A.E:case A.e:this.state=O.OP_MINUS_E;break;default:throw this.fail(e.subarray(t))}break;case O.OP_MINUS_E:switch(n){case A.R:case A.r:this.state=O.OP_MINUS_ER;break;default:throw this.fail(e.subarray(t))}break;case O.OP_MINUS_ER:switch(n){case A.R:case A.r:this.state=O.OP_MINUS_ERR;break;default:throw this.fail(e.subarray(t))}break;case O.OP_MINUS_ERR:switch(n){case A.SPACE:case A.TAB:this.state=O.OP_MINUS_ERR_SPC;break;default:throw this.fail(e.subarray(t))}break;case O.OP_MINUS_ERR_SPC:switch(n){case A.SPACE:case A.TAB:continue;default:this.state=O.MINUS_ERR_ARG,this.as=t}break;case O.MINUS_ERR_ARG:switch(n){case A.CR:this.drop=1;break;case A.NL:{let s;this.argBuf?(s=this.argBuf.bytes(),this.argBuf=void 0):s=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:he.ERR,data:s}),this.drop=0,this.as=t+1,this.state=O.OP_START;break}default:this.argBuf&&this.argBuf.write(Uint8Array.of(n))}break;case O.OP_P:switch(n){case A.I:case A.i:this.state=O.OP_PI;break;case A.O:case A.o:this.state=O.OP_PO;break;default:throw this.fail(e.subarray(t))}break;case O.OP_PO:switch(n){case A.N:case A.n:this.state=O.OP_PON;break;default:throw this.fail(e.subarray(t))}break;case O.OP_PON:switch(n){case A.G:case A.g:this.state=O.OP_PONG;break;default:throw this.fail(e.subarray(t))}break;case O.OP_PONG:switch(n){case A.NL:this.dispatcher.push({kind:he.PONG}),this.drop=0,this.state=O.OP_START;break}break;case O.OP_PI:switch(n){case A.N:case A.n:this.state=O.OP_PIN;break;default:throw this.fail(e.subarray(t))}break;case O.OP_PIN:switch(n){case A.G:case A.g:this.state=O.OP_PING;break;default:throw this.fail(e.subarray(t))}break;case O.OP_PING:switch(n){case A.NL:this.dispatcher.push({kind:he.PING}),this.drop=0,this.state=O.OP_START;break}break;case O.OP_I:switch(n){case A.N:case A.n:this.state=O.OP_IN;break;default:throw this.fail(e.subarray(t))}break;case O.OP_IN:switch(n){case A.F:case A.f:this.state=O.OP_INF;break;default:throw this.fail(e.subarray(t))}break;case O.OP_INF:switch(n){case A.O:case A.o:this.state=O.OP_INFO;break;default:throw this.fail(e.subarray(t))}break;case O.OP_INFO:switch(n){case A.SPACE:case A.TAB:this.state=O.OP_INFO_SPC;break;default:throw this.fail(e.subarray(t))}break;case O.OP_INFO_SPC:switch(n){case A.SPACE:case A.TAB:continue;default:this.state=O.INFO_ARG,this.as=t}break;case O.INFO_ARG:switch(n){case A.CR:this.drop=1;break;case A.NL:{let s;this.argBuf?(s=this.argBuf.bytes(),this.argBuf=void 0):s=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:he.INFO,data:s}),this.drop=0,this.as=t+1,this.state=O.OP_START;break}default:this.argBuf&&this.argBuf.writeByte(n)}break;default:throw this.fail(e.subarray(t))}}(this.state===O.MSG_ARG||this.state===O.MINUS_ERR_ARG||this.state===O.INFO_ARG)&&!this.argBuf&&(this.argBuf=new Ln(e.subarray(this.as,t-this.drop))),this.state===O.MSG_PAYLOAD&&!this.msgBuf&&(this.argBuf||this.cloneMsgArg(),this.msgBuf=new Ln(e.subarray(this.as)))}cloneMsgArg(){const e=this.ma.subject.length,t=this.ma.reply?this.ma.reply.length:0,n=new Uint8Array(e+t);n.set(this.ma.subject),this.ma.reply&&n.set(this.ma.reply,e),this.argBuf=new Ln(n),this.ma.subject=n.subarray(0,e),this.ma.reply&&(this.ma.reply=n.subarray(e))}processMsgArgs(e){if(this.hdr>=0)return this.processHeaderMsgArgs(e);const t=[];let n=-1;for(let s=0;s<e.length;s++)switch(e[s]){case A.SPACE:case A.TAB:case A.CR:case A.NL:n>=0&&(t.push(e.subarray(n,s)),n=-1);break;default:n<0&&(n=s)}switch(n>=0&&t.push(e.subarray(n)),t.length){case 3:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.size=this.protoParseInt(t[2]);break;case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.size=this.protoParseInt(t[3]);break;default:throw this.fail(e,"processMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processMsgArgs Bad or Missing Sid Error");if(this.ma.size<0)throw this.fail(e,"processMsgArgs Bad or Missing Size Error")}fail(e,t=""){return t?t=`${t} [${this.state}]`:t=`parse error [${this.state}]`,new Error(`${t}: ${ge.decode(e)}`)}processHeaderMsgArgs(e){const t=[];let n=-1;for(let s=0;s<e.length;s++)switch(e[s]){case A.SPACE:case A.TAB:case A.CR:case A.NL:n>=0&&(t.push(e.subarray(n,s)),n=-1);break;default:n<0&&(n=s)}switch(n>=0&&t.push(e.subarray(n)),t.length){case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.hdr=this.protoParseInt(t[2]),this.ma.size=this.protoParseInt(t[3]);break;case 5:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.hdr=this.protoParseInt(t[3]),this.ma.size=this.protoParseInt(t[4]);break;default:throw this.fail(e,"processHeaderMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Sid Error");if(this.ma.hdr<0||this.ma.hdr>this.ma.size)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Header Size Error");if(this.ma.size<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Size Error")}protoParseInt(e){if(e.length===0)return-1;let t=0;for(let n=0;n<e.length;n++){if(e[n]<48||e[n]>57)return-1;t=t*10+(e[n]-ld)}return t}}var O;(function(r){r[r.OP_START=0]="OP_START",r[r.OP_PLUS=1]="OP_PLUS",r[r.OP_PLUS_O=2]="OP_PLUS_O",r[r.OP_PLUS_OK=3]="OP_PLUS_OK",r[r.OP_MINUS=4]="OP_MINUS",r[r.OP_MINUS_E=5]="OP_MINUS_E",r[r.OP_MINUS_ER=6]="OP_MINUS_ER",r[r.OP_MINUS_ERR=7]="OP_MINUS_ERR",r[r.OP_MINUS_ERR_SPC=8]="OP_MINUS_ERR_SPC",r[r.MINUS_ERR_ARG=9]="MINUS_ERR_ARG",r[r.OP_M=10]="OP_M",r[r.OP_MS=11]="OP_MS",r[r.OP_MSG=12]="OP_MSG",r[r.OP_MSG_SPC=13]="OP_MSG_SPC",r[r.MSG_ARG=14]="MSG_ARG",r[r.MSG_PAYLOAD=15]="MSG_PAYLOAD",r[r.MSG_END=16]="MSG_END",r[r.OP_H=17]="OP_H",r[r.OP_P=18]="OP_P",r[r.OP_PI=19]="OP_PI",r[r.OP_PIN=20]="OP_PIN",r[r.OP_PING=21]="OP_PING",r[r.OP_PO=22]="OP_PO",r[r.OP_PON=23]="OP_PON",r[r.OP_PONG=24]="OP_PONG",r[r.OP_I=25]="OP_I",r[r.OP_IN=26]="OP_IN",r[r.OP_INF=27]="OP_INF",r[r.OP_INFO=28]="OP_INFO",r[r.OP_INFO_SPC=29]="OP_INFO_SPC",r[r.INFO_ARG=30]="INFO_ARG"})(O||(O={}));var A;(function(r){r[r.CR=13]="CR",r[r.E=69]="E",r[r.e=101]="e",r[r.F=70]="F",r[r.f=102]="f",r[r.G=71]="G",r[r.g=103]="g",r[r.H=72]="H",r[r.h=104]="h",r[r.I=73]="I",r[r.i=105]="i",r[r.K=75]="K",r[r.k=107]="k",r[r.M=77]="M",r[r.m=109]="m",r[r.MINUS=45]="MINUS",r[r.N=78]="N",r[r.n=110]="n",r[r.NL=10]="NL",r[r.O=79]="O",r[r.o=111]="o",r[r.P=80]="P",r[r.p=112]="p",r[r.PLUS=43]="PLUS",r[r.R=82]="R",r[r.r=114]="r",r[r.S=83]="S",r[r.s=115]="s",r[r.SPACE=32]="SPACE",r[r.TAB=9]="TAB"})(A||(A={}));(function(r){var e=function(l,f){this.hi=l|0,this.lo=f|0},t=function(l){var f,d=new Float64Array(16);if(l)for(f=0;f<l.length;f++)d[f]=l[f];return d},n=function(){throw new Error("no PRNG")},s=new Uint8Array(16),i=new Uint8Array(32);i[0]=9;var o=t(),a=t([1]),c=t([56129,1]),h=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),m=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),p=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),x=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),g=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(l,f){return l<<f|l>>>32-f}function I(l,f){var d=l[f+3]&255;return d=d<<8|l[f+2]&255,d=d<<8|l[f+1]&255,d<<8|l[f+0]&255}function M(l,f){var d=l[f]<<24|l[f+1]<<16|l[f+2]<<8|l[f+3],_=l[f+4]<<24|l[f+5]<<16|l[f+6]<<8|l[f+7];return new e(d,_)}function j(l,f,d){var _;for(_=0;_<4;_++)l[f+_]=d&255,d>>>=8}function C(l,f,d){l[f]=d.hi>>24&255,l[f+1]=d.hi>>16&255,l[f+2]=d.hi>>8&255,l[f+3]=d.hi&255,l[f+4]=d.lo>>24&255,l[f+5]=d.lo>>16&255,l[f+6]=d.lo>>8&255,l[f+7]=d.lo&255}function D(l,f,d,_,b){var y,k=0;for(y=0;y<b;y++)k|=l[f+y]^d[_+y];return(1&k-1>>>8)-1}function ee(l,f,d,_){return D(l,f,d,_,16)}function Z(l,f,d,_){return D(l,f,d,_,32)}function ne(l,f,d,_,b){var y=new Uint32Array(16),k=new Uint32Array(16),E=new Uint32Array(16),w=new Uint32Array(4),S,R,F;for(S=0;S<4;S++)k[5*S]=I(_,4*S),k[1+S]=I(d,4*S),k[6+S]=I(f,4*S),k[11+S]=I(d,16+4*S);for(S=0;S<16;S++)E[S]=k[S];for(S=0;S<20;S++){for(R=0;R<4;R++){for(F=0;F<4;F++)w[F]=k[(5*R+4*F)%16];for(w[1]^=v(w[0]+w[3]|0,7),w[2]^=v(w[1]+w[0]|0,9),w[3]^=v(w[2]+w[1]|0,13),w[0]^=v(w[3]+w[2]|0,18),F=0;F<4;F++)y[4*R+(R+F)%4]=w[F]}for(F=0;F<16;F++)k[F]=y[F]}if(b){for(S=0;S<16;S++)k[S]=k[S]+E[S]|0;for(S=0;S<4;S++)k[5*S]=k[5*S]-I(_,4*S)|0,k[6+S]=k[6+S]-I(f,4*S)|0;for(S=0;S<4;S++)j(l,4*S,k[5*S]),j(l,16+4*S,k[6+S])}else for(S=0;S<16;S++)j(l,4*S,k[S]+E[S]|0)}function pe(l,f,d,_){return ne(l,f,d,_,!1),0}function ae(l,f,d,_){return ne(l,f,d,_,!0),0}var re=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function N(l,f,d,_,b,y,k){var E=new Uint8Array(16),w=new Uint8Array(64),S,R;if(!b)return 0;for(R=0;R<16;R++)E[R]=0;for(R=0;R<8;R++)E[R]=y[R];for(;b>=64;){for(pe(w,E,k,re),R=0;R<64;R++)l[f+R]=(d?d[_+R]:0)^w[R];for(S=1,R=8;R<16;R++)S=S+(E[R]&255)|0,E[R]=S&255,S>>>=8;b-=64,f+=64,d&&(_+=64)}if(b>0)for(pe(w,E,k,re),R=0;R<b;R++)l[f+R]=(d?d[_+R]:0)^w[R];return 0}function B(l,f,d,_,b){return N(l,f,null,0,d,_,b)}function Q(l,f,d,_,b){var y=new Uint8Array(32);return ae(y,_,b,re),B(l,f,d,_.subarray(16),y)}function we(l,f,d,_,b,y,k){var E=new Uint8Array(32);return ae(E,y,k,re),N(l,f,d,_,b,y.subarray(16),E)}function se(l,f){var d,_=0;for(d=0;d<17;d++)_=_+(l[d]+f[d]|0)|0,l[d]=_&255,_>>>=8}var kr=new Uint32Array([5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,252]);function un(l,f,d,_,b,y){var k,E,w,S,R=new Uint32Array(17),F=new Uint32Array(17),Y=new Uint32Array(17),Ae=new Uint32Array(17),St=new Uint32Array(17);for(w=0;w<17;w++)F[w]=Y[w]=0;for(w=0;w<16;w++)F[w]=y[w];for(F[3]&=15,F[4]&=252,F[7]&=15,F[8]&=252,F[11]&=15,F[12]&=252,F[15]&=15;b>0;){for(w=0;w<17;w++)Ae[w]=0;for(w=0;w<16&&w<b;++w)Ae[w]=d[_+w];for(Ae[w]=1,_+=w,b-=w,se(Y,Ae),E=0;E<17;E++)for(R[E]=0,w=0;w<17;w++)R[E]=R[E]+Y[w]*(w<=E?F[E-w]:320*F[E+17-w]|0)|0|0;for(E=0;E<17;E++)Y[E]=R[E];for(S=0,w=0;w<16;w++)S=S+Y[w]|0,Y[w]=S&255,S>>>=8;for(S=S+Y[16]|0,Y[16]=S&3,S=5*(S>>>2)|0,w=0;w<16;w++)S=S+Y[w]|0,Y[w]=S&255,S>>>=8;S=S+Y[16]|0,Y[16]=S}for(w=0;w<17;w++)St[w]=Y[w];for(se(Y,kr),k=-(Y[16]>>>7)|0,w=0;w<17;w++)Y[w]^=k&(St[w]^Y[w]);for(w=0;w<16;w++)Ae[w]=y[w+16];for(Ae[16]=0,se(Y,Ae),w=0;w<16;w++)l[f+w]=Y[w];return 0}function Js(l,f,d,_,b,y){var k=new Uint8Array(16);return un(k,0,d,_,b,y),ee(l,f,k,0)}function hn(l,f,d,_,b){var y;if(d<32)return-1;for(we(l,0,f,0,d,_,b),un(l,16,l,32,d-32,l),y=0;y<16;y++)l[y]=0;return 0}function dn(l,f,d,_,b){var y,k=new Uint8Array(32);if(d<32||(Q(k,0,32,_,b),Js(f,16,f,32,d-32,k)!==0))return-1;for(we(l,0,f,0,d,_,b),y=0;y<32;y++)l[y]=0;return 0}function Fe(l,f){var d;for(d=0;d<16;d++)l[d]=f[d]|0}function zt(l){var f,d;for(d=0;d<16;d++)l[d]+=65536,f=Math.floor(l[d]/65536),l[(d+1)*(d<15?1:0)]+=f-1+37*(f-1)*(d===15?1:0),l[d]-=f*65536}function yt(l,f,d){for(var _,b=~(d-1),y=0;y<16;y++)_=b&(l[y]^f[y]),l[y]^=_,f[y]^=_}function xt(l,f){var d,_,b,y=t(),k=t();for(d=0;d<16;d++)k[d]=f[d];for(zt(k),zt(k),zt(k),_=0;_<2;_++){for(y[0]=k[0]-65517,d=1;d<15;d++)y[d]=k[d]-65535-(y[d-1]>>16&1),y[d-1]&=65535;y[15]=k[15]-32767-(y[14]>>16&1),b=y[15]>>16&1,y[14]&=65535,yt(k,y,1-b)}for(d=0;d<16;d++)l[2*d]=k[d]&255,l[2*d+1]=k[d]>>8}function Gs(l,f){var d=new Uint8Array(32),_=new Uint8Array(32);return xt(d,l),xt(_,f),Z(d,0,_,0)}function Ys(l){var f=new Uint8Array(32);return xt(f,l),f[0]&1}function fn(l,f){var d;for(d=0;d<16;d++)l[d]=f[2*d]+(f[2*d+1]<<8);l[15]&=32767}function Ce(l,f,d){var _;for(_=0;_<16;_++)l[_]=f[_]+d[_]|0}function Oe(l,f,d){var _;for(_=0;_<16;_++)l[_]=f[_]-d[_]|0}function U(l,f,d){var _,b,y=new Float64Array(31);for(_=0;_<31;_++)y[_]=0;for(_=0;_<16;_++)for(b=0;b<16;b++)y[_+b]+=f[_]*d[b];for(_=0;_<15;_++)y[_]+=38*y[_+16];for(_=0;_<16;_++)l[_]=y[_];zt(l),zt(l)}function ve(l,f){U(l,f,f)}function Ks(l,f){var d=t(),_;for(_=0;_<16;_++)d[_]=f[_];for(_=253;_>=0;_--)ve(d,d),_!==2&&_!==4&&U(d,d,f);for(_=0;_<16;_++)l[_]=d[_]}function Xs(l,f){var d=t(),_;for(_=0;_<16;_++)d[_]=f[_];for(_=250;_>=0;_--)ve(d,d),_!==1&&U(d,d,f);for(_=0;_<16;_++)l[_]=d[_]}function Er(l,f,d){var _=new Uint8Array(32),b=new Float64Array(80),y,k,E=t(),w=t(),S=t(),R=t(),F=t(),Y=t();for(k=0;k<31;k++)_[k]=f[k];for(_[31]=f[31]&127|64,_[0]&=248,fn(b,d),k=0;k<16;k++)w[k]=b[k],R[k]=E[k]=S[k]=0;for(E[0]=R[0]=1,k=254;k>=0;--k)y=_[k>>>3]>>>(k&7)&1,yt(E,w,y),yt(S,R,y),Ce(F,E,S),Oe(E,E,S),Ce(S,w,R),Oe(w,w,R),ve(R,F),ve(Y,E),U(E,S,E),U(S,w,F),Ce(F,E,S),Oe(E,E,S),ve(w,E),Oe(S,R,Y),U(E,S,c),Ce(E,E,R),U(S,S,E),U(E,R,Y),U(R,w,b),ve(w,F),yt(E,w,y),yt(S,R,y);for(k=0;k<16;k++)b[k+16]=E[k],b[k+32]=S[k],b[k+48]=w[k],b[k+64]=R[k];var Ae=b.subarray(32),St=b.subarray(16);return Ks(Ae,Ae),U(St,St,Ae),xt(l,St),0}function Pr(l,f){return Er(l,f,i)}function Zs(l,f){return n(f,32),Pr(l,f)}function Cr(l,f,d){var _=new Uint8Array(32);return Er(_,d,f),ae(l,s,_,re)}var Qs=hn,Ja=dn;function Ga(l,f,d,_,b,y){var k=new Uint8Array(32);return Cr(k,b,y),Qs(l,f,d,_,k)}function Ya(l,f,d,_,b,y){var k=new Uint8Array(32);return Cr(k,b,y),Ja(l,f,d,_,k)}function Jt(){var l=0,f=0,d=0,_=0,b=65535,y,k,E;for(E=0;E<arguments.length;E++)y=arguments[E].lo,k=arguments[E].hi,l+=y&b,f+=y>>>16,d+=k&b,_+=k>>>16;return f+=l>>>16,d+=f>>>16,_+=d>>>16,new e(d&b|_<<16,l&b|f<<16)}function ei(l,f){return new e(l.hi>>>f,l.lo>>>f|l.hi<<32-f)}function Or(){var l=0,f=0,d;for(d=0;d<arguments.length;d++)l^=arguments[d].lo,f^=arguments[d].hi;return new e(f,l)}function Be(l,f){var d,_,b=32-f;return f<32?(d=l.hi>>>f|l.lo<<b,_=l.lo>>>f|l.hi<<b):f<64&&(d=l.lo>>>f|l.hi<<b,_=l.hi>>>f|l.lo<<b),new e(d,_)}function Ka(l,f,d){var _=l.hi&f.hi^~l.hi&d.hi,b=l.lo&f.lo^~l.lo&d.lo;return new e(_,b)}function Xa(l,f,d){var _=l.hi&f.hi^l.hi&d.hi^f.hi&d.hi,b=l.lo&f.lo^l.lo&d.lo^f.lo&d.lo;return new e(_,b)}function Za(l){return Or(Be(l,28),Be(l,34),Be(l,39))}function Qa(l){return Or(Be(l,14),Be(l,18),Be(l,41))}function ec(l){return Or(Be(l,1),Be(l,8),ei(l,7))}function tc(l){return Or(Be(l,19),Be(l,61),ei(l,6))}var rc=[new e(1116352408,3609767458),new e(1899447441,602891725),new e(3049323471,3964484399),new e(3921009573,2173295548),new e(961987163,4081628472),new e(1508970993,3053834265),new e(2453635748,2937671579),new e(2870763221,3664609560),new e(3624381080,2734883394),new e(310598401,1164996542),new e(607225278,1323610764),new e(1426881987,3590304994),new e(1925078388,4068182383),new e(2162078206,991336113),new e(2614888103,633803317),new e(3248222580,3479774868),new e(3835390401,2666613458),new e(4022224774,944711139),new e(264347078,2341262773),new e(604807628,2007800933),new e(770255983,1495990901),new e(1249150122,1856431235),new e(1555081692,3175218132),new e(1996064986,2198950837),new e(2554220882,3999719339),new e(2821834349,766784016),new e(2952996808,2566594879),new e(3210313671,3203337956),new e(3336571891,1034457026),new e(3584528711,2466948901),new e(113926993,3758326383),new e(338241895,168717936),new e(666307205,1188179964),new e(773529912,1546045734),new e(1294757372,1522805485),new e(1396182291,2643833823),new e(1695183700,2343527390),new e(1986661051,1014477480),new e(2177026350,1206759142),new e(2456956037,344077627),new e(2730485921,1290863460),new e(2820302411,3158454273),new e(3259730800,3505952657),new e(3345764771,106217008),new e(3516065817,3606008344),new e(3600352804,1432725776),new e(4094571909,1467031594),new e(275423344,851169720),new e(430227734,3100823752),new e(506948616,1363258195),new e(659060556,3750685593),new e(883997877,3785050280),new e(958139571,3318307427),new e(1322822218,3812723403),new e(1537002063,2003034995),new e(1747873779,3602036899),new e(1955562222,1575990012),new e(2024104815,1125592928),new e(2227730452,2716904306),new e(2361852424,442776044),new e(2428436474,593698344),new e(2756734187,3733110249),new e(3204031479,2999351573),new e(3329325298,3815920427),new e(3391569614,3928383900),new e(3515267271,566280711),new e(3940187606,3454069534),new e(4118630271,4000239992),new e(116418474,1914138554),new e(174292421,2731055270),new e(289380356,3203993006),new e(460393269,320620315),new e(685471733,587496836),new e(852142971,1086792851),new e(1017036298,365543100),new e(1126000580,2618297676),new e(1288033470,3409855158),new e(1501505948,4234509866),new e(1607167915,987167468),new e(1816402316,1246189591)];function ti(l,f,d){var _=[],b=[],y=[],k=[],E,w,S;for(w=0;w<8;w++)_[w]=y[w]=M(l,8*w);for(var R=0;d>=128;){for(w=0;w<16;w++)k[w]=M(f,8*w+R);for(w=0;w<80;w++){for(S=0;S<8;S++)b[S]=y[S];for(E=Jt(y[7],Qa(y[4]),Ka(y[4],y[5],y[6]),rc[w],k[w%16]),b[7]=Jt(E,Za(y[0]),Xa(y[0],y[1],y[2])),b[3]=Jt(b[3],E),S=0;S<8;S++)y[(S+1)%8]=b[S];if(w%16===15)for(S=0;S<16;S++)k[S]=Jt(k[S],k[(S+9)%16],ec(k[(S+1)%16]),tc(k[(S+14)%16]))}for(w=0;w<8;w++)y[w]=Jt(y[w],_[w]),_[w]=y[w];R+=128,d-=128}for(w=0;w<8;w++)C(l,8*w,_[w]);return d}var nc=new Uint8Array([106,9,230,103,243,188,201,8,187,103,174,133,132,202,167,59,60,110,243,114,254,148,248,43,165,79,245,58,95,29,54,241,81,14,82,127,173,230,130,209,155,5,104,140,43,62,108,31,31,131,217,171,251,65,189,107,91,224,205,25,19,126,33,121]);function ct(l,f,d){var _=new Uint8Array(64),b=new Uint8Array(256),y,k=d;for(y=0;y<64;y++)_[y]=nc[y];for(ti(_,f,d),d%=128,y=0;y<256;y++)b[y]=0;for(y=0;y<d;y++)b[y]=f[k-d+y];for(b[d]=128,d=256-128*(d<112?1:0),b[d-9]=0,C(b,d-8,new e(k/536870912|0,k<<3)),ti(_,b,d),y=0;y<64;y++)l[y]=_[y];return 0}function Ar(l,f){var d=t(),_=t(),b=t(),y=t(),k=t(),E=t(),w=t(),S=t(),R=t();Oe(d,l[1],l[0]),Oe(R,f[1],f[0]),U(d,d,R),Ce(_,l[0],l[1]),Ce(R,f[0],f[1]),U(_,_,R),U(b,l[3],f[3]),U(b,b,m),U(y,l[2],f[2]),Ce(y,y,y),Oe(k,_,d),Oe(E,y,b),Ce(w,y,b),Ce(S,_,d),U(l[0],k,E),U(l[1],S,w),U(l[2],w,E),U(l[3],k,S)}function ri(l,f,d){var _;for(_=0;_<4;_++)yt(l[_],f[_],d)}function pn(l,f){var d=t(),_=t(),b=t();Ks(b,f[2]),U(d,f[0],b),U(_,f[1],b),xt(l,_),l[31]^=Ys(d)<<7}function _n(l,f,d){var _,b;for(Fe(l[0],o),Fe(l[1],a),Fe(l[2],a),Fe(l[3],o),b=255;b>=0;--b)_=d[b/8|0]>>(b&7)&1,ri(l,f,_),Ar(f,l),Ar(l,l),ri(l,f,_)}function Ir(l,f){var d=[t(),t(),t(),t()];Fe(d[0],p),Fe(d[1],x),Fe(d[2],a),U(d[3],p,x),_n(l,d,f)}function mn(l,f,d){var _=new Uint8Array(64),b=[t(),t(),t(),t()],y;for(d||n(f,32),ct(_,f,32),_[0]&=248,_[31]&=127,_[31]|=64,Ir(b,_),pn(l,b),y=0;y<32;y++)f[y+32]=l[y];return 0}var Tr=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function bn(l,f){var d,_,b,y;for(_=63;_>=32;--_){for(d=0,b=_-32,y=_-12;b<y;++b)f[b]+=d-16*f[_]*Tr[b-(_-32)],d=Math.floor((f[b]+128)/256),f[b]-=d*256;f[b]+=d,f[_]=0}for(d=0,b=0;b<32;b++)f[b]+=d-(f[31]>>4)*Tr[b],d=f[b]>>8,f[b]&=255;for(b=0;b<32;b++)f[b]-=d*Tr[b];for(_=0;_<32;_++)f[_+1]+=f[_]>>8,l[_]=f[_]&255}function gn(l){var f=new Float64Array(64),d;for(d=0;d<64;d++)f[d]=l[d];for(d=0;d<64;d++)l[d]=0;bn(l,f)}function ni(l,f,d,_){var b=new Uint8Array(64),y=new Uint8Array(64),k=new Uint8Array(64),E,w,S=new Float64Array(64),R=[t(),t(),t(),t()];ct(b,_,32),b[0]&=248,b[31]&=127,b[31]|=64;var F=d+64;for(E=0;E<d;E++)l[64+E]=f[E];for(E=0;E<32;E++)l[32+E]=b[32+E];for(ct(k,l.subarray(32),d+32),gn(k),Ir(R,k),pn(l,R),E=32;E<64;E++)l[E]=_[E];for(ct(y,l,d+64),gn(y),E=0;E<64;E++)S[E]=0;for(E=0;E<32;E++)S[E]=k[E];for(E=0;E<32;E++)for(w=0;w<32;w++)S[E+w]+=y[E]*b[w];return bn(l.subarray(32),S),F}function sc(l,f){var d=t(),_=t(),b=t(),y=t(),k=t(),E=t(),w=t();return Fe(l[2],a),fn(l[1],f),ve(b,l[1]),U(y,b,h),Oe(b,b,l[2]),Ce(y,l[2],y),ve(k,y),ve(E,k),U(w,E,k),U(d,w,b),U(d,d,y),Xs(d,d),U(d,d,b),U(d,d,y),U(d,d,y),U(l[0],d,y),ve(_,l[0]),U(_,_,y),Gs(_,b)&&U(l[0],l[0],g),ve(_,l[0]),U(_,_,y),Gs(_,b)?-1:(Ys(l[0])===f[31]>>7&&Oe(l[0],o,l[0]),U(l[3],l[0],l[1]),0)}function yn(l,f,d,_){var b,y=new Uint8Array(32),k=new Uint8Array(64),E=[t(),t(),t(),t()],w=[t(),t(),t(),t()];if(d<64||sc(w,_))return-1;for(b=0;b<d;b++)l[b]=f[b];for(b=0;b<32;b++)l[b+32]=_[b];if(ct(k,l,d),gn(k),_n(E,w,k),Ir(w,f.subarray(32)),Ar(E,w),pn(y,E),d-=64,Z(f,0,y,0)){for(b=0;b<d;b++)l[b]=0;return-1}for(b=0;b<d;b++)l[b]=f[b+64];return d}var xn=32,Rr=24,Gt=32,wt=16,Yt=32,jr=32,Kt=32,Xt=32,wn=32,si=Rr,ic=Gt,oc=wt,De=64,lt=32,vt=64,vn=32,Sn=64;r.lowlevel={crypto_core_hsalsa20:ae,crypto_stream_xor:we,crypto_stream:Q,crypto_stream_salsa20_xor:N,crypto_stream_salsa20:B,crypto_onetimeauth:un,crypto_onetimeauth_verify:Js,crypto_verify_16:ee,crypto_verify_32:Z,crypto_secretbox:hn,crypto_secretbox_open:dn,crypto_scalarmult:Er,crypto_scalarmult_base:Pr,crypto_box_beforenm:Cr,crypto_box_afternm:Qs,crypto_box:Ga,crypto_box_open:Ya,crypto_box_keypair:Zs,crypto_hash:ct,crypto_sign:ni,crypto_sign_keypair:mn,crypto_sign_open:yn,crypto_secretbox_KEYBYTES:xn,crypto_secretbox_NONCEBYTES:Rr,crypto_secretbox_ZEROBYTES:Gt,crypto_secretbox_BOXZEROBYTES:wt,crypto_scalarmult_BYTES:Yt,crypto_scalarmult_SCALARBYTES:jr,crypto_box_PUBLICKEYBYTES:Kt,crypto_box_SECRETKEYBYTES:Xt,crypto_box_BEFORENMBYTES:wn,crypto_box_NONCEBYTES:si,crypto_box_ZEROBYTES:ic,crypto_box_BOXZEROBYTES:oc,crypto_sign_BYTES:De,crypto_sign_PUBLICKEYBYTES:lt,crypto_sign_SECRETKEYBYTES:vt,crypto_sign_SEEDBYTES:vn,crypto_hash_BYTES:Sn,gf:t,D:h,L:Tr,pack25519:xt,unpack25519:fn,M:U,A:Ce,S:ve,Z:Oe,pow2523:Xs,add:Ar,set25519:Fe,modL:bn,scalarmult:_n,scalarbase:Ir};function ii(l,f){if(l.length!==xn)throw new Error("bad key size");if(f.length!==Rr)throw new Error("bad nonce size")}function ac(l,f){if(l.length!==Kt)throw new Error("bad public key size");if(f.length!==Xt)throw new Error("bad secret key size")}function _e(){for(var l=0;l<arguments.length;l++)if(!(arguments[l]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function oi(l){for(var f=0;f<l.length;f++)l[f]=0}r.randomBytes=function(l){var f=new Uint8Array(l);return n(f,l),f},r.secretbox=function(l,f,d){_e(l,f,d),ii(d,f);for(var _=new Uint8Array(Gt+l.length),b=new Uint8Array(_.length),y=0;y<l.length;y++)_[y+Gt]=l[y];return hn(b,_,_.length,f,d),b.subarray(wt)},r.secretbox.open=function(l,f,d){_e(l,f,d),ii(d,f);for(var _=new Uint8Array(wt+l.length),b=new Uint8Array(_.length),y=0;y<l.length;y++)_[y+wt]=l[y];return _.length<32||dn(b,_,_.length,f,d)!==0?null:b.subarray(Gt)},r.secretbox.keyLength=xn,r.secretbox.nonceLength=Rr,r.secretbox.overheadLength=wt,r.scalarMult=function(l,f){if(_e(l,f),l.length!==jr)throw new Error("bad n size");if(f.length!==Yt)throw new Error("bad p size");var d=new Uint8Array(Yt);return Er(d,l,f),d},r.scalarMult.base=function(l){if(_e(l),l.length!==jr)throw new Error("bad n size");var f=new Uint8Array(Yt);return Pr(f,l),f},r.scalarMult.scalarLength=jr,r.scalarMult.groupElementLength=Yt,r.box=function(l,f,d,_){var b=r.box.before(d,_);return r.secretbox(l,f,b)},r.box.before=function(l,f){_e(l,f),ac(l,f);var d=new Uint8Array(wn);return Cr(d,l,f),d},r.box.after=r.secretbox,r.box.open=function(l,f,d,_){var b=r.box.before(d,_);return r.secretbox.open(l,f,b)},r.box.open.after=r.secretbox.open,r.box.keyPair=function(){var l=new Uint8Array(Kt),f=new Uint8Array(Xt);return Zs(l,f),{publicKey:l,secretKey:f}},r.box.keyPair.fromSecretKey=function(l){if(_e(l),l.length!==Xt)throw new Error("bad secret key size");var f=new Uint8Array(Kt);return Pr(f,l),{publicKey:f,secretKey:new Uint8Array(l)}},r.box.publicKeyLength=Kt,r.box.secretKeyLength=Xt,r.box.sharedKeyLength=wn,r.box.nonceLength=si,r.box.overheadLength=r.secretbox.overheadLength,r.sign=function(l,f){if(_e(l,f),f.length!==vt)throw new Error("bad secret key size");var d=new Uint8Array(De+l.length);return ni(d,l,l.length,f),d},r.sign.open=function(l,f){if(_e(l,f),f.length!==lt)throw new Error("bad public key size");var d=new Uint8Array(l.length),_=yn(d,l,l.length,f);if(_<0)return null;for(var b=new Uint8Array(_),y=0;y<b.length;y++)b[y]=d[y];return b},r.sign.detached=function(l,f){for(var d=r.sign(l,f),_=new Uint8Array(De),b=0;b<_.length;b++)_[b]=d[b];return _},r.sign.detached.verify=function(l,f,d){if(_e(l,f,d),f.length!==De)throw new Error("bad signature size");if(d.length!==lt)throw new Error("bad public key size");var _=new Uint8Array(De+l.length),b=new Uint8Array(De+l.length),y;for(y=0;y<De;y++)_[y]=f[y];for(y=0;y<l.length;y++)_[y+De]=l[y];return yn(b,_,_.length,d)>=0},r.sign.keyPair=function(){var l=new Uint8Array(lt),f=new Uint8Array(vt);return mn(l,f),{publicKey:l,secretKey:f}},r.sign.keyPair.fromSecretKey=function(l){if(_e(l),l.length!==vt)throw new Error("bad secret key size");for(var f=new Uint8Array(lt),d=0;d<f.length;d++)f[d]=l[32+d];return{publicKey:f,secretKey:new Uint8Array(l)}},r.sign.keyPair.fromSeed=function(l){if(_e(l),l.length!==vn)throw new Error("bad seed size");for(var f=new Uint8Array(lt),d=new Uint8Array(vt),_=0;_<32;_++)d[_]=l[_];return mn(f,d,!0),{publicKey:f,secretKey:d}},r.sign.publicKeyLength=lt,r.sign.secretKeyLength=vt,r.sign.seedLength=vn,r.sign.signatureLength=De,r.hash=function(l){_e(l);var f=new Uint8Array(Sn);return ct(f,l,l.length),f},r.hash.hashLength=Sn,r.verify=function(l,f){return _e(l,f),l.length===0||f.length===0||l.length!==f.length?!1:D(l,0,f,0,l.length)===0},r.setPRNG=function(l){n=l},function(){var l=typeof globalThis<"u"?globalThis.crypto||globalThis.msCrypto:null;if(l&&l.getRandomValues){var f=65536;r.setPRNG(function(d,_){var b,y=new Uint8Array(_);for(b=0;b<_;b+=f)l.getRandomValues(y.subarray(b,b+Math.min(_-b,f)));for(b=0;b<_;b++)d[b]=y[b];oi(y)})}else typeof require<"u"&&(l=require("crypto"),l&&l.randomBytes&&r.setPRNG(function(d,_){var b,y=l.randomBytes(_);for(b=0;b<_;b++)d[b]=y[b];oi(y)}))}()})(typeof ft<"u"&&ft.exports?ft.exports:globalThis.nacl=globalThis.nacl||{});const Lr=typeof ft<"u"&&ft.exports?ft.exports:globalThis.nacl,ud={fromSeed:Lr.sign.keyPair.fromSeed,sign:Lr.sign.detached,verify:Lr.sign.detached.verify,randomBytes:Lr.randomBytes};let Na;function hd(r){Na=r}function Ze(){return Na}const dd=new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920]);class Zr{static checksum(e){let t=0;for(let n=0;n<e.byteLength;n++){let s=e[n];t=t<<8&65535^dd[(t>>8^s)&255]}return t}static validate(e,t){return Zr.checksum(e)==t}}const Un="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";class Qi{static encode(e){let t=0,n=0,s=new Uint8Array(e),i=new Uint8Array(e.byteLength*2),o=0;for(let a=0;a<s.byteLength;a++)for(n=n<<8|s[a],t+=8;t>=5;){let c=n>>>t-5&31;i[o++]=Un.charAt(c).charCodeAt(0),t-=5}if(t>0){let a=n<<5-t&31;i[o++]=Un.charAt(a).charCodeAt(0)}return i.slice(0,o)}static decode(e){let t=0,n=0,s=0,i=new Uint8Array(e),o=new Uint8Array(i.byteLength*5/8|0);for(let a=0;a<i.byteLength;a++){let c=String.fromCharCode(i[a]),h=Un.indexOf(c);if(h===-1)throw new Error("Illegal Base32 character: "+i[a]);n=n<<5|h,t+=5,t>=8&&(o[s++]=n>>>t-8&255,t-=8)}return o.slice(0,s)}}class V extends Error{constructor(t,n){super(t);u(this,"name");u(this,"code");u(this,"chainedError");this.name="NKeysError",this.code=t,this.chainedError=n}}function fd(){return cn(H.Operator)}function pd(){return cn(H.Account)}function _d(){return cn(H.User)}var W;(function(r){r.InvalidPrefixByte="nkeys: invalid prefix byte",r.InvalidKey="nkeys: invalid key",r.InvalidPublicKey="nkeys: invalid public key",r.InvalidSeedLen="nkeys: invalid seed length",r.InvalidSeed="nkeys: invalid seed",r.InvalidEncoding="nkeys: invalid encoded key",r.InvalidSignature="nkeys: signature verification failed",r.CannotSign="nkeys: cannot sign, no private key available",r.PublicKeyOnly="nkeys: no seed or private key available",r.InvalidChecksum="nkeys: invalid checksum",r.SerializationError="nkeys: serialization error",r.ApiError="nkeys: api error",r.ClearedPair="nkeys: pair is cleared"})(W||(W={}));var H;(function(r){r[r.Seed=144]="Seed",r[r.Private=120]="Private",r[r.Operator=112]="Operator",r[r.Server=104]="Server",r[r.Cluster=16]="Cluster",r[r.Account=0]="Account",r[r.User=160]="User"})(H||(H={}));class Ot{static isValidPublicPrefix(e){return e==H.Server||e==H.Operator||e==H.Cluster||e==H.Account||e==H.User}static startsWithValidPrefix(e){let t=e[0];return t=="S"||t=="P"||t=="O"||t=="N"||t=="C"||t=="A"||t=="U"}static isValidPrefix(e){return this.parsePrefix(e)!=-1}static parsePrefix(e){switch(e){case H.Seed:return H.Seed;case H.Private:return H.Private;case H.Operator:return H.Operator;case H.Server:return H.Server;case H.Cluster:return H.Cluster;case H.Account:return H.Account;case H.User:return H.User;default:return-1}}}class de{static encode(e,t){if(!t||!(t instanceof Uint8Array))throw new V(W.SerializationError);if(!Ot.isValidPrefix(e))throw new V(W.InvalidPrefixByte);return de._encode(!1,e,t)}static encodeSeed(e,t){if(!t)throw new V(W.ApiError);if(!Ot.isValidPublicPrefix(e))throw new V(W.InvalidPrefixByte);if(t.byteLength!==32)throw new V(W.InvalidSeedLen);return de._encode(!0,e,t)}static decode(e,t){if(!Ot.isValidPrefix(e))throw new V(W.InvalidPrefixByte);const n=de._decode(t);if(n[0]!==e)throw new V(W.InvalidPrefixByte);return n.slice(1)}static decodeSeed(e){const t=de._decode(e),n=de._decodePrefix(t);if(n[0]!=H.Seed)throw new V(W.InvalidSeed);if(!Ot.isValidPublicPrefix(n[1]))throw new V(W.InvalidPrefixByte);return{buf:t.slice(2),prefix:n[1]}}static _encode(e,t,n){const s=e?2:1,i=n.byteLength,o=s+i+2,a=s+i,c=new Uint8Array(o);if(e){const p=de._encodePrefix(H.Seed,t);c.set(p)}else c[0]=t;c.set(n,s);const h=Zr.checksum(c.slice(0,a));return new DataView(c.buffer).setUint16(a,h,!0),Qi.encode(c)}static _decode(e){if(e.byteLength<4)throw new V(W.InvalidEncoding);let t;try{t=Qi.decode(e)}catch(a){throw new V(W.InvalidEncoding,a)}const n=t.byteLength-2,i=new DataView(t.buffer).getUint16(n,!0),o=t.slice(0,n);if(!Zr.validate(o,i))throw new V(W.InvalidChecksum);return o}static _encodePrefix(e,t){const n=e|t>>5,s=(t&31)<<3;return new Uint8Array([n,s])}static _decodePrefix(e){const t=e[0]&248,n=(e[0]&7)<<5|(e[1]&248)>>3;return new Uint8Array([t,n])}}class $a{constructor(e){u(this,"seed");this.seed=e}getRawSeed(){if(!this.seed)throw new V(W.ClearedPair);return de.decodeSeed(this.seed).buf}getSeed(){if(!this.seed)throw new V(W.ClearedPair);return this.seed}getPublicKey(){if(!this.seed)throw new V(W.ClearedPair);const e=de.decodeSeed(this.seed),t=Ze().fromSeed(this.getRawSeed()),n=de.encode(e.prefix,t.publicKey);return new TextDecoder().decode(n)}getPrivateKey(){if(!this.seed)throw new V(W.ClearedPair);const e=Ze().fromSeed(this.getRawSeed());return de.encode(H.Private,e.secretKey)}sign(e){if(!this.seed)throw new V(W.ClearedPair);const t=Ze().fromSeed(this.getRawSeed());return Ze().sign(e,t.secretKey)}verify(e,t){if(!this.seed)throw new V(W.ClearedPair);const n=Ze().fromSeed(this.getRawSeed());return Ze().verify(e,t,n.publicKey)}clear(){this.seed&&(this.seed.fill(0),this.seed=void 0)}}function cn(r){const e=Ze().randomBytes(32);let t=de.encodeSeed(r,new Uint8Array(e));return new $a(t)}class md{constructor(e){u(this,"publicKey");this.publicKey=e}getPublicKey(){if(!this.publicKey)throw new V(W.ClearedPair);return new TextDecoder().decode(this.publicKey)}getPrivateKey(){throw this.publicKey?new V(W.PublicKeyOnly):new V(W.ClearedPair)}getSeed(){throw this.publicKey?new V(W.PublicKeyOnly):new V(W.ClearedPair)}sign(e){throw this.publicKey?new V(W.CannotSign):new V(W.ClearedPair)}verify(e,t){if(!this.publicKey)throw new V(W.ClearedPair);let n=de._decode(this.publicKey);return Ze().verify(e,t,n.slice(1))}clear(){this.publicKey&&(this.publicKey.fill(0),this.publicKey=void 0)}}function bd(r){const e=new TextEncoder().encode(r),t=de._decode(e),n=Ot.parsePrefix(t[0]);if(Ot.isValidPublicPrefix(n))return new md(e);throw new V(W.InvalidPublicKey)}function gd(r){return de.decodeSeed(r),new $a(r)}function yd(r){return btoa(String.fromCharCode(...r))}function xd(r){const e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}hd(ud);const wd={createAccount:pd,createOperator:fd,createPair:cn,createUser:_d,fromPublic:bd,fromSeed:gd,NKeysError:V,NKeysErrorCode:W,Prefix:H,decode:xd,encode:yd};function vd(r){return e=>{let t={};return r.forEach(n=>{const s=n(e)||{};t=Object.assign(t,s)}),t}}function Sd(){return()=>{}}function kd(r,e){return()=>{const t=typeof r=="function"?r():r,n=typeof e=="function"?e():e;return{user:t,pass:n}}}function Ed(r){return()=>({auth_token:typeof r=="function"?r():r})}function Pd(r){return e=>{const t="";at.encode(e||"");const n=void 0,s=n?wd.encode(n):"";return{nkey:t,sig:s}}}function Cd(r,e){return t=>{const n=typeof r=="function"?r():r,s=Pd(),{nkey:i,sig:o}=s(t);return{jwt:n,nkey:i,sig:o}}}const Ba=2*60*1e3,Od=2,La=2*1e3;function Ad(){return{maxPingOut:2,maxReconnectAttempts:10,noRandomize:!1,pedantic:!1,pingInterval:Ba,reconnect:!0,reconnectJitter:100,reconnectJitterTLS:1e3,reconnectTimeWait:La,tls:void 0,verbose:!1,waitOnFirstConnect:!1,ignoreAuthErrorAbort:!1}}function Id(r){const e=[];return typeof r.authenticator=="function"&&e.push(r.authenticator),Array.isArray(r.authenticator)&&e.push(...r.authenticator),r.token&&e.push(Ed(r.token)),r.user&&e.push(kd(r.user,r.pass)),e.length===0?Sd():vd(e)}function Td(r){const e=`${Qn}:${Ra()}`;if(r=r||{servers:[e]},r.servers=r.servers||[],typeof r.servers=="string"&&(r.servers=[r.servers]),r.servers.length>0&&r.port)throw new T("port and servers options are mutually exclusive",P.InvalidOption);r.servers.length===0&&r.port&&(r.servers=[`${Qn}:${r.port}`]),r.servers&&r.servers.length===0&&(r.servers=[e]);const t=on(Ad(),r);if(t.authenticator=Id(t),["reconnectDelayHandler","authenticator"].forEach(n=>{if(t[n]&&typeof t[n]!="function")throw new T(`${n} option should be a function`,P.NotFunction)}),t.reconnectDelayHandler||(t.reconnectDelayHandler=()=>{let n=t.tls?t.reconnectJitterTLS:t.reconnectJitter;return n&&(n++,n=Math.floor(Math.random()*n)),t.reconnectTimeWait+n}),t.inboxPrefix)try{Je(t.inboxPrefix)}catch(n){throw new T(n.message,P.ApiError)}if(t.resolve===void 0&&(t.resolve=typeof is()=="function"),t.resolve&&typeof is()!="function")throw new T("'resolve' is not supported on this client",P.InvalidOption);return t}function Rd(r,e){const{proto:t,tls_required:n,tls_available:s}=r;if((t===void 0||t<1)&&e.noEcho)throw new T("noEcho",P.ServerOptionNotAvailable);const i=n||s||!1;if(e.tls&&!i)throw new T("tls",P.ServerOptionNotAvailable)}const jd=1024*32,Md=/^INFO\s+([^\r\n]+)\r\n/i,Nd=ir(`PONG\r
`),eo=ir(`PING\r
`);class $d{constructor(e,t,n){u(this,"echo");u(this,"no_responders");u(this,"protocol");u(this,"verbose");u(this,"pedantic");u(this,"jwt");u(this,"nkey");u(this,"sig");u(this,"user");u(this,"pass");u(this,"auth_token");u(this,"tls_required");u(this,"name");u(this,"lang");u(this,"version");u(this,"headers");this.protocol=1,this.version=e.version,this.lang=e.lang,this.echo=t.noEcho?!1:void 0,this.verbose=t.verbose,this.pedantic=t.pedantic,this.tls_required=t.tls?!0:void 0,this.name=t.name;const s=(t&&typeof t.authenticator=="function"?t.authenticator(n):{})||{};on(this,s)}}class Ua extends oe{constructor(t,n,s={}){var o;super();u(this,"sid");u(this,"queue");u(this,"draining");u(this,"max");u(this,"subject");u(this,"drained");u(this,"protocol");u(this,"timer");u(this,"info");u(this,"cleanupFn");u(this,"closed");u(this,"requestSubject");on(this,s),this.protocol=t,this.subject=n,this.draining=!1,this.noIterator=typeof s.callback=="function",this.closed=G();const i=!((o=t.options)!=null&&o.noAsyncTraces);s.timeout&&(this.timer=Ut(s.timeout,i),this.timer.then(()=>{this.timer=void 0}).catch(a=>{this.stop(a),this.noIterator&&this.callback(a,{})})),this.noIterator||this.iterClosed.then(()=>{this.closed.resolve(),this.unsubscribe()})}setPrePostHandlers(t){if(this.noIterator){const n=this.callback,s=t.ingestionFilterFn?t.ingestionFilterFn:()=>({ingest:!0,protocol:!1}),i=t.protocolFilterFn?t.protocolFilterFn:()=>!0,o=t.dispatchedFn?t.dispatchedFn:()=>{};this.callback=(a,c)=>{const{ingest:h}=s(c);h&&i(c)&&(n(a,c),o(c))}}else this.protocolFilterFn=t.protocolFilterFn,this.dispatchedFn=t.dispatchedFn}callback(t,n){this.cancelTimeout(),t?this.stop(t):this.push(n)}close(){if(!this.isClosed()){this.cancelTimeout();const t=()=>{if(this.stop(),this.cleanupFn)try{this.cleanupFn(this,this.info)}catch{}this.closed.resolve()};this.noIterator?t():this.push(t)}}unsubscribe(t){this.protocol.unsubscribe(this,t)}cancelTimeout(){this.timer&&(this.timer.cancel(),this.timer=void 0)}drain(){return this.protocol.isClosed()?Promise.reject(T.errorForCode(P.ConnectionClosed)):this.isClosed()?Promise.reject(T.errorForCode(P.SubClosed)):(this.drained||(this.draining=!0,this.protocol.unsub(this),this.drained=this.protocol.flush(G()).then(()=>{this.protocol.subscriptions.cancel(this)}).catch(()=>{this.protocol.subscriptions.cancel(this)})),this.drained)}isDraining(){return this.draining}isClosed(){return this.done}getSubject(){return this.subject}getMax(){return this.max}getID(){return this.sid}}class Bd{constructor(){u(this,"mux");u(this,"subs");u(this,"sidCounter");this.sidCounter=0,this.mux=null,this.subs=new Map}size(){return this.subs.size}add(e){return this.sidCounter++,e.sid=this.sidCounter,this.subs.set(e.sid,e),e}setMux(e){return this.mux=e,e}getMux(){return this.mux}get(e){return this.subs.get(e)}resub(e){return this.sidCounter++,this.subs.delete(e.sid),e.sid=this.sidCounter,this.subs.set(e.sid,e),e}all(){return Array.from(this.subs.values())}cancel(e){e&&(e.close(),this.subs.delete(e.sid))}handleError(e){if(e&&e.permissionContext){const t=e.permissionContext,n=this.all();let s;if(t.operation==="subscription"&&(s=n.find(i=>i.subject===t.subject&&i.queue===t.queue)),t.operation==="publish"&&(s=n.find(i=>i.requestSubject===t.subject)),s)return s.callback(e,{}),s.close(),this.subs.delete(s.sid),s!==this.mux}return!1}close(){this.subs.forEach(e=>{e.close()})}}class Qr{constructor(e,t){u(this,"connected");u(this,"connectedOnce");u(this,"infoReceived");u(this,"info");u(this,"muxSubscriptions");u(this,"options");u(this,"outbound");u(this,"pongs");u(this,"subscriptions");u(this,"transport");u(this,"noMorePublishing");u(this,"connectError");u(this,"publisher");u(this,"_closed");u(this,"closed");u(this,"listeners");u(this,"heartbeats");u(this,"parser");u(this,"outMsgs");u(this,"inMsgs");u(this,"outBytes");u(this,"inBytes");u(this,"pendingLimit");u(this,"lastError");u(this,"abortReconnect");u(this,"whyClosed");u(this,"servers");u(this,"server");u(this,"features");u(this,"connectPromise");this._closed=!1,this.connected=!1,this.connectedOnce=!1,this.infoReceived=!1,this.noMorePublishing=!1,this.abortReconnect=!1,this.listeners=[],this.pendingLimit=jd,this.outMsgs=0,this.inMsgs=0,this.outBytes=0,this.inBytes=0,this.options=e,this.publisher=t,this.subscriptions=new Bd,this.muxSubscriptions=new id,this.outbound=new Dt,this.pongs=[],this.whyClosed="",this.pendingLimit=e.pendingLimit||this.pendingLimit,this.features=new Uh({major:0,minor:0,micro:0}),this.connectPromise=null;const n=typeof e.servers=="string"?[e.servers]:e.servers;this.servers=new sd(n,{randomize:!e.noRandomize}),this.closed=G(),this.parser=new Zi(this),this.heartbeats=new od(this,this.options.pingInterval||Ba,this.options.maxPingOut||Od)}resetOutbound(){this.outbound.reset();const e=this.pongs;this.pongs=[];const t=T.errorForCode(P.Disconnect);t.stack="",e.forEach(n=>{n.reject(t)}),this.parser=new Zi(this),this.infoReceived=!1}dispatchStatus(e){this.listeners.forEach(t=>{t.push(e)})}status(){const e=new oe;return this.listeners.push(e),e}prepare(){this.transport&&this.transport.discard(),this.info=void 0,this.resetOutbound();const e=G();return e.catch(()=>{}),this.pongs.unshift(e),this.connectError=t=>{e.reject(t)},this.transport=qh(),this.transport.closed().then(async t=>{if(this.connected=!1,!this.isClosed()){await this.disconnected(this.transport.closeError||this.lastError);return}}),e}disconnect(){this.dispatchStatus({type:It.StaleConnection,data:""}),this.transport.disconnect()}reconnect(){return this.connected&&(this.dispatchStatus({type:It.ClientInitiatedReconnect,data:""}),this.transport.disconnect()),Promise.resolve()}async disconnected(e){this.dispatchStatus({type:We.Disconnect,data:this.servers.getCurrentServer().toString()}),this.options.reconnect?await this.dialLoop().then(()=>{var t;this.dispatchStatus({type:We.Reconnect,data:this.servers.getCurrentServer().toString()}),((t=this.lastError)==null?void 0:t.code)===P.AuthenticationExpired&&(this.lastError=void 0)}).catch(t=>{this._close(t)}):await this._close(e)}async dial(e){const t=this.prepare();let n;try{n=Ut(this.options.timeout||2e4);const s=this.transport.connect(e,this.options);await Promise.race([s,n]),(async()=>{try{for await(const i of this.transport)this.parser.parse(i)}catch(i){console.log("reader closed",i)}})().then()}catch(s){t.reject(s)}try{await Promise.race([n,t]),n&&n.cancel(),this.connected=!0,this.connectError=void 0,this.sendSubscriptions(),this.connectedOnce=!0,this.server.didConnect=!0,this.server.reconnects=0,this.flushPending(),this.heartbeats.start()}catch(s){throw n&&n.cancel(),await this.transport.close(s),s}}async _doDial(e){const{resolve:t}=this.options,n=await e.resolve({fn:is(),debug:this.options.debug,randomize:!this.options.noRandomize,resolve:t});let s=null;for(const i of n)try{s=null,this.dispatchStatus({type:It.Reconnecting,data:i.toString()}),await this.dial(i);return}catch(o){s=o}throw s}dialLoop(){return this.connectPromise===null&&(this.connectPromise=this.dodialLoop(),this.connectPromise.then(()=>{}).catch(()=>{}).finally(()=>{this.connectPromise=null})),this.connectPromise}async dodialLoop(){let e;for(;;){this._closed&&this.servers.clear();const t=this.options.reconnectDelayHandler?this.options.reconnectDelayHandler():La;let n=t;const s=this.selectServer();if(!s||this.abortReconnect)throw e||(this.lastError?this.lastError:T.errorForCode(P.ConnectionRefused));const i=Date.now();if(s.lastConnect===0||s.lastConnect+t<=i){s.lastConnect=Date.now();try{await this._doDial(s);break}catch(o){if(e=o,!this.connectedOnce){if(this.options.waitOnFirstConnect)continue;this.servers.removeCurrentServer()}s.reconnects++;const a=this.options.maxReconnectAttempts||0;a!==-1&&s.reconnects>=a&&this.servers.removeCurrentServer()}}else n=Math.min(n,s.lastConnect+t-i),await Vt(n)}}static async connect(e,t){const n=new Qr(e,t);return await n.dialLoop(),n}static toError(e){const t=e?e.toLowerCase():"";if(t.indexOf("permissions violation")!==-1){const n=new T(e,P.PermissionsViolation),s=e.match(/(Publish|Subscription) to "(\S+)"/);if(s){n.permissionContext={operation:s[1].toLowerCase(),subject:s[2],queue:void 0};const i=e.match(/using queue "(\S+)"/);i&&(n.permissionContext.queue=i[1])}return n}else return t.indexOf("authorization violation")!==-1?new T(e,P.AuthorizationViolation):t.indexOf("user authentication expired")!==-1?new T(e,P.AuthenticationExpired):t.indexOf("account authentication expired")!=-1?new T(e,P.AccountExpired):t.indexOf("authentication timeout")!==-1?new T(e,P.AuthenticationTimeout):new T(e,P.ProtocolError)}processMsg(e,t){if(this.inMsgs++,this.inBytes+=t.length,!this.subscriptions.sidCounter)return;const n=this.subscriptions.get(e.sid);n&&(n.received+=1,n.callback&&n.callback(null,new Us(e,t,this)),n.max!==void 0&&n.received>=n.max&&n.unsubscribe())}processError(e){const t=Li(e),n=Qr.toError(t),s={type:We.Error,data:n.code};if(n.isPermissionError()){let i=!1;if(n.permissionContext){s.permissionContext=n.permissionContext;const o=this.subscriptions.getMux();i=(o==null?void 0:o.subject)===n.permissionContext.subject}this.subscriptions.handleError(n),this.muxSubscriptions.handleError(i,n),i&&this.subscriptions.setMux(null)}this.dispatchStatus(s),this.handleError(n)}handleError(e){e.isAuthError()?this.handleAuthError(e):e.isProtocolError()?this.lastError=e:e.isAuthTimeout()&&(this.lastError=e),e.isPermissionError()||(this.lastError=e)}handleAuthError(e){this.lastError&&e.code===this.lastError.code&&this.options.ignoreAuthErrorAbort===!1&&(this.abortReconnect=!0),this.connectError?this.connectError(e):this.disconnect()}processPing(){this.transport.send(Nd)}processPong(){const e=this.pongs.shift();e&&e.resolve()}processInfo(e){const t=JSON.parse(Li(e));this.info=t;const n=this.options&&this.options.ignoreClusterUpdates?void 0:this.servers.update(t,this.transport.isEncrypted());if(!this.infoReceived){this.features.update(dt(t.version)),this.infoReceived=!0,this.transport.isEncrypted()&&this.servers.updateTLSName();const{version:i,lang:o}=this.transport;try{const a=new $d({version:i,lang:o},this.options,t.nonce);t.headers&&(a.headers=!0,a.no_responders=!0);const c=JSON.stringify(a);this.transport.send(ir(`CONNECT ${c}${qr}`)),this.transport.send(eo)}catch(a){this._close(a)}}n&&this.dispatchStatus({type:We.Update,data:n}),(t.ldm!==void 0?t.ldm:!1)&&this.dispatchStatus({type:We.LDM,data:this.servers.getCurrentServer().toString()})}push(e){switch(e.kind){case he.MSG:{const{msg:t,data:n}=e;this.processMsg(t,n);break}case he.OK:break;case he.ERR:this.processError(e.data);break;case he.PING:this.processPing();break;case he.PONG:this.processPong();break;case he.INFO:this.processInfo(e.data);break}}sendCommand(e,...t){const n=this.outbound.length();let s;typeof e=="string"?s=ir(e):s=e,this.outbound.fill(s,...t),n===0?queueMicrotask(()=>{this.flushPending()}):this.outbound.size()>=this.pendingLimit&&this.flushPending()}publish(e,t=xe,n){let s;if(t instanceof Uint8Array)s=t;else if(typeof t=="string")s=at.encode(t);else throw T.errorForCode(P.BadPayload);let i=s.length;n=n||{},n.reply=n.reply||"";let o=xe,a=0;if(n.headers){if(this.info&&!this.info.headers)throw new T("headers",P.ServerOptionNotAvailable);o=n.headers.encode(),a=o.length,i=s.length+a}if(this.info&&i>this.info.max_payload)throw T.errorForCode(P.MaxPayloadExceeded);this.outBytes+=i,this.outMsgs++;let c;n.headers?(n.reply?c=`HPUB ${e} ${n.reply} ${a} ${i}\r
`:c=`HPUB ${e} ${a} ${i}\r
`,this.sendCommand(c,o,s,Xr)):(n.reply?c=`PUB ${e} ${n.reply} ${i}\r
`:c=`PUB ${e} ${i}\r
`,this.sendCommand(c,s,Xr))}request(e){return this.initMux(),this.muxSubscriptions.add(e),e}subscribe(e){return this.subscriptions.add(e),this._subunsub(e),e}_sub(e){e.queue?this.sendCommand(`SUB ${e.subject} ${e.queue} ${e.sid}\r
`):this.sendCommand(`SUB ${e.subject} ${e.sid}\r
`)}_subunsub(e){return this._sub(e),e.max&&this.unsubscribe(e,e.max),e}unsubscribe(e,t){this.unsub(e,t),(e.max===void 0||e.received>=e.max)&&this.subscriptions.cancel(e)}unsub(e,t){!e||this.isClosed()||(t?this.sendCommand(`UNSUB ${e.sid} ${t}\r
`):this.sendCommand(`UNSUB ${e.sid}\r
`),e.max=t)}resub(e,t){!e||this.isClosed()||(this.unsub(e),e.subject=t,this.subscriptions.resub(e),this._sub(e))}flush(e){return e||(e=G()),this.pongs.push(e),this.outbound.fill(eo),this.flushPending(),e}sendSubscriptions(){const e=[];this.subscriptions.all().forEach(t=>{const n=t;n.queue?e.push(`SUB ${n.subject} ${n.queue} ${n.sid}${qr}`):e.push(`SUB ${n.subject} ${n.sid}${qr}`)}),e.length&&this.transport.send(ir(e.join("")))}async _close(e){this._closed||(this.whyClosed=new Error("close trace").stack||"",this.heartbeats.cancel(),this.connectError&&(this.connectError(e),this.connectError=void 0),this.muxSubscriptions.close(),this.subscriptions.close(),this.listeners.forEach(t=>{t.stop()}),this._closed=!0,await this.transport.close(e),await this.closed.resolve(e))}close(){return this._close()}isClosed(){return this._closed}drain(){const e=this.subscriptions.all(),t=[];return e.forEach(n=>{t.push(n.drain())}),Promise.all(t).then(async()=>(this.noMorePublishing=!0,await this.flush(),this.close())).catch(()=>{})}flushPending(){if(!(!this.infoReceived||!this.connected)&&this.outbound.size()){const e=this.outbound.drain();this.transport.send(e)}}initMux(){if(!this.subscriptions.getMux()){const t=this.muxSubscriptions.init(this.options.inboxPrefix),n=new Ua(this,`${t}*`);n.callback=this.muxSubscriptions.dispatcher(),this.subscriptions.setMux(n),this.subscribe(n)}}selectServer(){const e=this.servers.selectServer();if(e!==void 0)return this.server=e,this.server}getServer(){return this.server}}const Ld="$SRV";class to{constructor(e){u(this,"msg");this.msg=e}get data(){return this.msg.data}get sid(){return this.msg.sid}get subject(){return this.msg.subject}get reply(){return this.msg.reply||""}get headers(){return this.msg.headers}respond(e,t){return this.msg.respond(e,t)}respondError(e,t,n,s){var i,o;return s=s||{},s.headers=s.headers||Ke(),(i=s.headers)==null||i.set(Gr,`${e}`),(o=s.headers)==null||o.set(Jr,t),this.msg.respond(n,s)}json(e){return this.msg.json(e)}string(){return this.msg.string()}}class pr{constructor(e,t="",n=""){u(this,"subject");u(this,"queue");u(this,"srv");t!==""&&Fd("service group",t);let s="";if(e instanceof Sr)this.srv=e,s="";else if(e instanceof pr){const i=e;this.srv=i.srv,n===""&&i.queue!==""&&(n=i.queue),s=i.subject}else throw new Error("unknown ServiceGroup type");this.subject=this.calcSubject(s,t),this.queue=n}calcSubject(e,t=""){return t===""?e:e!==""?`${e}.${t}`:t}addEndpoint(e="",t){t=t||{subject:e};const n=typeof t=="function"?{handler:t,subject:e}:t;er("endpoint",e);let{subject:s,handler:i,metadata:o,queue:a}=n;s=s||e,a=a||this.queue,Ud("endpoint subject",s),s=this.calcSubject(this.subject,s);const c={name:e,subject:s,queue:a,handler:i,metadata:o};return this.srv._addEndpoint(c)}addGroup(e="",t=""){return new pr(this,e,t)}}function Ud(r,e){if(e==="")throw new Error(`${r} cannot be empty`);if(e.indexOf(" ")!==-1)throw new Error(`${r} cannot contain spaces: '${e}'`);const t=e.split(".");t.forEach((n,s)=>{if(n===">"&&s!==t.length-1)throw new Error(`${r} cannot have internal '>': '${e}'`)})}function Fd(r,e){if(e.indexOf(" ")!==-1)throw new Error(`${r} cannot contain spaces: '${e}'`);e.split(".").forEach(n=>{if(n===">")throw new Error(`${r} name cannot contain internal '>': '${e}'`)})}class Sr{constructor(e,t={name:"",version:""}){u(this,"nc");u(this,"_id");u(this,"config");u(this,"handlers");u(this,"internal");u(this,"_stopped");u(this,"_done");u(this,"started");this.nc=e,this.config=Object.assign({},t),this.config.queue||(this.config.queue="q"),er("name",this.config.name),er("queue",this.config.queue),dt(this.config.version),this._id=gt.next(),this.internal=[],this._done=G(),this._stopped=!1,this.handlers=[],this.started=new Date().toISOString(),this.reset(),this.nc.closed().then(()=>{this.close().catch()}).catch(n=>{this.close(n).catch()})}static controlSubject(e,t="",n="",s){const i=s??Ld;return t===""&&n===""?`${i}.${e}`:(er("control subject name",t),n!==""?(er("control subject id",n),`${i}.${e}.${t}.${n}`):`${i}.${e}.${t}`)}get subjects(){return this.handlers.filter(e=>e.internal===!1).map(e=>e.subject)}get id(){return this._id}get name(){return this.config.name}get description(){return this.config.description??""}get version(){return this.config.version}get metadata(){return this.config.metadata}errorToHeader(e){const t=Ke();if(e instanceof Yr){const n=e;t.set(Jr,n.message),t.set(Gr,`${n.code}`)}else t.set(Jr,e.message),t.set(Gr,"500");return t}setupHandler(e,t=!1){const n=t?"":e.queue?e.queue:this.config.queue,{name:s,subject:i,handler:o}=e,a=e;a.internal=t,t&&this.internal.push(a),a.stats=new Dd(s,i,n),a.queue=n;const c=o?(h,m)=>{if(h){this.close(h);return}const p=Date.now();try{o(h,new to(m))}catch(x){a.stats.countError(x),m==null||m.respond(xe,{headers:this.errorToHeader(x)})}finally{a.stats.countLatency(p)}}:void 0;return a.sub=this.nc.subscribe(i,{callback:c,queue:n}),a.sub.closed.then(()=>{this._stopped||this.close(new Error(`required subscription ${e.subject} stopped`)).catch()}).catch(h=>{if(!this._stopped){const m=new Error(`required subscription ${e.subject} errored: ${h.message}`);m.stack=h.stack,this.close(m).catch()}}),a}info(){return{type:or.INFO,name:this.name,id:this.id,version:this.version,description:this.description,metadata:this.metadata,endpoints:this.endpoints()}}endpoints(){return this.handlers.map(e=>{const{subject:t,metadata:n,name:s,queue:i}=e;return{subject:t,metadata:n,name:s,queue_group:i}})}async stats(){const e=[];for(const t of this.handlers){if(typeof this.config.statsHandler=="function")try{t.stats.data=await this.config.statsHandler(t)}catch(n){t.stats.countError(n)}e.push(t.stats.stats(t.qi))}return{type:or.STATS,name:this.name,id:this.id,version:this.version,started:this.started,metadata:this.metadata,endpoints:e}}addInternalHandler(e,t){const n=`${e}`.toUpperCase();this._doAddInternalHandler(`${n}-all`,e,t),this._doAddInternalHandler(`${n}-kind`,e,t,this.name),this._doAddInternalHandler(`${n}`,e,t,this.name,this.id)}_doAddInternalHandler(e,t,n,s="",i=""){const o={};o.name=e,o.subject=Sr.controlSubject(t,s,i),o.handler=n,this.setupHandler(o,!0)}start(){const e=Pe(),t=(o,a)=>o?(this.close(o),Promise.reject(o)):this.stats().then(c=>(a==null||a.respond(e.encode(c)),Promise.resolve())),n=(o,a)=>o?(this.close(o),Promise.reject(o)):(a==null||a.respond(e.encode(this.info())),Promise.resolve()),s=e.encode(this.ping()),i=(o,a)=>o?(this.close(o).then().catch(),Promise.reject(o)):(a.respond(s),Promise.resolve());return this.addInternalHandler(tt.PING,i),this.addInternalHandler(tt.STATS,t),this.addInternalHandler(tt.INFO,n),this.handlers.forEach(o=>{const{subject:a}=o;typeof a=="string"&&o.handler!==null&&this.setupHandler(o)}),Promise.resolve(this)}close(e){if(this._stopped)return this._done;this._stopped=!0;let t=[];return this.nc.isClosed()||(t=this.handlers.concat(this.internal).map(n=>n.sub.drain())),Promise.allSettled(t).then(()=>{this._done.resolve(e||null)}),this._done}get stopped(){return this._done}get isStopped(){return this._stopped}stop(e){return this.close(e)}ping(){return{type:or.PING,name:this.name,id:this.id,version:this.version,metadata:this.metadata}}reset(){if(this.started=new Date().toISOString(),this.handlers)for(const e of this.handlers)e.stats.reset(e.qi)}addGroup(e,t){return new pr(this,e,t)}addEndpoint(e,t){return new pr(this).addEndpoint(e,t)}_addEndpoint(e){const t=new oe;t.noIterator=typeof e.handler=="function",t.noIterator||(e.handler=(s,i)=>{s?this.stop(s).catch():t.push(new to(i))},t.iterClosed.then(()=>{this.close().catch()}));const n=this.setupHandler(e,!1);return n.qi=t,this.handlers.push(n),t}}class Dd{constructor(e,t,n=""){u(this,"name");u(this,"subject");u(this,"average_processing_time");u(this,"num_requests");u(this,"processing_time");u(this,"num_errors");u(this,"last_error");u(this,"data");u(this,"metadata");u(this,"queue");this.name=e,this.subject=t,this.average_processing_time=0,this.num_errors=0,this.num_requests=0,this.processing_time=0,this.queue=n}reset(e){this.num_requests=0,this.processing_time=0,this.average_processing_time=0,this.num_errors=0,this.last_error=void 0,this.data=void 0;const t=e;t&&(t.time=0,t.processed=0)}countLatency(e){this.num_requests++,this.processing_time+=X(Date.now()-e),this.average_processing_time=Math.round(this.processing_time/this.num_requests)}countError(e){this.num_errors++,this.last_error=e.message}_stats(){const{name:e,subject:t,average_processing_time:n,num_errors:s,num_requests:i,processing_time:o,last_error:a,data:c,queue:h}=this;return{name:e,subject:t,average_processing_time:n,num_errors:s,num_requests:i,processing_time:o,last_error:a,data:c,queue_group:h}}stats(e){const t=e;return(t==null?void 0:t.noIterator)===!1&&(this.processing_time=t.time,this.num_requests=t.processed,this.average_processing_time=this.processing_time>0&&this.num_requests>0?this.processing_time/this.num_requests:0),this._stats()}}class qd{constructor(e,t={strategy:Te.JitterTimer,maxWait:2e3},n){u(this,"nc");u(this,"prefix");u(this,"opts");this.nc=e,this.prefix=n,this.opts=t}ping(e="",t=""){return this.q(tt.PING,e,t)}stats(e="",t=""){return this.q(tt.STATS,e,t)}info(e="",t=""){return this.q(tt.INFO,e,t)}async q(e,t="",n=""){const s=new oe,i=Pe(),o=Sr.controlSubject(e,t,n,this.prefix),a=await this.nc.requestMany(o,xe,this.opts);return(async()=>{for await(const c of a)try{const h=i.decode(c.data);s.push(h)}catch(h){s.push(()=>{s.stop(h)})}s.push(()=>{s.stop()})})().catch(c=>{s.stop(c)}),s}}function Fa(){return{key:{encode(r){return r},decode(r){return r}},value:{encode(r){return r},decode(r){return r}}}}function Wd(){return{replicas:1,history:1,timeout:2e3,max_bytes:-1,maxValueSize:-1,codec:Fa(),storage:ns.File}}const en="KV-Operation",ro="$KV",Hd=/^[-/=.\w]+$/,Vd=/^[-/=.>*\w]+$/,zd=/^[-\w]+$/;function Jd(r){if(r.startsWith(".")||r.endsWith(".")||!Hd.test(r))throw new Error(`invalid key: ${r}`)}function Gd(r){if(r.startsWith(".")||r.endsWith(".")||!Vd.test(r))throw new Error(`invalid key: ${r}`)}function Yd(r){if(r.startsWith(".")||r.endsWith("."))throw new Error(`invalid key: ${r}`);const e=r.split(".");let t=!1;for(let n=0;n<e.length;n++)switch(e[n]){case"*":t=!0;break;case">":if(n!==e.length-1)throw new Error(`invalid key: ${r}`);t=!0;break}return t}function Wr(r){if(!zd.test(r))throw new Error(`invalid bucket name: ${r}`)}var Ue;(function(r){r.MsgIdHdr="Nats-Msg-Id",r.ExpectedStreamHdr="Nats-Expected-Stream",r.ExpectedLastSeqHdr="Nats-Expected-Last-Sequence",r.ExpectedLastMsgIdHdr="Nats-Expected-Last-Msg-Id",r.ExpectedLastSubjectSequenceHdr="Nats-Expected-Last-Subject-Sequence"})(Ue||(Ue={}));class _r{constructor(e,t,n){u(this,"js");u(this,"jsm");u(this,"stream");u(this,"bucket");u(this,"direct");u(this,"codec");u(this,"prefix");u(this,"editPrefix");u(this,"useJsPrefix");u(this,"_prefixLen");u(this,"validateKey",Jd);u(this,"validateSearchKey",Gd);u(this,"hasWildcards",Yd);Wr(e),this.js=t,this.jsm=n,this.bucket=e,this.prefix=ro,this.editPrefix="",this.useJsPrefix=!1,this._prefixLen=0}static async create(e,t,n={}){Wr(t);const s=await e.jetstreamManager(),i=new _r(t,e,s);return await i.init(n),i}static async bind(e,t,n={}){const s=await e.jetstreamManager(),i={config:{allow_direct:n.allow_direct}};Wr(t);const o=new _r(t,e,s);return i.config.name=n.streamName??o.bucketName(),Object.assign(o,i),o.stream=i.config.name,o.codec=n.codec||Fa(),o.direct=i.config.allow_direct??!1,o.initializePrefixes(i),o}async init(e={}){const t=Object.assign(Wd(),e);this.codec=t.codec;const n={};this.stream=n.name=e.streamName??this.bucketName(),n.retention=rs.Limits,n.max_msgs_per_subject=t.history,t.maxBucketSize&&(t.max_bytes=t.maxBucketSize),t.max_bytes&&(n.max_bytes=t.max_bytes),n.max_msg_size=t.maxValueSize,n.storage=t.storage;const s=e.placementCluster??"";if(s&&(e.placement={},e.placement.cluster=s,e.placement.tags=[]),e.placement&&(n.placement=e.placement),e.republish&&(n.republish=e.republish),e.description&&(n.description=e.description),e.mirror){const p=Object.assign({},e.mirror);p.name.startsWith(be)||(p.name=`${be}${p.name}`),n.mirror=p,n.mirror_direct=!0}else if(e.sources){const p=e.sources.map(x=>{const g=Object.assign({},x),v=g.name.startsWith(be)?g.name.substring(be.length):g.name;return g.name.startsWith(be)||(g.name=`${be}${g.name}`),!x.external&&v!==this.bucket&&(g.subject_transforms=[{src:`$KV.${v}.>`,dest:`$KV.${this.bucket}.>`}]),g});n.sources=p,n.subjects=[this.subjectForBucket()]}else n.subjects=[this.subjectForBucket()];e.metadata&&(n.metadata=e.metadata),typeof e.compression=="boolean"&&(n.compression=e.compression?it.S2:it.None);const i=this.js.nc,o=i.getServerVersion(),a=o?ss(o,dt("2.7.2"))>=0:!1;n.discard=a?fr.New:fr.Old;const{ok:c,min:h}=i.features.get(q.JS_ALLOW_DIRECT);if(!c&&e.allow_direct===!0){const p=o?`${o.major}.${o.minor}.${o.micro}`:"unknown";return Promise.reject(new Error(`allow_direct is not available on server version ${p} - requires ${h}`))}e.allow_direct=typeof e.allow_direct=="boolean"?e.allow_direct:c,n.allow_direct=e.allow_direct,this.direct=n.allow_direct,n.num_replicas=t.replicas,t.ttl&&(n.max_age=X(t.ttl)),n.allow_rollup_hdrs=!0;let m;try{m=await this.jsm.streams.info(n.name),!m.config.allow_direct&&this.direct===!0&&(this.direct=!1)}catch(p){if(p.message==="stream not found")m=await this.jsm.streams.add(n);else throw p}this.initializePrefixes(m)}initializePrefixes(e){this._prefixLen=0,this.prefix=`$KV.${this.bucket}`,this.useJsPrefix=this.js.apiPrefix!=="$JS.API";const{mirror:t}=e.config;if(t){let n=t.name;if(n.startsWith(be)&&(n=n.substring(be.length)),t.external&&t.external.api!==""){const s=t.name.substring(be.length);this.useJsPrefix=!1,this.prefix=`$KV.${s}`,this.editPrefix=`${t.external.api}.$KV.${n}`}else this.editPrefix=this.prefix}}bucketName(){return this.stream??`${be}${this.bucket}`}subjectForBucket(){return`${this.prefix}.${this.bucket}.>`}subjectForKey(e,t=!1){const n=[];return t?(this.useJsPrefix&&n.push(this.js.apiPrefix),this.editPrefix!==""?n.push(this.editPrefix):n.push(this.prefix)):this.prefix&&n.push(this.prefix),n.push(e),n.join(".")}fullKeyName(e){return this.prefix!==""?`${this.prefix}.${e}`:`${ro}.${this.bucket}.${e}`}get prefixLen(){return this._prefixLen===0&&(this._prefixLen=this.prefix.length+1),this._prefixLen}encodeKey(e){const t=[];for(const n of e.split("."))switch(n){case">":case"*":t.push(n);break;default:t.push(this.codec.key.encode(n));break}return t.join(".")}decodeKey(e){const t=[];for(const n of e.split("."))switch(n){case">":case"*":t.push(n);break;default:t.push(this.codec.key.decode(n));break}return t.join(".")}close(){return Promise.resolve()}dataLen(e,t){const n=t&&t.get(fe.MessageSizeHdr)||"";return n!==""?parseInt(n,10):e.length}smToEntry(e){return new hf(this.bucket,this.prefixLen,e)}jmToEntry(e){const t=this.decodeKey(e.subject.substring(this.prefixLen));return new df(this.bucket,t,e)}async create(e,t){var i;let n;try{const o=await this.put(e,t,{previousSeq:0});return Promise.resolve(o)}catch(o){if(n=o,((i=o==null?void 0:o.api_error)==null?void 0:i.err_code)!==10071)return Promise.reject(o)}let s=0;try{const o=await this.get(e);return(o==null?void 0:o.operation)==="DEL"||(o==null?void 0:o.operation)==="PURGE"?(s=o!==null?o.revision:0,this.update(e,t,s)):Promise.reject(n)}catch(o){return Promise.reject(o)}}update(e,t,n){if(n<=0)throw new Error("version must be greater than 0");return this.put(e,t,{previousSeq:n})}async put(e,t,n={}){var o,a;const s=this.encodeKey(e);this.validateKey(s);const i={};if(n.previousSeq!==void 0){const c=Ke();i.headers=c,c.set(Ue.ExpectedLastSubjectSequenceHdr,`${n.previousSeq}`)}try{return(await this.js.publish(this.subjectForKey(s,!0),t,i)).seq}catch(c){const h=c;return h.isJetStreamError()?(h.message=(o=h.api_error)==null?void 0:o.description,h.code=`${(a=h.api_error)==null?void 0:a.code}`,Promise.reject(h)):Promise.reject(c)}}async get(e,t){const n=this.encodeKey(e);this.validateKey(n);let s={last_by_subj:this.subjectForKey(n)};t&&t.revision>0&&(s={seq:t.revision});let i;try{this.direct?i=await this.jsm.direct.getMessage(this.bucketName(),s):i=await this.jsm.streams.getMessage(this.bucketName(),s);const o=this.smToEntry(i);return o.key!==n?null:o}catch(o){if(o.code===P.JetStream404NoMessages)return null;throw o}}purge(e,t){return this._deleteOrPurge(e,"PURGE",t)}delete(e,t){return this._deleteOrPurge(e,"DEL",t)}async purgeDeletes(e=30*60*1e3){const t=G(),n=[],s=await this.watch({key:">",initializedFn:()=>{t.resolve()}});(async()=>{for await(const c of s)(c.operation==="DEL"||c.operation==="PURGE")&&n.push(c)})().then(),await t,s.stop();const i=Date.now()-e,o=n.map(c=>{const h=this.subjectForKey(c.key);return c.created.getTime()>=i?this.jsm.streams.purge(this.stream,{filter:h,keep:1}):this.jsm.streams.purge(this.stream,{filter:h,keep:0})}),a=await Promise.all(o);return a.unshift({success:!0,purged:0}),a.reduce((c,h)=>(c.purged+=h.purged,c))}async _deleteOrPurge(e,t,n){if(!this.hasWildcards(e))return this._doDeleteOrPurge(e,t,n);const s=await this.keys(e),i=[];for await(const o of s)i.push(this._doDeleteOrPurge(o,t)),i.length===100&&(await Promise.all(i),i.length=0);i.length>0&&await Promise.all(i)}async _doDeleteOrPurge(e,t,n){const s=this.encodeKey(e);this.validateKey(s);const i=Ke();i.set(en,t),t==="PURGE"&&i.set(fe.RollupHdr,fe.RollupValueSubject),n!=null&&n.previousSeq&&i.set(Ue.ExpectedLastSubjectSequenceHdr,`${n.previousSeq}`),await this.js.publish(this.subjectForKey(s,!0),xe,{headers:i})}_buildCC(e,t,n={}){let i=(Array.isArray(e)?e:[e]).map(c=>{const h=this.encodeKey(c);return this.validateSearchKey(c),this.fullKeyName(h)}),o=te.LastPerSubject;t===Ie.AllHistory&&(o=te.All),t===Ie.UpdatesOnly&&(o=te.New);let a;return i.length===1&&(a=i[0],i=void 0),Object.assign({deliver_policy:o,ack_policy:ie.None,filter_subjects:i,filter_subject:a,flow_control:!0,idle_heartbeat:X(5*1e3)},n)}remove(e){return this.purge(e)}async history(e={}){const t=e.key??">",n=new oe,s={};s.headers_only=e.headers_only||!1;let i;i=()=>{n.stop()};let o=0;const a=this._buildCC(t,Ie.AllHistory,s),c=a.filter_subject,h=nt(a);h.bindStream(this.stream),h.orderedConsumer(),h.callback((p,x)=>{if(p){n.stop(p);return}if(x){const g=this.jmToEntry(x);n.push(g),n.received++,(i&&o>0&&n.received>=o||x.info.pending===0)&&(n.push(i),i=void 0)}});const m=await this.js.subscribe(c,h);if(i){const{info:{last:p}}=m,x=p.num_pending+p.delivered.consumer_seq;if(x===0||n.received>=x)try{i()}catch(g){n.stop(g)}finally{i=void 0}else o=x}return n._data=m,n.iterClosed.then(()=>{m.unsubscribe()}),m.closed.then(()=>{n.stop()}).catch(p=>{n.stop(p)}),n}canSetWatcherName(){const t=this.js.nc,{ok:n}=t.features.get(q.JS_NEW_CONSUMER_CREATE_API);return n}async watch(e={}){const t=e.key??">",n=new oe,s={};s.headers_only=e.headers_only||!1;let i=Ie.LastValue;e.include===Ie.AllHistory?i=Ie.AllHistory:e.include===Ie.UpdatesOnly&&(i=Ie.UpdatesOnly);const o=e.ignoreDeletes===!0;let a=e.initializedFn,c=0;const h=this._buildCC(t,i,s),m=h.filter_subject,p=nt(h);this.canSetWatcherName()&&p.consumerName(gt.next()),p.bindStream(this.stream),e.resumeFromRevision&&e.resumeFromRevision>0&&p.startSequence(e.resumeFromRevision),p.orderedConsumer(),p.callback((g,v)=>{if(g){n.stop(g);return}if(v){const I=this.jmToEntry(v);if(o&&I.operation==="DEL")return;n.push(I),n.received++,a&&(c>0&&n.received>=c||v.info.pending===0)&&(n.push(a),a=void 0)}});const x=await this.js.subscribe(m,p);if(a){const{info:{last:g}}=x,v=g.num_pending+g.delivered.consumer_seq;if(v===0||n.received>=v)try{a()}catch(I){n.stop(I)}finally{a=void 0}else c=v}return n._data=x,n.iterClosed.then(()=>{x.unsubscribe()}),x.closed.then(()=>{n.stop()}).catch(g=>{n.stop(g)}),n}async keys(e=">"){const t=new oe,n=this._buildCC(e,Ie.LastValue,{headers_only:!0}),s=Array.isArray(e)?">":n.filter_subject,i=nt(n);i.bindStream(this.stream),i.orderedConsumer();const o=await this.js.subscribe(s,i);return(async()=>{var c;for await(const h of o){const m=(c=h.headers)==null?void 0:c.get(en);if(m!=="DEL"&&m!=="PURGE"){const p=this.decodeKey(h.subject.substring(this.prefixLen));t.push(p)}h.info.pending===0&&o.unsubscribe()}})().then(()=>{t.stop()}).catch(c=>{t.stop(c)}),o.info.last.num_pending===0&&o.unsubscribe(),t}purgeBucket(e){return this.jsm.streams.purge(this.bucketName(),e)}destroy(){return this.jsm.streams.delete(this.bucketName())}async status(){var i;const t=((i=this.js.nc.info)==null?void 0:i.cluster)??"",n=this.bucketName(),s=await this.jsm.streams.info(n);return new Da(s,t)}}class Da{constructor(e,t=""){u(this,"si");u(this,"cluster");this.si=e,this.cluster=t}get bucket(){return this.si.config.name.startsWith(be)?this.si.config.name.substring(be.length):this.si.config.name}get values(){return this.si.state.messages}get history(){return this.si.config.max_msgs_per_subject}get ttl(){return Ls(this.si.config.max_age)}get bucket_location(){return this.cluster}get backingStore(){return this.si.config.storage}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get description(){return this.si.config.description??""}get maxBucketSize(){return this.si.config.max_bytes}get maxValueSize(){return this.si.config.max_msg_size}get max_bytes(){return this.si.config.max_bytes}get placement(){return this.si.config.placement||{cluster:"",tags:[]}}get placementCluster(){var e;return((e=this.si.config.placement)==null?void 0:e.cluster)??""}get republish(){return this.si.config.republish??{src:"",dest:""}}get streamInfo(){return this.si}get size(){return this.si.state.bytes}get metadata(){return this.si.config.metadata??{}}get compression(){return this.si.config.compression?this.si.config.compression!==it.None:!1}}const qs="OBJ_",no="SHA-256=";function Kd(r){return Wr(r),`${qs}${r}`}function Xd(r){return r.startsWith(qs)?r.substring(4):r}class cs{constructor(e){u(this,"si");u(this,"backingStore");this.si=e,this.backingStore="JetStream"}get bucket(){return Xd(this.si.config.name)}get description(){return this.si.config.description??""}get ttl(){return this.si.config.max_age}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get sealed(){return this.si.config.sealed}get size(){return this.si.state.bytes}get streamInfo(){return this.si}get metadata(){return this.si.config.metadata}get compression(){return this.si.config.compression?this.si.config.compression!==it.None:!1}}function Ur(r){if(r===void 0)return;const{domain:e}=r;if(e===void 0)return r;const t=Object.assign({},r);if(delete t.domain,e==="")return t;if(t.external)throw new Error("domain and external are both set");return t.external={api:`$JS.${e}.API`},t}var ke;(function(r){r[r.Unset=-1]="Unset",r[r.Consume=0]="Consume",r[r.Fetch=1]="Fetch"})(ke||(ke={}));var Ve;(function(r){r.HeartbeatsMissed="heartbeats_missed",r.ConsumerNotFound="consumer_not_found",r.StreamNotFound="stream_not_found",r.ConsumerDeleted="consumer_deleted",r.OrderedConsumerRecreated="ordered_consumer_recreated"})(Ve||(Ve={}));var jt;(function(r){r.DebugEvent="debug",r.Discard="discard",r.Reset="reset",r.Next="next"})(jt||(jt={}));const so=Uint8Array.of(43,65,67,75),Zd=Uint8Array.of(45,78,65,75),Qt=Uint8Array.of(43,87,80,73),Qd=Uint8Array.of(43,78,88,84),ef=Uint8Array.of(43,84,69,82,77),tf=Uint8Array.of(32);function mr(r,e=5e3){return new yf(r,e)}class Fn extends oe{constructor(t,n,s=!1){super();u(this,"consumer");u(this,"opts");u(this,"sub");u(this,"monitor");u(this,"pending");u(this,"inbox");u(this,"refilling");u(this,"pong");u(this,"callback");u(this,"timeout");u(this,"cleanupHandler");u(this,"listeners");u(this,"statusIterator");u(this,"forOrderedConsumer");u(this,"resetHandler");u(this,"abortOnMissingResource");u(this,"bind");this.consumer=t;const i=n;this.opts=this.parseOptions(n,s),this.callback=i.callback||null,this.noIterator=typeof this.callback=="function",this.monitor=null,this.pong=null,this.pending={msgs:0,bytes:0,requests:0},this.refilling=s,this.timeout=null,this.inbox=Je(t.api.nc.options.inboxPrefix),this.listeners=[],this.forOrderedConsumer=!1,this.abortOnMissingResource=i.abort_on_missing_resource===!0,this.bind=i.bind===!0,this.start()}start(){const{max_messages:t,max_bytes:n,idle_heartbeat:s,threshold_bytes:i,threshold_messages:o}=this.opts;this.closed().then(c=>{if(this.cleanupHandler)try{this.cleanupHandler(c)}catch{}});const{sub:a}=this;a&&a.unsubscribe(),this.sub=this.consumer.api.nc.subscribe(this.inbox,{callback:(c,h)=>{var p,x,g,v;if(c){this.stop(c);return}if((p=this.monitor)==null||p.work(),h.subject===this.inbox){if(ts(h))return;const I=(x=h.headers)==null?void 0:x.code,M=((v=(g=h.headers)==null?void 0:g.description)==null?void 0:v.toLowerCase())||"unknown",{msgsLeft:j,bytesLeft:C}=this.parseDiscard(h.headers);if(j>0||C>0)this.pending.msgs-=j,this.pending.bytes-=C,this.pending.requests--,this.notify(jt.Discard,{msgsLeft:j,bytesLeft:C});else if(I===400){this.stop(new T(M,`${I}`));return}else if(I===409&&M==="consumer deleted"){if(this.notify(Ve.ConsumerDeleted,`${I} ${M}`),!this.refilling||this.abortOnMissingResource){const D=new T(M,`${I}`);this.stop(D);return}}else this.notify(jt.DebugEvent,`${I} ${M}`)}else this._push(mr(h,this.consumer.api.timeout)),this.received++,this.pending.msgs&&this.pending.msgs--,this.pending.bytes&&(this.pending.bytes-=h.size());if(this.pending.msgs===0&&this.pending.bytes===0&&(this.pending.requests=0),this.refilling){if(t&&this.pending.msgs<=o||n&&this.pending.bytes<=i){const I=this.pullOptions();this.pull(I)}}else this.pending.requests===0&&this._push(()=>{this.stop()})}}),this.sub.closed.then(()=>{this.sub.draining&&this._push(()=>{this.stop()})}),s&&(this.monitor=new Fs(s,c=>(this.notify(Ve.HeartbeatsMissed,c),this.resetPending().then(()=>{}).catch(()=>{}),!1),{maxOut:2})),(async()=>{var h;const c=this.consumer.api.nc.status();this.statusIterator=c;for await(const m of c)switch(m.type){case We.Disconnect:(h=this.monitor)==null||h.cancel();break;case We.Reconnect:this.resetPending().then(p=>{var x;p&&((x=this.monitor)==null||x.restart())}).catch(()=>{});break}})(),this.pull(this.pullOptions())}_push(t){if(!this.callback)super.push(t);else{const n=typeof t=="function"?t:null;try{n?n():this.callback(t)}catch(s){this.stop(s)}}}notify(t,n){this.listeners.length>0&&this.listeners.forEach(s=>{s.done||s.push({type:t,data:n})})}resetPending(){return this.bind?this.resetPendingNoInfo():this.resetPendingWithInfo()}resetPendingNoInfo(){return this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),Promise.resolve(!0)}async resetPendingWithInfo(){let t=0,n=0;const s=Bs();let i=0;for(;;){if(this.done)return!1;if(this.consumer.api.nc.isClosed())return console.error("aborting resetPending - connection is closed"),!1;try{return await this.consumer.info(),t=0,this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),!0}catch(o){if(o.message==="stream not found"){if(n++,this.notify(Ve.StreamNotFound,n),!this.refilling||this.abortOnMissingResource)return this.stop(o),!1}else if(o.message==="consumer not found"){if(t++,this.notify(Ve.ConsumerNotFound,t),this.resetHandler)try{this.resetHandler()}catch{}if(!this.refilling||this.abortOnMissingResource)return this.stop(o),!1;if(this.forOrderedConsumer)return!1}else t=0,n=0;const a=s.backoff(i),c=Vt(a);await Promise.race([c,this.consumer.api.nc.closed()]),c.cancel(),i++}}}pull(t){this.pending.bytes+=t.max_bytes??0,this.pending.msgs+=t.batch??0,this.pending.requests++;const n=this.consumer.api.nc;this._push(()=>{n.publish(`${this.consumer.api.prefix}.CONSUMER.MSG.NEXT.${this.consumer.stream}.${this.consumer.name}`,this.consumer.api.jc.encode(t),{reply:this.inbox}),this.notify(jt.Next,t)})}pullOptions(){const t=this.opts.max_messages-this.pending.msgs,n=this.opts.max_bytes-this.pending.bytes,s=X(this.opts.idle_heartbeat),i=X(this.opts.expires);return{batch:t,max_bytes:n,idle_heartbeat:s,expires:i}}parseDiscard(t){const n={msgsLeft:0,bytesLeft:0},s=t==null?void 0:t.get(fe.PendingMessagesHdr);s&&(n.msgsLeft=parseInt(s));const i=t==null?void 0:t.get(fe.PendingBytesHdr);return i&&(n.bytesLeft=parseInt(i)),n}trackTimeout(t){this.timeout=t}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}clearTimers(){var t,n;(t=this.monitor)==null||t.cancel(),this.monitor=null,(n=this.timeout)==null||n.cancel(),this.timeout=null}setCleanupHandler(t){this.cleanupHandler=t}stop(t){var n,s;this.done||((n=this.sub)==null||n.unsubscribe(),this.clearTimers(),(s=this.statusIterator)==null||s.stop(),this._push(()=>{super.stop(t),this.listeners.forEach(i=>{i.stop()})}))}parseOptions(t,n=!1){const s=t||{};if(s.max_messages=s.max_messages||0,s.max_bytes=s.max_bytes||0,s.max_messages!==0&&s.max_bytes!==0)throw new Error("only specify one of max_messages or max_bytes");if(s.max_messages===0&&(s.max_messages=100),s.expires=s.expires||3e4,s.expires<1e3)throw new Error("expires should be at least 1000ms");if(s.idle_heartbeat=s.idle_heartbeat||s.expires/2,s.idle_heartbeat=s.idle_heartbeat>3e4?3e4:s.idle_heartbeat,n){const i=Math.round(s.max_messages*.75)||1;s.threshold_messages=s.threshold_messages||i;const o=Math.round(s.max_bytes*.75)||1;s.threshold_bytes=s.threshold_bytes||o}return s}status(){const t=new oe;return this.listeners.push(t),Promise.resolve(t)}}class rf extends oe{constructor(){super();u(this,"src");u(this,"listeners");this.listeners=[]}setSource(t){this.src&&(this.src.resetHandler=void 0,this.src.setCleanupHandler(),this.src.stop()),this.src=t,this.src.setCleanupHandler(n=>{this.stop(n||void 0)}),(async()=>{const n=await this.src.status();for await(const s of n)this.notify(s.type,s.data)})().catch(()=>{})}notify(t,n){this.listeners.length>0&&this.listeners.forEach(s=>{s.done||s.push({type:t,data:n})})}stop(t){var n;this.done||((n=this.src)==null||n.stop(t),super.stop(t),this.listeners.forEach(s=>{s.stop()}))}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}status(){const t=new oe;return this.listeners.push(t),Promise.resolve(t)}}class qa{constructor(e,t){u(this,"api");u(this,"_info");u(this,"stream");u(this,"name");this.api=e,this._info=t,this.stream=t.stream_name,this.name=t.name}consume(e={max_messages:100,expires:3e4}){return Promise.resolve(new Fn(this,e,!0))}fetch(e={max_messages:100,expires:3e4}){const t=new Fn(this,e,!1),n=Math.round(t.opts.expires*1.05),s=Ut(n);return t.closed().catch(()=>{}).finally(()=>{s.cancel()}),s.catch(()=>{t.close().catch()}),t.trackTimeout(s),Promise.resolve(t)}next(e={expires:3e4}){const t=G(),n=e;n.max_messages=1;const s=new Fn(this,n,!1),i=Math.round(s.opts.expires*1.05);i>=6e4&&(async()=>{for await(const a of await s.status())if(a.type===Ve.HeartbeatsMissed&&a.data>=2){t.reject(new Error("consumer missed heartbeats"));break}})().catch(),(async()=>{for await(const a of s){t.resolve(a);break}})().catch(()=>{});const o=Ut(i);return s.closed().then(a=>{a?t.reject(a):t.resolve(null)}).catch(a=>{t.reject(a)}).finally(()=>{o.cancel()}),o.catch(a=>{t.resolve(null),s.close().catch()}),s.trackTimeout(o),t}delete(){const{stream_name:e,name:t}=this._info;return this.api.delete(e,t)}info(e=!1){if(e)return Promise.resolve(this._info);const{stream_name:t,name:n}=this._info;return this.api.info(t,n).then(s=>(this._info=s,this._info))}}class nf{constructor(e,t,n={}){u(this,"api");u(this,"consumerOpts");u(this,"consumer");u(this,"opts");u(this,"cursor");u(this,"stream");u(this,"namePrefix");u(this,"serial");u(this,"currentConsumer");u(this,"userCallback");u(this,"iter");u(this,"type");u(this,"startSeq");this.api=e,this.stream=t,this.cursor={stream_seq:1,deliver_seq:0},this.namePrefix=gt.next(),typeof n.name_prefix=="string"&&(an("name_prefix",n.name_prefix),this.namePrefix=n.name_prefix+this.namePrefix),this.serial=0,this.currentConsumer=null,this.userCallback=null,this.iter=null,this.type=ke.Unset,this.consumerOpts=n,this.startSeq=this.consumerOpts.opt_start_seq||0,this.cursor.stream_seq=this.startSeq>0?this.startSeq-1:0}getConsumerOpts(e){this.serial++;const t=`${this.namePrefix}_${this.serial}`;e=e===0?1:e;const n={name:t,deliver_policy:te.StartSequence,opt_start_seq:e,ack_policy:ie.None,inactive_threshold:X(5*60*1e3),num_replicas:1};return this.consumerOpts.headers_only===!0&&(n.headers_only=!0),Array.isArray(this.consumerOpts.filterSubjects)&&(n.filter_subjects=this.consumerOpts.filterSubjects),typeof this.consumerOpts.filterSubjects=="string"&&(n.filter_subject=this.consumerOpts.filterSubjects),this.consumerOpts.replay_policy&&(n.replay_policy=this.consumerOpts.replay_policy),e===this.startSeq+1&&(n.deliver_policy=this.consumerOpts.deliver_policy||te.StartSequence,(this.consumerOpts.deliver_policy===te.LastPerSubject||this.consumerOpts.deliver_policy===te.New||this.consumerOpts.deliver_policy===te.Last)&&(delete n.opt_start_seq,n.deliver_policy=this.consumerOpts.deliver_policy),n.deliver_policy===te.LastPerSubject&&typeof n.filter_subjects>"u"&&typeof n.filter_subject>"u"&&(n.filter_subject=">"),this.consumerOpts.opt_start_time&&(delete n.opt_start_seq,n.deliver_policy=te.StartTime,n.opt_start_time=this.consumerOpts.opt_start_time),this.consumerOpts.inactive_threshold&&(n.inactive_threshold=X(this.consumerOpts.inactive_threshold))),n}async resetConsumer(e=0){var i,o,a,c;(i=this.consumer)==null||i.delete().catch(()=>{}),e=e===0?1:e,this.cursor.deliver_seq=0;const t=this.getConsumerOpts(e);t.max_deliver=1,t.mem_storage=!0;const n=Bs();let s;for(let h=0;;h++)try{s=await this.api.add(this.stream,t),(o=this.iter)==null||o.notify(Ve.OrderedConsumerRecreated,s.name);break}catch(m){if(m.message==="stream not found"&&((a=this.iter)==null||a.notify(Ve.StreamNotFound,h),this.type===ke.Fetch||this.opts.abort_on_missing_resource===!0))return(c=this.iter)==null||c.stop(m),Promise.reject(m);if(e===0&&h>=30)throw m;await Vt(n.backoff(h+1))}return s}internalHandler(e){return t=>{var s;if(this.serial!==e)return;const n=t.info.deliverySequence;if(n!==this.cursor.deliver_seq+1){this.notifyOrderedResetAndReset();return}this.cursor.deliver_seq=n,this.cursor.stream_seq=t.info.streamSequence,this.userCallback?this.userCallback(t):(s=this.iter)==null||s.push(t)}}async reset(e={max_messages:100,expires:3e4},t){var c,h;t=t||{};const n=t.fromFetch||!1,s=t.orderedReset||!1;if(this.type===ke.Fetch&&s){(c=this.iter)==null||c.src.stop(),await((h=this.iter)==null?void 0:h.closed()),this.currentConsumer=null;return}(this.currentConsumer===null||s)&&(this.currentConsumer=await this.resetConsumer(this.cursor.stream_seq+1)),(this.iter===null||n)&&(this.iter=new rf),this.consumer=new qa(this.api,this.currentConsumer);const i=e;i.callback=this.internalHandler(this.serial);let o=null;this.type===ke.Fetch&&n?o=await this.consumer.fetch(e):this.type===ke.Consume&&(o=await this.consumer.consume(e));const a=o;a.forOrderedConsumer=!0,a.resetHandler=()=>{this.notifyOrderedResetAndReset()},this.iter.setSource(a)}notifyOrderedResetAndReset(){var e;(e=this.iter)==null||e.notify(jt.Reset,""),this.reset(this.opts,{orderedReset:!0})}async consume(e={max_messages:100,expires:3e4}){if(e.bind)return Promise.reject(new Error("bind is not supported"));if(this.type===ke.Fetch)return Promise.reject(new Error("ordered consumer initialized as fetch"));if(this.type===ke.Consume)return Promise.reject(new Error("ordered consumer doesn't support concurrent consume"));const{callback:n}=e;return n&&(this.userCallback=n),this.type=ke.Consume,this.opts=e,await this.reset(e),this.iter}async fetch(e={max_messages:100,expires:3e4}){var s;if(e.bind)return Promise.reject(new Error("bind is not supported"));if(this.type===ke.Consume)return Promise.reject(new Error("ordered consumer already initialized as consume"));if(((s=this.iter)==null?void 0:s.done)===!1)return Promise.reject(new Error("ordered consumer doesn't support concurrent fetch"));const{callback:n}=e;return n&&(this.userCallback=n),this.type=ke.Fetch,this.opts=e,await this.reset(e,{fromFetch:!0}),this.iter}async next(e={expires:3e4}){const t=e;if(t.bind)return Promise.reject(new Error("bind is not supported"));t.max_messages=1;const n=G();return t.callback=i=>{this.userCallback=null,n.resolve(i)},(await this.fetch(t)).iterClosed.then(i=>{i&&n.reject(i),n.resolve(null)}).catch(i=>{n.reject(i)}),n}delete(){return this.currentConsumer?this.api.delete(this.stream,this.currentConsumer.name).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e)).finally(()=>{this.currentConsumer=null}):Promise.resolve(!1)}async info(e){return this.currentConsumer==null?(this.currentConsumer=await this.resetConsumer(this.serial),Promise.resolve(this.currentConsumer)):e&&this.currentConsumer?Promise.resolve(this.currentConsumer):this.api.info(this.stream,this.currentConsumer.name)}}class Wa{constructor(e){u(this,"api");u(this,"notified");this.api=e,this.notified=!1}checkVersion(){const e=this.api.nc.features.get(q.JS_SIMPLIFICATION);return e.ok?Promise.resolve():Promise.reject(new Error(`consumers framework is only supported on servers ${e.min} or better`))}async get(e,t={}){return typeof t=="object"?this.ordered(e,t):(await this.checkVersion(),this.api.info(e,t).then(n=>n.config.deliver_subject!==void 0?Promise.reject(new Error("push consumer not supported")):new qa(this.api,n)).catch(n=>Promise.reject(n)))}async ordered(e,t){await this.checkVersion();const n=this.api;return new Ws(n.nc,n.opts).info(e).then(i=>Promise.resolve(new nf(this.api,e,t))).catch(i=>Promise.reject(i))}}class ln{constructor(e,t){u(this,"api");u(this,"_info");this.api=e,this._info=t}get name(){return this._info.config.name}alternates(){return this.info().then(e=>e.alternates?e.alternates:[])}async best(){if(await this.info(),this._info.alternates){const e=await this.api.info(this._info.alternates[0].name);return new ln(this.api,e)}else return this}info(e=!1,t){return e?Promise.resolve(this._info):this.api.info(this.name,t).then(n=>(this._info=n,this._info))}getConsumer(e){return new Wa(new Ds(this.api.nc,this.api.opts)).get(this.name,e)}getMessage(e){return this.api.getMessage(this.name,e)}deleteMessage(e,t){return this.api.deleteMessage(this.name,e,t)}}class Ws extends vr{constructor(e,t){super(e,t)}checkStreamConfigVersions(e){const t=this.nc;if(e.metadata){const{min:s,ok:i}=t.features.get(q.JS_STREAM_CONSUMER_METADATA);if(!i)throw new Error(`stream 'metadata' requires server ${s}`)}if(e.first_seq){const{min:s,ok:i}=t.features.get(q.JS_STREAM_FIRST_SEQ);if(!i)throw new Error(`stream 'first_seq' requires server ${s}`)}if(e.subject_transform){const{min:s,ok:i}=t.features.get(q.JS_STREAM_SUBJECT_TRANSFORM);if(!i)throw new Error(`stream 'subject_transform' requires server ${s}`)}if(e.compression){const{min:s,ok:i}=t.features.get(q.JS_STREAM_COMPRESSION);if(!i)throw new Error(`stream 'compression' requires server ${s}`)}if(e.consumer_limits){const{min:s,ok:i}=t.features.get(q.JS_DEFAULT_CONSUMER_LIMITS);if(!i)throw new Error(`stream 'consumer_limits' requires server ${s}`)}function n(s,i){var a;if((((a=i==null?void 0:i.subject_transforms)==null?void 0:a.length)||0)>0){const{min:c,ok:h}=t.features.get(q.JS_STREAM_SOURCE_SUBJECT_TRANSFORM);if(!h)throw new Error(`${s} 'subject_transforms' requires server ${c}`)}}e.sources&&e.sources.forEach(s=>{n("stream sources",s)}),e.mirror&&n("stream mirror",e.mirror)}async add(e={}){var s;this.checkStreamConfigVersions(e),ue(e.name),e.mirror=Ur(e.mirror),e.sources=(s=e.sources)==null?void 0:s.map(Ur);const n=await this._request(`${this.prefix}.STREAM.CREATE.${e.name}`,e);return this._fixInfo(n),n}async delete(e){return ue(e),(await this._request(`${this.prefix}.STREAM.DELETE.${e}`)).success}async update(e,t={}){var a;if(typeof e=="object"){const c=e;e=c.name,t=c,console.trace("\x1B[33m >> streams.update(config: StreamConfig) api changed to streams.update(name: string, config: StreamUpdateConfig) - this shim will be removed - update your code.  \x1B[0m")}this.checkStreamConfigVersions(t),ue(e);const n=await this.info(e),s=Object.assign(n.config,t);s.mirror=Ur(s.mirror),s.sources=(a=s.sources)==null?void 0:a.map(Ur);const o=await this._request(`${this.prefix}.STREAM.UPDATE.${e}`,s);return this._fixInfo(o),o}async info(e,t){ue(e);const n=`${this.prefix}.STREAM.INFO.${e}`;let i=await this._request(n,t),{total:o,limit:a}=i,c=i.state.subjects?Object.getOwnPropertyNames(i.state.subjects).length:1;if(o&&o>c){const h=[i],m=t||{};let p=0;for(;o>c;){p++,m.offset=a*p;const g=await this._request(n,m);o=g.total,h.push(g);const v=Object.getOwnPropertyNames(g.state.subjects).length;if(c+=v,v<a)break}let x={};for(let g=0;g<h.length;g++)i=h[g],i.state.subjects&&(x=Object.assign(x,i.state.subjects));i.offset=0,i.total=0,i.limit=0,i.state.subjects=x}return this._fixInfo(i),i}list(e=""){const t=e!=null&&e.length?{subject:e}:{},n=i=>{const o=i;return o.streams.forEach(a=>{this._fixInfo(a)}),o.streams},s=`${this.prefix}.STREAM.LIST`;return new tr(s,n,this,t)}_fixInfo(e){e.config.sealed=e.config.sealed||!1,e.config.deny_delete=e.config.deny_delete||!1,e.config.deny_purge=e.config.deny_purge||!1,e.config.allow_rollup_hdrs=e.config.allow_rollup_hdrs||!1}async purge(e,t){if(t){const{keep:s,seq:i}=t;if(typeof s=="number"&&typeof i=="number")throw new Error("can specify one of keep or seq")}return ue(e),await this._request(`${this.prefix}.STREAM.PURGE.${e}`,t)}async deleteMessage(e,t,n=!0){ue(e);const s={seq:t};return n||(s.no_erase=!0),(await this._request(`${this.prefix}.STREAM.MSG.DELETE.${e}`,s)).success}async getMessage(e,t){ue(e);const s=await this._request(`${this.prefix}.STREAM.MSG.GET.${e}`,t);return new Ha(s)}find(e){return this.findStream(e)}listKvs(){const e=n=>{var c;const i=n.streams.filter(h=>h.config.name.startsWith(be));i.forEach(h=>{this._fixInfo(h)});let o="";return i.length&&(o=((c=this.nc.info)==null?void 0:c.cluster)??""),i.map(h=>new Da(h,o))},t=`${this.prefix}.STREAM.LIST`;return new tr(t,e,this)}listObjectStores(){const e=n=>{const i=n.streams.filter(a=>a.config.name.startsWith(qs));return i.forEach(a=>{this._fixInfo(a)}),i.map(a=>new cs(a))},t=`${this.prefix}.STREAM.LIST`;return new tr(t,e,this)}names(e=""){const t=e!=null&&e.length?{subject:e}:{},n=i=>i.streams,s=`${this.prefix}.STREAM.NAMES`;return new tr(s,n,this,t)}async get(e){const t=await this.info(e);return Promise.resolve(new ln(this,t))}}class sf extends vr{constructor(e,t){super(e,t)}async getMessage(e,t){ue(e);let n=t;const{last_by_subj:s}=n;s&&(n=null);const i=n?this.jc.encode(n):xe,o=this.opts.apiPrefix||"$JS.API",a=s?`${o}.DIRECT.GET.${e}.${s}`:`${o}.DIRECT.GET.${e}`,c=await this.nc.request(a,i),h=Rt(c);if(h)return Promise.reject(h);const m=new ls(c);return Promise.resolve(m)}async getBatch(e,t){ue(e);const s=`${this.opts.apiPrefix||"$JS.API"}.DIRECT.GET.${e}`;if(!Array.isArray(t.multi_last)||t.multi_last.length===0)return Promise.reject("multi_last is required");const i=JSON.stringify(t,(c,h)=>c==="up_to_time"&&h instanceof Date?h.toISOString():h),o=new oe,a=await this.nc.requestMany(s,i,{strategy:Te.SentinelMsg});return(async()=>{var p,x,g;let c=!1,h=!1,m;for await(const v of a){if(!c){c=!0;const I=((p=v.headers)==null?void 0:p.code)||0;if(I!==0&&I<200||I>299){m=(x=v.headers)==null?void 0:x.description.toLowerCase();break}if(((g=v.headers)==null?void 0:g.get("Nats-Num-Pending"))===""){h=!0;break}}if(v.data.length===0)break;o.push(new ls(v))}o.push(()=>{if(h)throw new Error("batch direct get not supported by the server");if(m)throw new Error(`bad request: ${m}`);o.stop()})})(),Promise.resolve(o)}}class ls{constructor(e){u(this,"data");u(this,"header");if(!e.headers)throw new Error("headers expected");this.data=e.data,this.header=e.headers}get subject(){return this.header.last(Ct.Subject)}get seq(){const e=this.header.last(Ct.Sequence);return typeof e=="string"?parseInt(e):0}get time(){return new Date(Date.parse(this.timestamp))}get timestamp(){return this.header.last(Ct.TimeStamp)}get stream(){return this.header.last(Ct.Stream)}json(e){return Pe(e).decode(this.data)}string(){return ge.decode(this.data)}}u(ls,"jc");class of extends vr{constructor(t,n){super(t,n);u(this,"streams");u(this,"consumers");u(this,"direct");this.streams=new Ws(t,n),this.consumers=new Ds(t,n),this.direct=new sf(t,n)}async getAccountInfo(){return await this._request(`${this.prefix}.INFO`)}jetstream(){return this.nc.jetstream(this.getOptions())}advisories(){const t=new oe;return this.nc.subscribe("$JS.EVENT.ADVISORY.>",{callback:(n,s)=>{if(n)throw n;try{const i=this.parseJsResponse(s),o=i.type.split("."),a=o[o.length-1];t.push({kind:a,data:i})}catch(i){t.stop(i)}}}),t}}class Ha{constructor(e){u(this,"_header");u(this,"smr");this.smr=e}get subject(){return this.smr.message.subject}get seq(){return this.smr.message.seq}get timestamp(){return this.smr.message.time}get time(){return new Date(Date.parse(this.timestamp))}get data(){return this.smr.message.data?this._parse(this.smr.message.data):xe}get header(){if(!this._header)if(this.smr.message.hdrs){const e=this._parse(this.smr.message.hdrs);this._header=rt.decode(e)}else this._header=Ke();return this._header}_parse(e){const t=atob(e),n=t.length,s=new Uint8Array(n);for(let i=0;i<n;i++)s[i]=t.charCodeAt(i);return s}json(e){return Pe(e).decode(this.data)}string(){return ge.decode(this.data)}}u(Ha,"jc");class af{constructor(e){u(this,"api");this.api=e}get(e){return this.api.info(e).then(t=>new ln(this.api,t))}}class Dn{constructor(e){u(this,"info");u(this,"hdrs");this.info=e}get name(){return this.info.name}get description(){return this.info.description??""}get headers(){return this.hdrs||(this.hdrs=rt.fromRecord(this.info.headers||{})),this.hdrs}get options(){return this.info.options}get bucket(){return this.info.bucket}get chunks(){return this.info.chunks}get deleted(){return this.info.deleted??!1}get digest(){return this.info.digest}get mtime(){return this.info.mtime}get nuid(){return this.info.nuid}get size(){return this.info.size}get revision(){return this.info.revision}get metadata(){return this.info.metadata||{}}isLink(){var e,t;return((e=this.info.options)==null?void 0:e.link)!==void 0&&((t=this.info.options)==null?void 0:t.link)!==null}}function io(r){const e={name:r.name,description:r.description??"",options:r.options,metadata:r.metadata};if(r.headers){const t=r.headers;e.headers=t.toRecord()}return e}function cf(){return new ReadableStream({pull(r){r.enqueue(new Uint8Array(0)),r.close()}})}class lr{constructor(e,t,n){u(this,"jsm");u(this,"js");u(this,"stream");u(this,"name");this.name=e,this.jsm=t,this.js=n}_checkNotEmpty(e){return!e||e.length===0?{name:e,error:new Error("name cannot be empty")}:{name:e}}async info(e){const t=await this.rawInfo(e);return t?new Dn(t):null}async list(){const e=[],t=await this.watch({ignoreDeletes:!0,includeHistory:!0});for await(const n of t){if(n===null)break;e.push(n)}return Promise.resolve(e)}async rawInfo(e){const{name:t,error:n}=this._checkNotEmpty(e);if(n)return Promise.reject(n);const s=this._metaSubject(t);try{const i=await this.jsm.streams.getMessage(this.stream,{last_by_subj:s}),a=Pe().decode(i.data);return a.revision=i.seq,a}catch(i){return i.code==="404"?null:Promise.reject(i)}}async _si(e){try{return await this.jsm.streams.info(this.stream,e)}catch(t){return t.code==="404"?null:Promise.reject(t)}}async seal(){let e=await this._si();return e===null?Promise.reject(new Error("object store not found")):(e.config.sealed=!0,e=await this.jsm.streams.update(this.stream,e.config),Promise.resolve(new cs(e)))}async status(e){const t=await this._si(e);return t===null?Promise.reject(new Error("object store not found")):Promise.resolve(new cs(t))}destroy(){return this.jsm.streams.delete(this.stream)}async _put(e,t,n){var ee;const s=this.js.getOptions();n=n||{timeout:s.timeout},n.timeout=n.timeout||s.timeout,n.previousRevision=n.previousRevision??void 0;const{timeout:i,previousRevision:o}=n,a=this.js.nc.info,c=(a==null?void 0:a.max_payload)||1024;e=e||{},e.options=e.options||{};let h=((ee=e.options)==null?void 0:ee.max_chunk_size)||128*1024;h=h>c?c:h,e.options.max_chunk_size=h;const m=await this.info(e.name),{name:p,error:x}=this._checkNotEmpty(e.name);if(x)return Promise.reject(x);const g=gt.next(),v=this._chunkSubject(g),I=this._metaSubject(p),M=Object.assign({bucket:this.name,nuid:g,size:0,chunks:0},io(e)),j=G(),C=[],D=new Dt;try{const Z=t?t.getReader():null,ne=new Yi;for(;;){const{done:pe,value:ae}=Z?await Z.read():{done:!0,value:void 0};if(pe){if(D.size()>0){const se=D.drain();ne.update(se),M.chunks++,M.size+=se.length,C.push(this.js.publish(v,se,{timeout:i}))}await Promise.all(C),C.length=0,M.mtime=new Date().toISOString();const re=ne.digest("base64"),N=re.length%3,B=N>0?"=".repeat(N):"";M.digest=`${no}${re}${B}`,M.deleted=!1;const Q=Ke();typeof o=="number"&&Q.set(Ue.ExpectedLastSubjectSequenceHdr,`${o}`),Q.set(fe.RollupHdr,fe.RollupValueSubject);const we=await this.js.publish(I,Pe().encode(M),{headers:Q,timeout:i});if(M.revision=we.seq,m)try{await this.jsm.streams.purge(this.stream,{filter:`$O.${this.name}.C.${m.nuid}`})}catch{}j.resolve(new Dn(M));break}if(ae)for(D.fill(ae);D.size()>h;){M.chunks++,M.size+=h;const re=D.drain(e.options.max_chunk_size);ne.update(re),C.push(this.js.publish(v,re,{timeout:i}))}}}catch(Z){await this.jsm.streams.purge(this.stream,{filter:v}),j.reject(Z)}return j}putBlob(e,t,n){function s(i){return new ReadableStream({pull(o){o.enqueue(i),o.close()}})}return t===null&&(t=new Uint8Array(0)),this.put(e,s(t),n)}put(e,t,n){var s;return(s=e==null?void 0:e.options)!=null&&s.link?Promise.reject(new Error("link cannot be set when putting the object in bucket")):this._put(e,t,n)}async getBlob(e){async function t(i){const o=new Dt,a=i.getReader();for(;;){const{done:c,value:h}=await a.read();if(c)return o.drain();h&&h.length&&o.fill(h)}}const n=await this.get(e);if(n===null)return Promise.resolve(null);const s=await Promise.all([n.error,t(n.data)]);return s[0]?Promise.reject(s[0]):Promise.resolve(s[1])}async get(e){const t=await this.rawInfo(e);if(t===null||t.deleted)return Promise.resolve(null);if(t.options&&t.options.link){const m=t.options.link.name||"";if(m==="")throw new Error("link is a bucket");return(t.options.link.bucket!==this.name?await lr.create(this.js,t.options.link.bucket):this).get(m)}const n=G(),s={info:new Dn(t),error:n};if(t.size===0)return s.data=cf(),n.resolve(null),Promise.resolve(s);let i;const o=nt();o.orderedConsumer();const a=new Yi,c=`$O.${this.name}.C.${t.nuid}`,h=await this.js.subscribe(c,o);return(async()=>{for await(const m of h)if(m.data.length>0&&(a.update(m.data),i.enqueue(m.data)),m.info.pending===0){const p=a.digest("base64"),x=p.length%3,g=x>0?"=".repeat(x):"",v=`${no}${p}${g}`;v!==t.digest?i.error(new Error(`received a corrupt object, digests do not match received: ${t.digest} calculated ${v}`)):i.close(),h.unsubscribe()}})().then(()=>{n.resolve()}).catch(m=>{i.error(m),n.reject(m)}),s.data=new ReadableStream({start(m){i=m},cancel(){h.unsubscribe()}}),s}linkStore(e,t){if(!(t instanceof lr))return Promise.reject("bucket required");const n=t,{name:s,error:i}=this._checkNotEmpty(e);if(i)return Promise.reject(i);const o={name:s,options:{link:{bucket:n.name}}};return this._put(o,null)}async link(e,t){const{name:n,error:s}=this._checkNotEmpty(e);if(s)return Promise.reject(s);if(t.deleted)return Promise.reject(new Error("src object is deleted"));if(t.isLink())return Promise.reject(new Error("src object is a link"));const i=await this.rawInfo(e);if(i!==null&&!i.deleted)return Promise.reject(new Error("an object already exists with that name"));const o={bucket:t.bucket,name:t.name},a={name:n,bucket:t.bucket,options:{link:o}};await this.js.publish(this._metaSubject(e),JSON.stringify(a));const c=await this.info(e);return Promise.resolve(c)}async delete(e){const t=await this.rawInfo(e);if(t===null)return Promise.resolve({purged:0,success:!1});t.deleted=!0,t.size=0,t.chunks=0,t.digest="";const n=Pe(),s=Ke();return s.set(fe.RollupHdr,fe.RollupValueSubject),await this.js.publish(this._metaSubject(t.name),n.encode(t),{headers:s}),this.jsm.streams.purge(this.stream,{filter:this._chunkSubject(t.nuid)})}async update(e,t={}){const n=await this.rawInfo(e);if(n===null)return Promise.reject(new Error("object not found"));if(n.deleted)return Promise.reject(new Error("cannot update meta for a deleted object"));t.name=t.name??n.name;const{name:s,error:i}=this._checkNotEmpty(t.name);if(i)return Promise.reject(i);if(e!==t.name){const c=await this.info(t.name);if(c&&!c.deleted)return Promise.reject(new Error("an object already exists with that name"))}t.name=s;const o=Object.assign({},n,io(t)),a=await this.js.publish(this._metaSubject(o.name),JSON.stringify(o));return e!==t.name&&await this.jsm.streams.purge(this.stream,{filter:this._metaSubject(e)}),Promise.resolve(a)}async watch(e={}){e.includeHistory=e.includeHistory??!1,e.ignoreDeletes=e.ignoreDeletes??!1;let t=!1;const n=new oe,s=this._metaSubjectAll();try{await this.jsm.streams.getMessage(this.stream,{last_by_subj:s})}catch(c){c.code==="404"?(n.push(null),t=!0):n.stop(c)}const i=Pe(),o=nt();o.orderedConsumer(),e.includeHistory?o.deliverLastPerSubject():(t=!0,o.deliverNew()),o.callback((c,h)=>{var m;if(c){n.stop(c);return}if(h!==null){const p=i.decode(h.data);p.deleted&&e.ignoreDeletes===!0||n.push(p),((m=h.info)==null?void 0:m.pending)===0&&!t&&(t=!0,n.push(null))}});const a=await this.js.subscribe(s,o);return n._data=a,n.iterClosed.then(()=>{a.unsubscribe()}),a.closed.then(()=>{n.stop()}).catch(c=>{n.stop(c)}),n}_chunkSubject(e){return`$O.${this.name}.C.${e}`}_metaSubject(e){return`$O.${this.name}.M.${ar.encode(e)}`}_metaSubjectAll(){return`$O.${this.name}.M.>`}async init(e={}){try{this.stream=Kd(this.name)}catch(s){return Promise.reject(s)}const t=(e==null?void 0:e.ttl)||0;delete e.ttl;const n=Object.assign({max_age:t},e);n.name=this.stream,n.num_replicas=e.replicas??1,n.allow_direct=!0,n.allow_rollup_hdrs=!0,n.discard=fr.New,n.subjects=[`$O.${this.name}.C.>`,`$O.${this.name}.M.>`],e.placement&&(n.placement=e.placement),e.metadata&&(n.metadata=e.metadata),typeof e.compression=="boolean"&&(n.compression=e.compression?it.S2:it.None);try{await this.jsm.streams.info(n.name)}catch(s){s.message==="stream not found"&&await this.jsm.streams.add(n)}}static async create(e,t,n={}){const s=await e.jetstreamManager(),i=new lr(t,s,e);return await i.init(n),Promise.resolve(i)}}class lf{constructor(e){u(this,"js");this.js=e}kv(e,t={}){const n=this.js,{ok:s,min:i}=n.nc.features.get(q.JS_KV);return s?t.bindOnly?_r.bind(this.js,e,t):_r.create(this.js,e,t):Promise.reject(new Error(`kv is only supported on servers ${i} or better`))}os(e,t={}){var o;if(typeof((o=crypto==null?void 0:crypto.subtle)==null?void 0:o.digest)!="function")return Promise.reject(new Error("objectstore: unable to calculate hashes - crypto.subtle.digest with sha256 support is required"));const n=this.js,{ok:s,min:i}=n.nc.features.get(q.JS_OBJECTSTORE);return s?lr.create(this.js,e,t):Promise.reject(new Error(`objectstore is only supported on servers ${i} or better`))}}class Hs extends vr{constructor(t,n){super(t,n);u(this,"consumers");u(this,"streams");u(this,"consumerAPI");u(this,"streamAPI");this.consumerAPI=new Ds(t,n),this.streamAPI=new Ws(t,n),this.consumers=new Wa(this.consumerAPI),this.streams=new af(this.streamAPI)}jetstreamManager(t){t===void 0&&(t=this.opts.checkAPI);const n=Object.assign({},this.opts,{checkAPI:t});return this.nc.jetstreamManager(n)}get apiPrefix(){return this.prefix}get views(){return new lf(this)}async publish(t,n=xe,s){s=s||{},s.expect=s.expect||{};const i=(s==null?void 0:s.headers)||Ke();s&&(s.msgID&&i.set(Ue.MsgIdHdr,s.msgID),s.expect.lastMsgID&&i.set(Ue.ExpectedLastMsgIdHdr,s.expect.lastMsgID),s.expect.streamName&&i.set(Ue.ExpectedStreamHdr,s.expect.streamName),typeof s.expect.lastSequence=="number"&&i.set(Ue.ExpectedLastSeqHdr,`${s.expect.lastSequence}`),typeof s.expect.lastSubjectSequence=="number"&&i.set(Ue.ExpectedLastSubjectSequenceHdr,`${s.expect.lastSubjectSequence}`));const o=s.timeout||this.timeout,a={};o&&(a.timeout=o),s&&(a.headers=i);let{retries:c,retry_delay:h}=s;c=c||1,h=h||250;let m;for(let x=0;x<c;x++)try{m=await this.nc.request(t,n,a);break}catch(g){if(g.code==="503"&&x+1<c)await Vt(h);else throw g}const p=this.parseJsResponse(m);if(p.stream==="")throw T.errorForCode(P.JetStreamInvalidAck);return p.duplicate=p.duplicate?p.duplicate:!1,p}async pull(t,n,s=0){ue(t),Tt(n);let i=this.timeout;s>i&&(i=s),s=s<0?0:X(s);const o={batch:1,no_wait:s===0,expires:s},a=await this.nc.request(`${this.prefix}.CONSUMER.MSG.NEXT.${t}.${n}`,this.jc.encode(o),{noMux:!0,timeout:i}),c=Rt(a);if(c)throw c;return mr(a,this.timeout)}fetch(t,n,s={}){ue(t),Tt(n);let i=null;const o=(s.max_bytes??0)>0;let a=0;const c=o?s.max_bytes:0;let h=null;const m={};if(m.batch=s.batch||1,c){const C=this.nc.features.get(q.JS_PULL_MAX_BYTES);if(!C.ok)throw new Error(`max_bytes is only supported on servers ${C.min} or better`);m.max_bytes=c}m.no_wait=s.no_wait||!1,m.no_wait&&m.expires&&(m.expires=0);const p=s.expires||0;if(p&&(m.expires=X(p)),p===0&&m.no_wait===!1)throw new Error("expires or no_wait is required");const x=s.idle_heartbeat||0;x&&(m.idle_heartbeat=X(x),s.delay_heartbeat===!0&&(m.idle_heartbeat=X(x*4)));const g=new oe,v=m.batch;let I=0;g.protocolFilterFn=(C,D=!1)=>ts(C.msg)?(h==null||h.work(),!1):!0,g.dispatchedFn=C=>{if(C){if(o&&(a+=C.data.length),I++,i&&C.info.pending===0)return;(g.getPending()===1&&C.info.pending===0||v===I||c>0&&a>=c)&&g.stop()}};const M=Je(this.nc.options.inboxPrefix),j=this.nc.subscribe(M,{max:s.batch,callback:(C,D)=>{C===null&&(C=Rt(D)),C!==null?(i&&(i.cancel(),i=null),gh(C)?g.stop(za(C)===null?void 0:C):g.stop(C)):(h==null||h.work(),g.received++,g.push(mr(D,this.timeout)))}});return p&&(i=Ut(p),i.catch(()=>{j.isClosed()||(j.drain().catch(()=>{}),i=null),h&&h.cancel()})),(async()=>{try{x&&(h=new Fs(x,C=>(g.push(()=>{g.err=new T(`${Ee.IdleHeartbeatMissed}: ${C}`,P.JetStreamIdleHeartBeat)}),!0)))}catch{}await j.closed,i!==null&&(i.cancel(),i=null),h&&h.cancel(),g.stop()})().catch(),this.nc.publish(`${this.prefix}.CONSUMER.MSG.NEXT.${t}.${n}`,this.jc.encode(m),{reply:M}),g}async pullSubscribe(t,n=nt()){const s=await this._processOptions(t,n);if(s.ordered)throw new Error("pull subscribers cannot be be ordered");if(s.config.deliver_subject)throw new Error("consumer info specifies deliver_subject - pull consumers cannot have deliver_subject set");const i=s.config.ack_policy;if(i===ie.None||i===ie.All)throw new Error("ack policy for pull consumers must be explicit");const o=this._buildTypedSubscriptionOpts(s),a=new ff(this,s.deliver,o);a.info=s;try{await this._maybeCreateConsumer(s)}catch(c){throw a.unsubscribe(),c}return a}async subscribe(t,n=nt()){const s=await this._processOptions(t,n);if(!s.isBind&&!s.config.deliver_subject)throw new Error("push consumer requires deliver_subject");const i=this._buildTypedSubscriptionOpts(s),o=new Va(this,s.deliver,i);o.info=s;try{await this._maybeCreateConsumer(s)}catch(a){throw o.unsubscribe(),a}return o._maybeSetupHbMonitoring(),o}async _processOptions(t,n=nt()){const s=Ji(n)?n.getOpts():n;if(s.isBind=Ji(n)?n.isBind:!1,s.flow_control={heartbeat_count:0,fc_count:0,consumer_restarts:0},s.ordered){if(s.ordered_consumer_sequence={stream_seq:0,delivery_seq:0},s.config.ack_policy!==ie.NotSet&&s.config.ack_policy!==ie.None)throw new T("ordered consumer: ack_policy can only be set to 'none'",P.ApiError);if(s.config.durable_name&&s.config.durable_name.length>0)throw new T("ordered consumer: durable_name cannot be set",P.ApiError);if(s.config.deliver_subject&&s.config.deliver_subject.length>0)throw new T("ordered consumer: deliver_subject cannot be set",P.ApiError);if(s.config.max_deliver!==void 0&&s.config.max_deliver>1)throw new T("ordered consumer: max_deliver cannot be set",P.ApiError);if(s.config.deliver_group&&s.config.deliver_group.length>0)throw new T("ordered consumer: deliver_group cannot be set",P.ApiError);s.config.deliver_subject=Je(this.nc.options.inboxPrefix),s.config.ack_policy=ie.None,s.config.max_deliver=1,s.config.flow_control=!0,s.config.idle_heartbeat=s.config.idle_heartbeat||X(5e3),s.config.ack_wait=X(22*60*60*1e3),s.config.mem_storage=!0,s.config.num_replicas=1}if(s.config.ack_policy===ie.NotSet&&(s.config.ack_policy=ie.All),s.api=this,s.config=s.config||{},s.stream=s.stream?s.stream:await this.findStream(t),s.attached=!1,s.config.durable_name)try{const i=await this.consumerAPI.info(s.stream,s.config.durable_name);if(i){if(i.config.filter_subject&&i.config.filter_subject!==t)throw new Error("subject does not match consumer");const o=s.config.deliver_group??"";if(o===""&&i.push_bound===!0)throw new Error("duplicate subscription");const a=i.config.deliver_group??"";if(o!==a)throw a===""?new Error("durable requires no queue group"):new Error(`durable requires queue group '${a}'`);s.last=i,s.config=i.config,s.attached=!0,s.config.durable_name||(s.name=i.name)}}catch(i){if(i.code!=="404")throw i}return!s.attached&&s.config.filter_subject===void 0&&s.config.filter_subjects===void 0&&(s.config.filter_subject=t),s.deliver=s.config.deliver_subject||Je(this.nc.options.inboxPrefix),s}_buildTypedSubscriptionOpts(t){const n={};return n.adapter=pf(t.callbackFn===void 0,this.timeout),n.ingestionFilterFn=Hs.ingestionFn(t.ordered),n.protocolFilterFn=(s,i=!1)=>{const o=s;return es(o.msg)?(i||o.msg.respond(),!1):!0},!t.mack&&t.config.ack_policy!==ie.None&&(n.dispatchedFn=bf),t.callbackFn&&(n.callback=t.callbackFn),n.max=t.max||0,n.queue=t.queue,n}async _maybeCreateConsumer(t){if(t.attached)return;if(t.isBind)throw new Error(`unable to bind - durable consumer ${t.config.durable_name} doesn't exist in ${t.stream}`);t.config=Object.assign({deliver_policy:te.All,ack_policy:ie.Explicit,ack_wait:X(30*1e3),replay_policy:Ft.Instant},t.config);const n=await this.consumerAPI.add(t.stream,t.config);if(Array.isArray(t.config.filter_subjects&&!Array.isArray(n.config.filter_subjects)))throw new Error("jetstream server doesn't support consumers with multiple filter subjects");t.name=n.name,t.config=n.config,t.last=n}static ingestionFn(t){return(n,s)=>{var c;const i=s;if(!n)return{ingest:!1,protocol:!1};const o=n;if(Rt(o.msg)||(c=i.monitor)==null||c.work(),ts(o.msg)){const h=t?i._checkHbOrderConsumer(o.msg):!0;return t||i.info.flow_control.heartbeat_count++,{ingest:h,protocol:!0}}else if(es(o.msg))return i.info.flow_control.fc_count++,{ingest:!0,protocol:!0};return{ingest:t?i._checkOrderedConsumer(n):!0,protocol:!1}}}}class Vs{constructor(e){u(this,"options");u(this,"protocol");u(this,"draining");u(this,"listeners");u(this,"_services");this.draining=!1,this.options=Td(e),this.listeners=[]}static connect(e={}){return new Promise((t,n)=>{const s=new Vs(e);Qr.connect(s.options,s).then(i=>{s.protocol=i,async function(){for await(const o of i.status())s.listeners.forEach(a=>{a.push(o)})}(),t(s)}).catch(i=>{n(i)})})}closed(){return this.protocol.closed}async close(){await this.protocol.close()}_check(e,t,n){if(this.isClosed())throw T.errorForCode(P.ConnectionClosed);if(t&&this.isDraining()||n&&this.protocol.noMorePublishing)throw T.errorForCode(P.ConnectionDraining);if(e=e||"",e.length===0)throw T.errorForCode(P.BadSubject)}publish(e,t,n){this._check(e,!1,!0),this.protocol.publish(e,t,n)}publishMessage(e){return this.publish(e.subject,e.data,{reply:e.reply,headers:e.headers})}respondMessage(e){return e.reply?(this.publish(e.reply,e.data,{reply:e.reply,headers:e.headers}),!0):!1}subscribe(e,t={}){this._check(e,!0,!1);const n=new Ua(this.protocol,e,t);return this.protocol.subscribe(n),n}_resub(e,t,n){this._check(t,!0,!1);const s=e;s.max=n,n&&(s.max=n+s.received),this.protocol.resub(s,t)}requestMany(e,t=xe,n={maxWait:1e3,maxMessages:-1}){const s=!this.protocol.options.noAsyncTraces;try{this._check(e,!0,!0)}catch(c){return Promise.reject(c)}if(n.strategy=n.strategy||Te.Timer,n.maxWait=n.maxWait||1e3,n.maxWait<1)return Promise.reject(new T("timeout",P.InvalidOption));const i=new oe;function o(c){i.push(()=>{i.stop(c)})}function a(c,h){c||h===null?o(c===null?void 0:c):i.push(h)}if(n.noMux){const c=s?new Error().stack:null;let h=typeof n.maxMessages=="number"&&n.maxMessages>0?n.maxMessages:-1;const m=this.subscribe(Je(this.options.inboxPrefix),{callback:(v,I)=>{var M,j;if(((M=I==null?void 0:I.data)==null?void 0:M.length)===0&&((j=I==null?void 0:I.headers)==null?void 0:j.status)===P.NoResponders&&(v=T.errorForCode(P.NoResponders)),v){c&&(v.stack+=`

${c}`),p(v);return}a(null,I),n.strategy===Te.Count&&(h--,h===0&&p()),n.strategy===Te.JitterTimer&&(g(),x=setTimeout(()=>{p()},300)),n.strategy===Te.SentinelMsg&&I&&I.data.length===0&&p()}});m.requestSubject=e,m.closed.then(()=>{o()}).catch(v=>{i.stop(v)});const p=v=>{v&&i.push(()=>{throw v}),g(),m.drain().then(()=>{o()}).catch(I=>{o()})};i.iterClosed.then(()=>{g(),m==null||m.unsubscribe()}).catch(v=>{g(),m==null||m.unsubscribe()});try{this.publish(e,t,{reply:m.getSubject()})}catch(v){p(v)}let x=setTimeout(()=>{p()},n.maxWait);const g=()=>{x&&clearTimeout(x)}}else{const c=n;c.callback=a,i.iterClosed.then(()=>{h.cancel()}).catch(m=>{h.cancel(m)});const h=new $h(this.protocol.muxSubscriptions,e,c);this.protocol.request(h);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${h.token}`,headers:n.headers})}catch(m){h.cancel(m)}}return Promise.resolve(i)}request(e,t,n={timeout:1e3,noMux:!1}){try{this._check(e,!0,!0)}catch(i){return Promise.reject(i)}const s=!this.protocol.options.noAsyncTraces;if(n.timeout=n.timeout||1e3,n.timeout<1)return Promise.reject(new T("timeout",P.InvalidOption));if(!n.noMux&&n.reply)return Promise.reject(new T("reply can only be used with noMux",P.InvalidOption));if(n.noMux){const i=n.reply?n.reply:Je(this.options.inboxPrefix),o=G(),a=s?new Error:null,c=this.subscribe(i,{max:1,timeout:n.timeout,callback:(h,m)=>{h?(a&&h.code!==P.Timeout&&(h.stack+=`

${a.stack}`),c.unsubscribe(),o.reject(h)):(h=Pa(m),h?(a&&(h.stack+=`

${a.stack}`),o.reject(h)):o.resolve(m))}});return c.requestSubject=e,this.protocol.publish(e,t,{reply:i,headers:n.headers}),o}else{const i=new Ta(this.protocol.muxSubscriptions,e,n,s);this.protocol.request(i);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${i.token}`,headers:n.headers})}catch(a){i.cancel(a)}const o=Promise.race([i.timer,i.deferred]);return o.catch(()=>{i.cancel()}),o}}flush(){return this.isClosed()?Promise.reject(T.errorForCode(P.ConnectionClosed)):this.protocol.flush()}drain(){return this.isClosed()?Promise.reject(T.errorForCode(P.ConnectionClosed)):this.isDraining()?Promise.reject(T.errorForCode(P.ConnectionDraining)):(this.draining=!0,this.protocol.drain())}isClosed(){return this.protocol.isClosed()}isDraining(){return this.draining}getServer(){const e=this.protocol.getServer();return e?e.listen:""}status(){const e=new oe;return e.iterClosed.then(()=>{const t=this.listeners.indexOf(e);this.listeners.splice(t,1)}),this.listeners.push(e),e}get info(){return this.protocol.isClosed()?void 0:this.protocol.info}async context(){return(await this.request("$SYS.REQ.USER.INFO")).json((t,n)=>t==="time"?new Date(Date.parse(n)):n)}stats(){return{inBytes:this.protocol.inBytes,outBytes:this.protocol.outBytes,inMsgs:this.protocol.inMsgs,outMsgs:this.protocol.outMsgs}}async jetstreamManager(e={}){const t=new of(this,e);if(e.checkAPI!==!1)try{await t.getAccountInfo()}catch(n){const s=n;throw s.code===P.NoResponders&&(s.code=P.JetStreamNotEnabled),s}return t}jetstream(e={}){return new Hs(this,e)}getServerVersion(){const e=this.info;return e?dt(e.version):void 0}async rtt(){if(!this.protocol._closed&&!this.protocol.connected)throw T.errorForCode(P.Disconnect);const e=Date.now();return await this.flush(),Date.now()-e}get features(){return this.protocol.features}get services(){return this._services||(this._services=new uf(this)),this._services}reconnect(){return this.isClosed()?Promise.reject(T.errorForCode(P.ConnectionClosed)):this.isDraining()?Promise.reject(T.errorForCode(P.ConnectionDraining)):this.protocol.reconnect()}}class uf{constructor(e){u(this,"nc");this.nc=e}add(e){try{return new Sr(this.nc,e).start()}catch(t){return Promise.reject(t)}}client(e,t){return new qd(this.nc,e,t)}}class hf{constructor(e,t,n){u(this,"bucket");u(this,"sm");u(this,"prefixLen");this.bucket=e,this.prefixLen=t,this.sm=n}get key(){return this.sm.subject.substring(this.prefixLen)}get value(){return this.sm.data}get delta(){return 0}get created(){return this.sm.time}get revision(){return this.sm.seq}get operation(){return this.sm.header.get(en)||"PUT"}get length(){const e=this.sm.header.get(fe.MessageSizeHdr)||"";return e!==""?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class df{constructor(e,t,n){u(this,"bucket");u(this,"key");u(this,"sm");this.bucket=e,this.key=t,this.sm=n}get value(){return this.sm.data}get created(){return new Date(Ls(this.sm.info.timestampNanos))}get revision(){return this.sm.seq}get operation(){var e;return((e=this.sm.headers)==null?void 0:e.get(en))||"PUT"}get delta(){return this.sm.info.pending}get length(){var t;const e=((t=this.sm.headers)==null?void 0:t.get(fe.MessageSizeHdr))||"";return e!==""?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Va extends Fh{constructor(t,n,s){super(t.nc,n,s);u(this,"js");u(this,"monitor");this.js=t,this.monitor=null,this.sub.closed.then(()=>{this.monitor&&this.monitor.cancel()})}set info(t){this.sub.info=t}get info(){return this.sub.info}_resetOrderedConsumer(t){if(this.info===null||this.sub.isClosed())return;const n=Je(this.js.nc.options.inboxPrefix);this.js.nc._resub(this.sub,n);const i=this.info;i.config.name=gt.next(),i.ordered_consumer_sequence.delivery_seq=0,i.flow_control.heartbeat_count=0,i.flow_control.fc_count=0,i.flow_control.consumer_restarts++,i.deliver=n,i.config.deliver_subject=n,i.config.deliver_policy=te.StartSequence,i.config.opt_start_seq=t;const o={};o.stream_name=this.info.stream,o.config=i.config;const a=`${i.api.prefix}.CONSUMER.CREATE.${i.stream}`;this.js._request(a,o,{retries:-1}).then(c=>{const h=c,m=this.sub.info;m.last=h,this.info.config=h.config,this.info.name=h.name}).catch(c=>{const h=new T(`unable to recreate ordered consumer ${i.stream} at seq ${t}`,P.RequestError,c);this.sub.callback(h,{})})}_maybeSetupHbMonitoring(){var n,s;const t=((s=(n=this.info)==null?void 0:n.config)==null?void 0:s.idle_heartbeat)||0;t&&this._setupHbMonitoring(Ls(t))}_setupHbMonitoring(t,n=0){const s={cancelAfter:0,maxOut:2};n&&(s.cancelAfter=n);const i=this.sub,o=a=>{var m,p,x,g;const c=vh(409,`${Ee.IdleHeartbeatMissed}: ${a}`,this.sub.subject);if(!((m=this.info)==null?void 0:m.ordered))this.sub.callback(null,c);else{if(!this.js.nc.protocol.connected)return!1;const v=((x=(p=this.info)==null?void 0:p.ordered_consumer_sequence)==null?void 0:x.stream_seq)||0;return this._resetOrderedConsumer(v+1),(g=this.monitor)==null||g.restart(),!1}return!i.noIterator};this.monitor=new Fs(t,o,s)}_checkHbOrderConsumer(t){const n=t.headers.get(fe.ConsumerStalledHdr);n!==""&&this.js.nc.publish(n);const s=parseInt(t.headers.get(fe.LastConsumerSeqHdr),10),i=this.info.ordered_consumer_sequence;return this.info.flow_control.heartbeat_count++,s!==i.delivery_seq&&this._resetOrderedConsumer(i.stream_seq+1),!1}_checkOrderedConsumer(t){const n=this.info.ordered_consumer_sequence,s=t.info.streamSequence,i=t.info.deliverySequence;return i!=n.delivery_seq+1?(this._resetOrderedConsumer(n.stream_seq+1),!1):(n.delivery_seq=i,n.stream_seq=s,!0)}async destroy(){this.isClosed()||await this.drain();const t=this.sub.info,n=t.config.durable_name||t.name,s=`${t.api.prefix}.CONSUMER.DELETE.${t.stream}.${n}`;await t.api._request(s)}async consumerInfo(){const t=this.sub.info,n=t.config.durable_name||t.name,s=`${t.api.prefix}.CONSUMER.INFO.${t.stream}.${n}`,i=await t.api._request(s);return t.last=i,i}}class ff extends Va{constructor(e,t,n){super(e,t,n)}pull(e={batch:1}){const{stream:t,config:n,name:s}=this.sub.info,i=n.durable_name??s,o={};if(o.batch=e.batch||1,o.no_wait=e.no_wait||!1,(e.max_bytes??0)>0){const h=this.js.nc.features.get(q.JS_PULL_MAX_BYTES);if(!h.ok)throw new Error(`max_bytes is only supported on servers ${h.min} or better`);o.max_bytes=e.max_bytes}let a=0;e.expires&&e.expires>0&&(a=e.expires,o.expires=X(a));let c=0;if(e.idle_heartbeat&&e.idle_heartbeat>0&&(c=e.idle_heartbeat,o.idle_heartbeat=X(c)),c&&a===0)throw new Error("idle_heartbeat requires expires");if(c>a)throw new Error("expires must be greater than idle_heartbeat");if(this.info){this.monitor&&this.monitor.cancel(),a&&c&&(this.monitor?this.monitor._change(c,a):this._setupHbMonitoring(c,a));const h=this.info.api,m=`${h.prefix}.CONSUMER.MSG.NEXT.${t}.${i}`,p=this.sub.subject;h.nc.publish(m,h.jc.encode(o),{reply:p})}}}function pf(r,e){return r?mf(e):_f(e)}function _f(r){return(e,t)=>e?[e,null]:(e=Rt(t),e?[e,null]:[null,mr(t,r)])}function mf(r){return(e,t)=>{if(e)return[e,null];const n=Rt(t);return n!==null?[za(n),null]:[null,mr(t,r)]}}function za(r){if(r!==null)switch(r.code){case P.JetStream404NoMessages:case P.JetStream408RequestTimeout:return null;case P.JetStream409:return Sh(r)?r:null;default:return r}return null}function bf(r){r&&r.ack()}function gf(r){const e=r.split(".");if(e.length===9&&e.splice(2,0,"_",""),e.length<11||e[0]!=="$JS"||e[1]!=="ACK")throw new Error("not js message");const t={};return t.domain=e[2]==="_"?"":e[2],t.account_hash=e[3],t.stream=e[4],t.consumer=e[5],t.redeliveryCount=parseInt(e[6],10),t.redelivered=t.redeliveryCount>1,t.streamSequence=parseInt(e[7],10),t.deliverySequence=parseInt(e[8],10),t.timestampNanos=parseInt(e[9],10),t.pending=parseInt(e[10],10),t}class yf{constructor(e,t){u(this,"msg");u(this,"di");u(this,"didAck");u(this,"timeout");this.msg=e,this.didAck=!1,this.timeout=t}get subject(){return this.msg.subject}get sid(){return this.msg.sid}get data(){return this.msg.data}get headers(){return this.msg.headers}get info(){return this.di||(this.di=gf(this.reply)),this.di}get redelivered(){return this.info.redeliveryCount>1}get reply(){return this.msg.reply||""}get seq(){return this.info.streamSequence}doAck(e){this.didAck||(this.didAck=!this.isWIP(e),this.msg.respond(e))}isWIP(e){return e.length===4&&e[0]===Qt[0]&&e[1]===Qt[1]&&e[2]===Qt[2]&&e[3]===Qt[3]}async ackAck(e){var n;e=e||{},e.timeout=e.timeout||this.timeout;const t=G();if(this.didAck)t.resolve(!1);else if(this.didAck=!0,this.msg.reply){const i=this.msg.publisher,o=!((n=i.options)!=null&&n.noAsyncTraces),a=new Ta(i.muxSubscriptions,this.msg.reply,{timeout:e.timeout},o);i.request(a);try{i.publish(this.msg.reply,so,{reply:`${i.muxSubscriptions.baseInbox}${a.token}`})}catch(c){a.cancel(c)}try{await Promise.race([a.timer,a.deferred]),t.resolve(!0)}catch(c){a.cancel(c),t.reject(c)}}else t.resolve(!1);return t}ack(){this.doAck(so)}nak(e){let t=Zd;e&&(t=Hi().encode(`-NAK ${JSON.stringify({delay:X(e)})}`)),this.doAck(t)}working(){this.doAck(Qt)}next(e,t={batch:1}){const n={};n.batch=t.batch||1,n.no_wait=t.no_wait||!1,t.expires&&t.expires>0&&(n.expires=X(t.expires));const s=Pe().encode(n),i=Dt.concat(Qd,tf,s),o=e?{reply:e}:void 0;this.msg.respond(i,o)}term(e=""){let t=ef;(e==null?void 0:e.length)>0&&(t=Hi().encode(`+TERM ${e}`)),this.doAck(t)}json(){return this.msg.json()}string(){return this.msg.string()}}const xf="1.29.2",wf="nats.ws";class vf{constructor(){u(this,"version");u(this,"lang");u(this,"closeError");u(this,"connected");u(this,"done");u(this,"socket");u(this,"options");u(this,"socketClosed");u(this,"encrypted");u(this,"peeked");u(this,"yields");u(this,"signal");u(this,"closedNotification");this.version=xf,this.lang=wf,this.connected=!1,this.done=!1,this.socketClosed=!1,this.encrypted=!1,this.peeked=!1,this.yields=[],this.signal=G(),this.closedNotification=G()}async connect(e,t){const n=G();if(t.tls)return n.reject(new T("tls",P.InvalidOption)),n;this.options=t;const s=e.src;if(t.wsFactory){const{socket:i,encrypted:o}=await t.wsFactory(e.src,t);this.socket=i,this.encrypted=o}else this.encrypted=s.indexOf("wss://")===0,this.socket=new WebSocket(s);return this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{this.isDiscarded()},this.socket.onmessage=i=>{if(this.isDiscarded())return;if(this.yields.push(new Uint8Array(i.data)),this.peeked){this.signal.resolve();return}const o=Dt.concat(...this.yields),a=zh(o);if(a!==""){const c=Md.exec(a);if(!c){t.debug&&console.error("!!!",$r(o)),n.reject(new Error("unexpected response from server"));return}try{const h=JSON.parse(c[1]);Rd(h,this.options),this.peeked=!0,this.connected=!0,this.signal.resolve(),n.resolve()}catch(h){n.reject(h);return}}},this.socket.onclose=i=>{if(this.isDiscarded())return;this.socketClosed=!0;let o;this.done||(i.wasClean||(o=new Error(i.reason)),this._closed(o))},this.socket.onerror=i=>{if(this.isDiscarded())return;const o=i,a=new T(o.message,P.Unknown,new Error(o.error));n.reject(a)},n}disconnect(){this._closed(void 0,!0)}async _closed(e,t=!0){if(!this.isDiscarded()&&this.connected&&!this.done){if(this.closeError=e,!e)for(;!this.socketClosed&&this.socket.bufferedAmount>0;)await Vt(100);this.done=!0;try{this.socket.close(e?1002:1e3,e?e.message:void 0)}catch{}t&&this.closedNotification.resolve(e)}}get isClosed(){return this.done}[Symbol.asyncIterator](){return this.iterate()}async*iterate(){for(;;){if(this.isDiscarded())return;this.yields.length===0&&await this.signal;const e=this.yields;this.yields=[];for(let t=0;t<e.length;t++)this.options.debug&&console.info(`> ${$r(e[t])}`),yield e[t];if(this.done)break;this.yields.length===0&&(e.length=0,this.yields=e,this.signal=G())}}isEncrypted(){return this.connected&&this.encrypted}send(e){if(!this.isDiscarded())try{this.socket.send(e.buffer),this.options.debug&&console.info(`< ${$r(e)}`);return}catch(t){this.options.debug&&console.error(`!!! ${$r(e)}: ${t}`)}}close(e){return this._closed(e,!1)}closed(){return this.closedNotification}isDiscarded(){return this.done?(this.discard(),!0):!1}discard(){var e;this.done=!0;try{(e=this.socket)==null||e.close()}catch{}}}function Sf(r,e){/^(.*:\/\/)(.*)/.test(r)||(typeof e=="boolean"?r=`${e===!0?"https":"http"}://${r}`:r=`https://${r}`);let n=new URL(r);const s=n.protocol.toLowerCase();s==="ws:"&&(e=!1),s==="wss:"&&(e=!0),s!=="https:"&&s!=="http"&&(r=r.replace(/^(.*:\/\/)(.*)/gm,"$2"),n=new URL(`http://${r}`));let i,o;const a=n.hostname,c=n.pathname,h=n.search||"";switch(s){case"http:":case"ws:":case"nats:":o=n.port||"80",i="ws:";break;case"https:":case"wss:":case"tls:":o=n.port||"443",i="wss:";break;default:o=n.port||e===!0?"443":"80",i=e===!0?"wss:":"ws:";break}return`${i}//${a}:${o}${c}${h}`}function kf(r={}){return Dh({defaultPort:443,urlParseFn:Sf,factory:()=>new vf}),Vs.connect(r)}var Fr,Ef=new Uint8Array(16);function Pf(){if(!Fr&&(Fr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Fr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fr(Ef)}const Cf=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Of(r){return typeof r=="string"&&Cf.test(r)}var ce=[];for(var qn=0;qn<256;++qn)ce.push((qn+256).toString(16).substr(1));function Af(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(ce[r[e+0]]+ce[r[e+1]]+ce[r[e+2]]+ce[r[e+3]]+"-"+ce[r[e+4]]+ce[r[e+5]]+"-"+ce[r[e+6]]+ce[r[e+7]]+"-"+ce[r[e+8]]+ce[r[e+9]]+"-"+ce[r[e+10]]+ce[r[e+11]]+ce[r[e+12]]+ce[r[e+13]]+ce[r[e+14]]+ce[r[e+15]]).toLowerCase();if(!Of(t))throw TypeError("Stringified UUID is invalid");return t}function If(r,e,t){r=r||{};var n=r.random||(r.rng||Pf)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Af(n)}const Tf="eyJ0eXAiOiJKV1QiLCJhbGciOiJlZDI1NTE5LW5rZXkifQ.eyJqdGkiOiJHWUwzRkVJUERBSFBOQkpNUjdJS1hSUzNUV0tMSE80M1lJU1JUVUFNTVVQT1FOQ0ZCVDdRIiwiaWF0IjoxNzI3MTA0NzgxLCJpc3MiOiJBRENLNFBYUEkyMjVPVFlCNFg1VlJaNVRNR0xJWkRHV1JXTTU1QjNXTlBINUw0SkhTWlBUTURNUCIsIm5hbWUiOiJ0ZWxlZ3JhbS1hcHAiLCJzdWIiOiJVQ0pJTFI0SUVJV09RUjM1WFdaRVpUWkVTTlo3UkdQQUVQWURKQUZERkNaQUVLSldISUZHWkNFUyIsIm5hdHMiOnsicHViIjp7fSwic3ViIjp7fSwic3VicyI6LTEsImRhdGEiOi0xLCJwYXlsb2FkIjotMSwiYmVhcmVyX3Rva2VuIjp0cnVlLCJpc3N1ZXJfYWNjb3VudCI6IkFBQURKVUFVU000NUo3SVlQUDI3UzRUNDRWQksyRlZDNkRWQkhLT09SWVM3R0VESUxBRkRYUFVRIiwidHlwZSI6InVzZXIiLCJ2ZXJzaW9uIjoyfX0.FNrLiyUTTAcLdY6Y6BPfLpyxQozXLGDKRCRzmGNK4JS4ZOh9qc5UmWfcMHeJ24r1f3YuVDzqqI0ZINxctOiFAg";let us;const zs=Pe();let br,Ge={};async function Rf(){us.close()}async function jf(){us=await kf({servers:"connect.ngs.global",authenticator:Cd(Tf)}),console.log("connected to nats..."),br=await us.jetstream().views.kv("trackers"),console.log(br)}async function Mf(r){const e=await br.get(r);return e?(Ge=zs.decode(e.value),{...Ge}):Ge}async function Nf(r,e){return Ge[If()]=e,await br.put(r,zs.encode(Ge)),{...Ge}}async function $f(r,e){return delete Ge[e],await br.put(r,zs.encode(Ge)),{...Ge}}const oo=r=>!r||!Object.values(r).filter(e=>e).length;let rr="test";var ao,co,lo;try{rr=(lo=(co=(ao=jn==null?void 0:jn())==null?void 0:ao.initData)==null?void 0:co.user)==null?void 0:lo.username}catch(r){console.log(r)}const Bf=()=>{const[r,e]=pt({}),t=Qe(),n=Qe(),s=Qe(),i=Qe(),o=Qe({}),[a,c]=pt(!0),h=At(async()=>{if(!oo(o.current))try{const x=await Nf(rr,o.current);t.current.value="",n.current.value="",s.current.value="",i.current.value="",e(x)}catch(x){console.log(x)}},[]);yr(()=>((async()=>{try{await jf(rr);const x=await Mf(rr);e(x)}catch(x){console.log(x)}})(),()=>{(async()=>await Rf())()}),[]);const m=At(()=>{var x,g,v,I;o.current={gasUsed:(x=t.current)==null?void 0:x.value,maxFeePerGas:(g=n.current)==null?void 0:g.value,maxPriorityFeePerGas:(v=s.current)==null?void 0:v.value,compiler:(I=i.current)==null?void 0:I.value},c(oo(o.current))},[]),p=At(async x=>{if(confirm("Delete this tracker?")){const g=await $f(rr,x);e(g)}},[]);return $("div",{children:$(xu,{children:[$(vu,{children:"Active trackers"}),$(Su,{children:$(Rn,{children:[$(Zt,{fontSize:"xs",fontWeight:"medium",children:"Gas Used"}),$(Zt,{fontSize:"xs",fontWeight:"medium",children:"Fee"}),$(Zt,{fontSize:"xs",fontWeight:"medium",children:"Priority"}),$(Zt,{fontSize:"xs",fontWeight:"medium",children:"Compiler"}),$(Zt,{fontSize:"xs",fontWeight:"medium",children:" "})]})}),$(wu,{children:[$(Rn,{children:[$(Le,{children:$(Nr,{size:"xs",ref:t,placeholder:"Gas Used",onChange:m})}),$(Le,{children:$(Nr,{size:"xs",ref:n,placeholder:"Max",onChange:m})}),$(Le,{children:$(Nr,{size:"xs",ref:s,placeholder:"Max Priority",onChange:m})}),$(Le,{children:$(Nr,{size:"xs",ref:i,placeholder:"Compiler version",onChange:m})}),$(Le,{children:$(Zn,{size:"xs",colorPalette:"red",variant:"solid",disabled:a,onClick:h,children:$(Cu,{})})})]}),Object.keys(r).map(x=>$(Rn,{children:[$(Le,{fontSize:"xs",children:r[x].gasUsed}),$(Le,{fontSize:"xs",children:r[x].maxFeePerGas}),$(Le,{fontSize:"xs",children:r[x].maxPriorityFeePerGas}),$(Le,{fontSize:"xs",children:$(Zc,{clamp:1,children:r[x].compiler})}),$(Le,{fontSize:"xs",children:$(Zn,{size:"xs",colorPalette:"red",variant:"subtle",onClick:()=>p(x),children:$(Ou,{})})})]},x))]})]})})};ws($(Bf,{}),document.getElementById("root"))});export default Lf();
